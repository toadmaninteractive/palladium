(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{"6ehr":function(t,e,i){"use strict";i.r(e);var a=i("ofXK"),n=i("3Pt+"),s=i("tyNb"),r=i("u47x"),o=(i("8LU1"),i("fXoL")),l=i("FKr1"),c=i("quSY"),h=i("XNiG"),p=(i("NXyV"),i("VRyK"),i("LRne")),d=(i("xgIS"),i("rDax")),m=i("FtGj"),u=(i("nLfN"),i("+rOU"),i("IzEk")),g=i("eIep"),b=i("pLZG"),f=(i("lJxs"),i("vkgz"),i("3E0/")),y=(i("cH1L"),i("kmnG")),x=i("vxfF");const v={provide:new o.r("mat-autocomplete-scroll-strategy"),deps:[d.c],useFactory:function(t){return()=>t.scrollStrategies.reposition()}};let w=(()=>{class t{}return t.\u0275mod=o.Pb({type:t}),t.\u0275inj=o.Ob({factory:function(e){return new(e||t)},providers:[v],imports:[[l.p,d.f,l.j,a.c],l.p,l.j]}),t})();var S=i("NFeN"),k=i("qFsG"),C=i("STbY"),P=i("M9IT"),O=i("d3UM"),M=i("1jcm"),D=i("Dh3D"),A=i("+0xr"),T=i("Qu3c"),X=(i("mrSG"),i("1G5W")),_=i("bTqV"),L=i("bSwM"),E=i("Xa2L");const I=["searchSelectInput"],$=["innerSelectSearch"];function W(t,e){if(1&t){const t=o.Yb();o.Xb(0,"mat-checkbox",9),o.fc("change",(function(e){return o.Cc(t),o.jc()._emitSelectAllBooleanToParent(e.checked)})),o.Wb()}if(2&t){const t=o.jc();o.pc("color",null==t.matFormField?null:t.matFormField.color)("checked",t.toggleAllCheckboxChecked)("indeterminate",t.toggleAllCheckboxIndeterminate)}}function j(t,e){1&t&&o.Sb(0,"mat-spinner",10)}function Y(t,e){1&t&&o.nc(0,1,["*ngIf","clearIcon; else defaultIcon"])}function z(t,e){1&t&&(o.Xb(0,"mat-icon"),o.Nc(1,"close"),o.Wb())}function B(t,e){if(1&t){const t=o.Yb();o.Xb(0,"button",11),o.fc("click",(function(){return o.Cc(t),o.jc()._reset(!0)})),o.Lc(1,Y,1,0,void 0,12),o.Lc(2,z,2,0,"ng-template",null,13,o.Mc),o.Wb()}if(2&t){const t=o.yc(3),e=o.jc();o.Db(1),o.pc("ngIf",e.clearIcon)("ngIfElse",t)}}function R(t,e){if(1&t&&(o.Xb(0,"div",14),o.Nc(1),o.Wb()),2&t){const t=o.jc();o.Db(1),o.Pc(" ",t.noEntriesFoundLabel,"\n")}}const N=[[["",8,"mat-select-search-custom-header-content"]],[["","ngxMatSelectSearchClear",""]]],F=function(t,e){return{"mat-select-search-inner-multiple":t,"mat-select-search-inner-toggle-all":e}},V=[".mat-select-search-custom-header-content","[ngxMatSelectSearchClear]"];let q=(()=>{let t=class{};return t.\u0275fac=function(e){return new(e||t)},t.\u0275dir=o.Mb({type:t,selectors:[["","ngxMatSelectSearchClear",""]]}),t})();var K;let H=(()=>{let t=K=class{constructor(t,e,i,a=null,n,s=null){this.matSelect=t,this.changeDetectorRef=e,this._viewportRuler=i,this.matOption=a,this.liveAnnouncer=n,this.matFormField=s,this.placeholderLabel="Suche",this.type="text",this.noEntriesFoundLabel="Keine Optionen gefunden",this.indexAndLengthScreenReaderText=" of ",this.clearSearchInput=!0,this.searching=!1,this.disableInitialFocus=!1,this.preventHomeEndKeyPropagation=!1,this.disableScrollToActiveOnOptionsChanged=!1,this.ariaLabel="dropdown search",this.showToggleAllCheckbox=!1,this.toggleAllCheckboxChecked=!1,this.toggleAllCheckboxIndeterminate=!1,this.toggleAll=new o.o,this.onChange=t=>{},this.onTouched=t=>{},this.overlayClassSet=!1,this.change=new o.o,this._onDestroy=new h.a}get isInsideMatOption(){return!!this.matOption}get value(){return this._value}ngOnInit(){const t="mat-select-search-panel";this.matSelect.panelClass?Array.isArray(this.matSelect.panelClass)?this.matSelect.panelClass.push(t):"string"==typeof this.matSelect.panelClass?this.matSelect.panelClass=[this.matSelect.panelClass,t]:"object"==typeof this.matSelect.panelClass&&(this.matSelect.panelClass[t]=!0):this.matSelect.panelClass=t,this.matOption&&(this.matOption.disabled=!0,this.matOption._getHostElement().classList.add("contains-mat-select-search")),this.matSelect.openedChange.pipe(Object(f.a)(1),Object(X.a)(this._onDestroy)).subscribe(t=>{t?(this.updateInputWidth(),this.disableInitialFocus||this._focus()):this.clearSearchInput&&this._reset()}),this.matSelect.openedChange.pipe(Object(u.a)(1)).pipe(Object(X.a)(this._onDestroy)).subscribe(()=>{this.matSelect._keyManager?this.matSelect._keyManager.change.pipe(Object(X.a)(this._onDestroy)).subscribe(()=>this.adjustScrollTopToFitActiveOptionIntoView()):console.log("_keyManager was not initialized."),this._options=this.matSelect.options,this._options.changes.pipe(Object(X.a)(this._onDestroy)).subscribe(()=>{const t=this.matSelect._keyManager;t&&this.matSelect.panelOpen&&setTimeout(()=>{t.setFirstItemActive(),setTimeout(()=>{this.updateInputWidth()}),this.matOption&&(this._noEntriesFound()?this.matOption._getHostElement().classList.add("mat-select-search-no-entries-found"):this.matOption._getHostElement().classList.remove("mat-select-search-no-entries-found")),this.disableScrollToActiveOnOptionsChanged||this.adjustScrollTopToFitActiveOptionIntoView()},1)})}),this.change.pipe(Object(X.a)(this._onDestroy)).subscribe(()=>{this.changeDetectorRef.detectChanges()}),this._viewportRuler.change().pipe(Object(X.a)(this._onDestroy)).subscribe(()=>{this.matSelect.panelOpen&&this.updateInputWidth()}),this.initMultipleHandling()}_emitSelectAllBooleanToParent(t){this.toggleAll.emit(t)}ngOnDestroy(){this._onDestroy.next(),this._onDestroy.complete()}ngAfterViewInit(){setTimeout(()=>{this.setOverlayClass()}),this.matSelect.openedChange.pipe(Object(u.a)(1),Object(X.a)(this._onDestroy)).subscribe(()=>{this.matSelect.options.changes.pipe(Object(X.a)(this._onDestroy)).subscribe(()=>{this.changeDetectorRef.markForCheck()})})}_isToggleAllCheckboxVisible(){return this.matSelect.multiple&&this.showToggleAllCheckbox}_handleKeydown(t){(t.key&&1===t.key.length||t.keyCode>=m.a&&t.keyCode<=m.q||t.keyCode>=m.r&&t.keyCode<=m.j||t.keyCode===m.n||this.preventHomeEndKeyPropagation&&(t.keyCode===m.h||t.keyCode===m.e))&&t.stopPropagation()}_handleKeyup(t){if(t.keyCode===m.p||t.keyCode===m.d){const t=this.matSelect._getAriaActiveDescendant(),e=this._options.toArray().findIndex(e=>e.id===t);if(-1!==e){const t=this._options.toArray()[e];this.liveAnnouncer.announce(t.viewValue+" "+this.getAriaIndex(e)+this.indexAndLengthScreenReaderText+this.getAriaLength())}}}getAriaIndex(t){return 0===this.getOptionsLengthOffset()?t+1:t}getAriaLength(){return this._options.toArray().length-this.getOptionsLengthOffset()}writeValue(t){t!==this._value&&(this._value=t,this.change.emit(t))}onInputChange(t){t!==this._value&&(this.initMultiSelectedValues(),this._value=t,this.onChange(t),this.change.emit(t))}onBlur(t){this.writeValue(t),this.onTouched()}registerOnChange(t){this.onChange=t}registerOnTouched(t){this.onTouched=t}_focus(){if(!this.searchSelectInput||!this.matSelect.panel)return;const t=this.matSelect.panel.nativeElement,e=t.scrollTop;this.searchSelectInput.nativeElement.focus(),t.scrollTop=e}_reset(t){this.searchSelectInput&&(this.searchSelectInput.nativeElement.value="",this.onInputChange(""),this.matOption&&!t&&this.matOption._getHostElement().classList.remove("mat-select-search-no-entries-found"),t&&this._focus())}setOverlayClass(){if(this.overlayClassSet)return;const t=["cdk-overlay-pane-select-search"];this.matOption||t.push("cdk-overlay-pane-select-search-with-offset"),this.matSelect.overlayDir.attach.pipe(Object(X.a)(this._onDestroy)).subscribe(()=>{let e,i=this.searchSelectInput.nativeElement;for(;i=i.parentElement;)if(i.classList.contains("cdk-overlay-pane")){e=i;break}e&&t.forEach(t=>{e.classList.add(t)})}),this.overlayClassSet=!0}initMultipleHandling(){this.matSelect.valueChange.pipe(Object(X.a)(this._onDestroy)).subscribe(t=>{if(this.matSelect.multiple){let e=!1;if(this._value&&this._value.length&&this.previousSelectedValues&&Array.isArray(this.previousSelectedValues)){t&&Array.isArray(t)||(t=[]);const i=this.matSelect.options.map(t=>t.value);this.previousSelectedValues.forEach(a=>{t.some(t=>this.matSelect.compareWith(t,a))||i.some(t=>this.matSelect.compareWith(t,a))||(t.push(a),e=!0)})}e&&this.matSelect._onChange(t),this.previousSelectedValues=t}})}adjustScrollTopToFitActiveOptionIntoView(){if(this.matSelect.panel&&this.matSelect.options.length>0){const t=this.getMatOptionHeight(),e=this.matSelect._keyManager.activeItemIndex||0,i=Object(l.w)(e,this.matSelect.options,this.matSelect.optionGroups),a=(this.matOption?-1:0)+i+e,n=this.matSelect.panel.nativeElement.scrollTop,s=this.innerSelectSearch.nativeElement.offsetHeight,r=Math.floor((O.d-s)/t),o=Math.round((n+s)/t)-1;o>=a?this.matSelect.panel.nativeElement.scrollTop=a*t:o+r<=a&&(this.matSelect.panel.nativeElement.scrollTop=(a+1)*t-(O.d-s))}}updateInputWidth(){if(!this.innerSelectSearch||!this.innerSelectSearch.nativeElement)return;let t,e=this.innerSelectSearch.nativeElement;for(;e=e.parentElement;)if(e.classList.contains("mat-select-panel")){t=e;break}t&&(this.innerSelectSearch.nativeElement.style.width=t.clientWidth+"px")}getMatOptionHeight(){return this.matSelect.options.length>0?this.matSelect.options.first._getHostElement().getBoundingClientRect().height:0}initMultiSelectedValues(){this.matSelect.multiple&&!this._value&&(this.previousSelectedValues=this.matSelect.options.filter(t=>t.selected).map(t=>t.value))}_noEntriesFound(){if(this._options)return this.noEntriesFoundLabel&&this.value&&this._options.length===this.getOptionsLengthOffset()}getOptionsLengthOffset(){return this.matOption?1:0}};return t.\u0275fac=function(e){return new(e||t)(o.Rb(O.a),o.Rb(o.h),o.Rb(x.c),o.Rb(l.o,8),o.Rb(r.k),o.Rb(y.a,8))},t.\u0275cmp=o.Lb({type:t,selectors:[["ngx-mat-select-search"]],contentQueries:function(t,e,i){var a;1&t&&o.Jb(i,q,!0),2&t&&o.xc(a=o.gc())&&(e.clearIcon=a.first)},viewQuery:function(t,e){var i;1&t&&(o.Ic(I,!0,o.l),o.Ic($,!0,o.l)),2&t&&(o.xc(i=o.gc())&&(e.searchSelectInput=i.first),o.xc(i=o.gc())&&(e.innerSelectSearch=i.first))},hostVars:2,hostBindings:function(t,e){2&t&&o.Hb("mat-select-search-inside-mat-option",e.isInsideMatOption)},inputs:{placeholderLabel:"placeholderLabel",type:"type",noEntriesFoundLabel:"noEntriesFoundLabel",indexAndLengthScreenReaderText:"indexAndLengthScreenReaderText",clearSearchInput:"clearSearchInput",searching:"searching",disableInitialFocus:"disableInitialFocus",preventHomeEndKeyPropagation:"preventHomeEndKeyPropagation",disableScrollToActiveOnOptionsChanged:"disableScrollToActiveOnOptionsChanged",ariaLabel:"ariaLabel",showToggleAllCheckbox:"showToggleAllCheckbox",toggleAllCheckboxChecked:"toggleAllCheckboxChecked",toggleAllCheckboxIndeterminate:"toggleAllCheckboxIndeterminate"},outputs:{toggleAll:"toggleAll"},features:[o.Cb([{provide:n.h,useExisting:Object(o.V)(()=>K),multi:!0}])],ngContentSelectors:V,decls:10,vars:12,consts:[["matInput","",1,"mat-select-search-input","mat-select-search-hidden"],[1,"mat-select-search-inner","mat-typography","mat-datepicker-content","mat-tab-header",3,"ngClass"],["innerSelectSearch",""],["class","mat-select-search-toggle-all-checkbox",3,"color","checked","indeterminate","change",4,"ngIf"],["matInput","","autocomplete","off",1,"mat-select-search-input",3,"type","value","placeholder","keydown","keyup","input","blur"],["searchSelectInput",""],["class","mat-select-search-spinner","diameter","16",4,"ngIf"],["mat-button","","mat-icon-button","","aria-label","Clear","class","mat-select-search-clear",3,"click",4,"ngIf"],["class","mat-select-search-no-entries-found",4,"ngIf"],[1,"mat-select-search-toggle-all-checkbox",3,"color","checked","indeterminate","change"],["diameter","16",1,"mat-select-search-spinner"],["mat-button","","mat-icon-button","","aria-label","Clear",1,"mat-select-search-clear",3,"click"],[4,"ngIf","ngIfElse"],["defaultIcon",""],[1,"mat-select-search-no-entries-found"]],template:function(t,e){1&t&&(o.oc(N),o.Sb(0,"input",0),o.Xb(1,"div",1,2),o.Lc(3,W,1,3,"mat-checkbox",3),o.Xb(4,"input",4,5),o.fc("keydown",(function(t){return e._handleKeydown(t)}))("keyup",(function(t){return e._handleKeyup(t)}))("input",(function(t){return e.onInputChange(t.target.value)}))("blur",(function(t){return e.onBlur(t.target.value)})),o.Wb(),o.Lc(6,j,1,0,"mat-spinner",6),o.Lc(7,B,4,2,"button",7),o.nc(8),o.Wb(),o.Lc(9,R,2,1,"div",8)),2&t&&(o.Db(1),o.pc("ngClass",o.vc(9,F,e.matSelect.multiple,e._isToggleAllCheckboxVisible())),o.Db(2),o.pc("ngIf",e._isToggleAllCheckboxVisible()),o.Db(1),o.pc("type",e.type)("value",e.value)("placeholder",e.placeholderLabel),o.Eb("aria-label",e.ariaLabel),o.Db(2),o.pc("ngIf",e.searching),o.Db(1),o.pc("ngIf",e.value&&!e.searching),o.Db(2),o.pc("ngIf",e._noEntriesFound()))},directives:[k.b,a.k,a.m,L.a,E.b,_.a,S.a],styles:[".mat-select-search-hidden[_ngcontent-%COMP%]{visibility:hidden}.mat-select-search-inner[_ngcontent-%COMP%]{position:absolute;top:0;width:100%;border-bottom-width:1px;border-bottom-style:solid;z-index:100;font-size:inherit;box-shadow:none;border-radius:4px 4px 0 0;-webkit-transform:translate3d(0,0,0)}.mat-select-search-inner.mat-select-search-inner-multiple[_ngcontent-%COMP%]{width:100%}.mat-select-search-inner.mat-select-search-inner-multiple.mat-select-search-inner-toggle-all[_ngcontent-%COMP%]{display:flex;align-items:center}.mat-select-search-inner[_ngcontent-%COMP%]   .mat-input-element[_ngcontent-%COMP%]{flex-basis:auto}.mat-select-search-inner[_ngcontent-%COMP%]   .mat-input-element[_ngcontent-%COMP%]:-ms-input-placeholder{-ms-user-select:text}  .mat-select-search-panel{transform:none!important;overflow-x:hidden}.mat-select-search-input[_ngcontent-%COMP%]{padding:16px 36px 16px 16px;box-sizing:border-box}.mat-select-search-no-entries-found[_ngcontent-%COMP%]{padding:16px}.mat-select-search-clear[_ngcontent-%COMP%]{position:absolute;right:4px;top:5px}.mat-select-search-spinner[_ngcontent-%COMP%]{position:absolute;right:16px;top:calc(50% - 8px)}.mat-select-search-inside-mat-option[_nghost-%COMP%]   .mat-select-search-input[_ngcontent-%COMP%]{padding-top:0;padding-bottom:0;height:3em;line-height:3em}.mat-select-search-inside-mat-option[_nghost-%COMP%]   .mat-select-search-clear[_ngcontent-%COMP%]{top:3px}  .cdk-overlay-pane-select-search.cdk-overlay-pane-select-search-with-offset{margin-top:-50px}  .mat-option[aria-disabled=true].contains-mat-select-search{position:static;padding:0}  .mat-option[aria-disabled=true].contains-mat-select-search .mat-icon{margin-right:0}  .mat-option[aria-disabled=true].contains-mat-select-search .mat-option-pseudo-checkbox{display:none}  .mat-option[aria-disabled=true].contains-mat-select-search.mat-select-search-no-entries-found{height:6em}.mat-select-search-toggle-all-checkbox[_ngcontent-%COMP%]{padding-left:16px;padding-bottom:2px}"],changeDetection:0}),t})(),Z=(()=>{let t=class{};return t.\u0275mod=o.Pb({type:t}),t.\u0275inj=o.Ob({factory:function(e){return new(e||t)},imports:[[a.c,_.b,L.b,S.b,k.c,E.a]]}),t})();var U=i("bFKe"),Q=i("PCNd"),G=i("0Y/I"),J=i("jRrs"),tt=i("tk/3"),et=i("2Vo4"),it=i("itXk"),at=i("JX91"),nt=i("Kj3r"),st=i("nYR2"),rt=i("ph7v"),ot=i("ZnjG"),lt=i("W4hA"),ct=i("DUuJ");const ht={AnalyticsQueryFailed:"Analytics query failed",ValuesAreZero:"Values are zero",MapIsNotSelected:"No map is selected",OptionsAreIncorrect:"Analytics query failed, config options are incorrect"};var pt=i("kcOf"),dt=i("aMtd"),mt=i("Y40W"),ut=i("xWQf"),gt=i("iadO"),bt=i("nJc8");function ft(t,e){if(1&t){const t=o.Yb();o.Xb(0,"div",11),o.Xb(1,"span",12),o.fc("click",(function(){return o.Cc(t),o.jc().remove()})),o.Sb(2,"i",13),o.Wb(),o.Wb()}}function yt(t,e){if(1&t){const t=o.Yb();o.Xb(0,"div",14),o.Xb(1,"div",15),o.Xb(2,"mat-checkbox",16),o.fc("ngModelChange",(function(e){return o.Cc(t),o.jc().change(e)})),o.Nc(3," Yes "),o.Wb(),o.Wb(),o.Wb()}if(2&t){const t=o.jc();o.Db(2),o.pc("ngModel",t.value)}}function xt(t,e){if(1&t){const t=o.Yb();o.Xb(0,"div",17),o.Xb(1,"div",18),o.Xb(2,"input",19),o.fc("ngModelChange",(function(e){o.Cc(t);const i=o.jc();return i.isNumber(e)&&i.change(e)})),o.Wb(),o.Wb(),o.Wb()}if(2&t){const t=o.jc();o.Db(2),o.pc("ngModel",t.value)}}function vt(t,e){if(1&t){const t=o.Yb();o.Xb(0,"div",20),o.Xb(1,"input",21),o.fc("dateChange",(function(e){return o.Cc(t),o.jc().change(e.value)})),o.Wb(),o.Xb(2,"span",22),o.fc("click",(function(){return o.Cc(t),o.yc(7).open()})),o.Nc(3),o.kc(4,"date"),o.Wb(),o.Sb(5,"mat-datepicker-toggle",23),o.Sb(6,"mat-datepicker",null,24),o.Wb()}if(2&t){const t=o.yc(7),e=o.jc();o.Db(1),o.pc("matDatepicker",t)("ngModel",e.value),o.Db(2),o.Pc(" ",e.value?o.mc(4,4,e.value,"d MMM yyyy"):"Select date"," "),o.Db(2),o.pc("for",t)}}function wt(t,e){if(1&t&&(o.Vb(0),o.Nc(1),o.kc(2,"date"),o.kc(3,"date"),o.Ub()),2&t){const t=o.jc(2);o.Db(1),o.Qc(" ",o.mc(2,2,t.value.begin,"d MMM yyyy")," \u2013 ",o.mc(3,5,t.value.end,"d MMM yyyy")," ")}}function St(t,e){1&t&&(o.Vb(0),o.Nc(1,"Select date"),o.Ub())}function kt(t,e){if(1&t){const t=o.Yb();o.Xb(0,"div",20),o.Xb(1,"input",25),o.fc("dateChange",(function(e){return o.Cc(t),o.jc().change(e.value)})),o.Wb(),o.Xb(2,"span",26),o.fc("click",(function(){return o.Cc(t),o.yc(6).open()})),o.Lc(3,wt,4,8,"ng-container",27),o.Lc(4,St,2,0,"ng-container",10),o.Wb(),o.Sb(5,"sat-datepicker",28,29),o.Sb(7,"sat-datepicker-toggle",23),o.Wb()}if(2&t){const t=o.yc(6),e=o.jc();o.Db(1),o.pc("satDatepicker",t)("ngModel",e.value),o.Db(1),o.pc("ngSwitch",!!e.value),o.Db(1),o.pc("ngSwitchCase",!0),o.Db(2),o.pc("rangeMode",!0),o.Db(2),o.pc("for",t)}}function Ct(t,e){if(1&t){const t=o.Yb();o.Xb(0,"div",30),o.Xb(1,"mat-select",31),o.fc("selectionChange",(function(e){return o.Cc(t),o.jc().change(e.value)})),o.Xb(2,"mat-option",32),o.Nc(3,"Day"),o.Wb(),o.Xb(4,"mat-option",32),o.Nc(5,"Week"),o.Wb(),o.Xb(6,"mat-option",32),o.Nc(7,"Month"),o.Wb(),o.Xb(8,"mat-option",32),o.Nc(9,"Quarter"),o.Wb(),o.Wb(),o.Wb()}if(2&t){const t=o.jc();o.Db(1),o.pc("ngModel",t.value),o.Db(1),o.pc("value",t.enumPartition.Day),o.Db(2),o.pc("value",t.enumPartition.Week),o.Db(2),o.pc("value",t.enumPartition.Month),o.Db(2),o.pc("value",t.enumPartition.Quarter)}}function Pt(t,e){if(1&t&&(o.Xb(0,"mat-option",37),o.Xb(1,"b",38),o.Nc(2),o.Wb(),o.Xb(3,"span",39),o.Nc(4),o.Wb(),o.Wb()),2&t){const t=e.$implicit;o.pc("value",t.value)("matTooltip",t.label),o.Db(2),o.Oc(t.value),o.Db(2),o.Oc(t.label)}}function Ot(t,e){if(1&t){const t=o.Yb();o.Xb(0,"div",33),o.Xb(1,"mat-select",34),o.fc("selectionChange",(function(e){return o.Cc(t),o.jc().change(e.value)})),o.Xb(2,"mat-select-trigger",35),o.Nc(3),o.Wb(),o.Lc(4,Pt,5,4,"mat-option",36),o.Wb(),o.Wb()}if(2&t){const t=o.jc();o.Db(1),o.pc("ngModel",t.value),o.Db(1),o.pc("matTooltip",t.value),o.Db(1),o.Pc(" ",t.value," "),o.Db(1),o.pc("ngForOf",t.selectOptions)}}function Mt(t,e){1&t&&(o.Vb(0),o.Nc(1," Undefined type "),o.Ub())}let Dt=(()=>{class t{constructor(){this.onChange=new o.o,this.onRemove=new o.o,this.valueChange=new o.o,this.removeFilter=new o.o,this.enumType=dt.h,this.enumPartition=dt.l,this.debouncer=new h.a,this.debouncer.pipe(Object(nt.a)(150),Object(b.a)(t=>null!==t)).subscribe(t=>this.onChange.emit(t))}isNumber(t){return"number"==typeof t&&!isNaN(t)}selectOption(t){const e=(this.selectOptions||[]).filter(e=>e.value===t);return e.length>0?e[0]:null}change(t){this.valueChange.emit({value:t,key:this.key}),this.debouncer.next(t)}remove(){this.removeFilter.emit(this.key),this.onRemove.emit(!0)}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=o.Lb({type:t,selectors:[["m-param-box"]],inputs:{name:"name",type:"type",isRequired:"isRequired",selectOptions:"selectOptions",value:"value",key:"key"},outputs:{onChange:"onChange",onRemove:"onRemove",valueChange:"valueChange",removeFilter:"removeFilter"},decls:13,vars:9,consts:[[1,"m-filter-container"],[1,"m-filter-item","list-group"],[1,"list-group-item","b-l-0","b-t-0","b-r-0","f-w-500",2,"background-color","FloralWhite"],["class","m-btn-close",4,"ngIf"],[1,"d-table",3,"ngSwitch"],["class","form-control m-form-control b-0","style","min-width: 90px; height: 38px",4,"ngSwitchCase"],["class","m-form-control b-0","style","height: 38px",4,"ngSwitchCase"],["class","form-control m-form-control pr-1 b-0","style","height: 38px",4,"ngSwitchCase"],["class","form-control m-form-control b-0","style","min-width: 95px; height: 38px",4,"ngSwitchCase"],["class","form-control m-form-control b-0","style","min-width: 150px; height: 38px",4,"ngSwitchCase"],[4,"ngSwitchDefault"],[1,"m-btn-close"],[1,"btn","btn-danger","m-btn","m-btn--icon","btn-sm","m-btn--icon-only",3,"click"],[1,"la","la-close"],[1,"form-control","m-form-control","b-0",2,"min-width","90px","height","38px"],[1,"m-mat-input","m-checkbox","pl-0",2,"margin-top","-4px"],["color","primary",3,"ngModel","ngModelChange"],[1,"m-form-control","b-0",2,"height","38px"],[1,"m-mat-input"],["type","number",3,"ngModel","ngModelChange"],[1,"form-control","m-form-control","pr-1","b-0",2,"height","38px"],[1,"m-datepicker-input",3,"matDatepicker","ngModel","dateChange"],[2,"float","left",3,"click"],["matSuffix","",2,"float","right","margin-top","-12px",3,"for"],["picker",""],[1,"m-datepicker-input",3,"satDatepicker","ngModel","dateChange"],[2,"float","left",3,"ngSwitch","click"],[4,"ngSwitchCase"],[3,"rangeMode"],["periodPicker",""],[1,"form-control","m-form-control","b-0",2,"min-width","95px","height","38px"],[3,"ngModel","selectionChange"],[3,"value"],[1,"form-control","m-form-control","b-0",2,"min-width","150px","height","38px"],["panelClass","dynamic-options","placeholder","Select option...",3,"ngModel","selectionChange"],["matTooltipPosition","below",3,"matTooltip"],["matTooltipPosition","right",3,"value","matTooltip",4,"ngFor","ngForOf"],["matTooltipPosition","right",3,"value","matTooltip"],[1,"block"],[1,"alt"]],template:function(t,e){1&t&&(o.Xb(0,"div",0),o.Xb(1,"div",1),o.Xb(2,"label",2),o.Nc(3),o.Lc(4,ft,3,0,"div",3),o.Wb(),o.Xb(5,"div",4),o.Lc(6,yt,4,1,"div",5),o.Lc(7,xt,3,1,"div",6),o.Lc(8,vt,8,7,"div",7),o.Lc(9,kt,8,6,"div",7),o.Lc(10,Ct,10,5,"div",8),o.Lc(11,Ot,5,4,"div",9),o.Lc(12,Mt,2,0,"ng-container",10),o.Wb(),o.Wb(),o.Wb()),2&t&&(o.Db(3),o.Pc(" ",e.name," "),o.Db(1),o.pc("ngIf",!e.isRequired),o.Db(1),o.pc("ngSwitch",e.type),o.Db(1),o.pc("ngSwitchCase",e.enumType.Boolean),o.Db(1),o.pc("ngSwitchCase",e.enumType.Numeric),o.Db(1),o.pc("ngSwitchCase",e.enumType.Date),o.Db(1),o.pc("ngSwitchCase",e.enumType.DateRange),o.Db(1),o.pc("ngSwitchCase",e.enumType.TimePartition),o.Db(1),o.pc("ngSwitchCase",e.enumType.Select))},directives:[a.m,a.o,a.p,a.q,L.a,n.j,n.m,n.n,n.b,gt.b,gt.d,y.f,gt.a,bt.b,bt.a,bt.d,O.a,l.o,O.c,T.a,a.l],pipes:[a.e],styles:[".m-filter-container[_ngcontent-%COMP%]{display:inline;position:relative;float:left;margin:0}.m-filter-item[_ngcontent-%COMP%]{margin:5px 10px 5px 0;border:1px solid #ced4da;border-radius:.25rem}.m-btn-close[_ngcontent-%COMP%]{position:relative;display:inline-block;float:right;margin-left:10px;margin-right:-5px}.btn-group-sm[_ngcontent-%COMP%] > .m-btn--icon.m-btn--icon-only.btn[_ngcontent-%COMP%], .m-btn--icon.m-btn--icon-only.btn-sm[_ngcontent-%COMP%]{width:20px;height:20px}.m-datepicker-input[_ngcontent-%COMP%]{width:0;height:0;padding:0;margin:0;border:none;visibility:hidden}.list-group-item[_ngcontent-%COMP%]{padding:5px 10px}.m-mat-input[_ngcontent-%COMP%]{display:table;vertical-align:middle;height:100%}.m-mat-input[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:calc(100% - 20px);height:90%;border:0;margin:2px 10px;outline:none;font-family:Arial,sans-serif}  .mat-checkbox-layout{width:calc(100% - 20px);height:100%;border:0;margin:0}.m-form-control[_ngcontent-%COMP%]{display:block;width:100%;height:calc(2.95rem + 2px);font-size:1rem;line-height:1.25;color:#495057;background-color:#fff;background-clip:padding-box}.list-item[_ngcontent-%COMP%]{margin:0 10px 0 0}  .dynamic-options .mat-option-text{line-height:15px}"]}),t})();var At=i("Fjbs"),Tt=i("wZkO"),Xt=i("Wp6s"),_t=i("yrPX"),Lt=i("vEia");function Et(t,e){if(1&t&&o.Sb(0,"i",13),2&t){const t=o.jc();o.qc("matTooltip",t.tooltipCaption)}}function It(t,e){if(1&t){const t=o.Yb();o.Xb(0,"div",14),o.Sb(1,"input",15),o.Xb(2,"button",16),o.fc("click",(function(){return o.Cc(t),o.yc(6).open()})),o.Nc(3),o.kc(4,"date"),o.Wb(),o.Xb(5,"mat-datepicker",17,18),o.fc("yearSelected",(function(e){return o.Cc(t),o.jc().yearHandler(e)}))("monthSelected",(function(e){o.Cc(t);const i=o.yc(6);return o.jc().monthHandler(e,i)})),o.Wb(),o.Wb()}if(2&t){const t=o.yc(6),e=o.jc();o.Db(1),o.pc("matDatepicker",t),o.Db(2),o.Pc(" ",o.mc(4,2,e.selectedDate,"LLL yyyy")," ")}}function $t(t,e){if(1&t){const t=o.Yb();o.Xb(0,"div"),o.Xb(1,"input",19),o.fc("dateChange",(function(e){return o.Cc(t),o.jc().setSelectedDate(e.value)})),o.Wb(),o.Xb(2,"button",16),o.fc("click",(function(){return o.Cc(t),o.yc(6).open()})),o.Nc(3),o.kc(4,"date"),o.Wb(),o.Sb(5,"mat-datepicker",null,20),o.Wb()}if(2&t){const t=o.yc(6),e=o.jc();o.Db(1),o.pc("matDatepicker",t),o.Db(2),o.Pc(" ",o.mc(4,2,e.selectedDate,"mediumDate")," ")}}function Wt(t,e){if(1&t&&(o.Xb(0,"span",22),o.Nc(1),o.Wb()),2&t){const t=o.jc(2);o.Db(1),o.Pc(" ",t.captionForButton," ")}}function jt(t,e){if(1&t&&(o.Xb(0,"div"),o.Lc(1,Wt,2,1,"span",21),o.Wb()),2&t){const t=o.jc();o.Db(1),o.pc("ngIf",t.captionForButton)}}function Yt(t,e){if(1&t){const t=o.Yb();o.Xb(0,"li",33),o.Xb(1,"a",34),o.fc("click",(function(){o.Cc(t);const i=e.$implicit;return o.jc(2).onPeriodChange(i.value)})),o.Xb(2,"span",35),o.Nc(3),o.Wb(),o.Wb(),o.Wb()}if(2&t){const t=e.$implicit;o.Db(3),o.Oc(t.label)}}function zt(t,e){if(1&t&&(o.Xb(0,"ul",23),o.Xb(1,"li",24),o.Xb(2,"a",25),o.Nc(3),o.Wb(),o.Xb(4,"div",26),o.Sb(5,"span",27),o.Xb(6,"div",28),o.Xb(7,"div",29),o.Xb(8,"div",30),o.Xb(9,"ul",31),o.Lc(10,Yt,4,1,"li",32),o.Wb(),o.Wb(),o.Wb(),o.Wb(),o.Wb(),o.Wb(),o.Wb()),2&t){const t=o.jc();o.Db(3),o.Pc(" ",t.activePeriodLabel," "),o.Db(7),o.pc("ngForOf",t.periods)}}function Bt(t,e){1&t&&o.Sb(0,"m-loading-indicator",39),2&t&&o.pc("isInline",!0)}function Rt(t,e){if(1&t&&(o.Xb(0,"span",43),o.Nc(1),o.Wb()),2&t){const t=o.jc(3);o.Db(1),o.Pc(" ",t.description," ")}}function Nt(t,e){if(1&t&&(o.Xb(0,"div",44),o.Xb(1,"div"),o.Sb(2,"mat-icon",45),o.Xb(3,"span",46),o.Nc(4),o.kc(5,"mNumeric"),o.Wb(),o.Wb(),o.Xb(6,"div"),o.Xb(7,"span",47),o.Xb(8,"span",48),o.Nc(9,"vs"),o.Wb(),o.Nc(10),o.kc(11,"mNumeric"),o.Wb(),o.Wb(),o.Wb()),2&t){const t=o.jc(3);o.pc("ngClass",t.increase<0?"m--font-danger":"m--font-success"),o.Db(2),o.pc("innerText",t.increase<0?"arrow_drop_down":"arrow_drop_up"),o.Db(2),o.Pc("",o.lc(5,4,t.increase),"%"),o.Db(6),o.Pc(" ",o.lc(11,6,t.previous),"")}}function Ft(t,e){if(1&t&&(o.Vb(0),o.Xb(1,"div",5),o.Xb(2,"span",40),o.Nc(3),o.kc(4,"mNumeric"),o.Wb(),o.Lc(5,Rt,2,1,"span",41),o.Wb(),o.Lc(6,Nt,12,8,"div",42),o.Ub()),2&t){const t=o.jc(2);o.Db(2),o.pc("ngClass",t.styleClass),o.Db(1),o.Pc(" ",o.lc(4,4,t.value)," "),o.Db(2),o.pc("ngIf",t.description),o.Db(1),o.pc("ngIf",null!==t.increase&&t.previous)}}function Vt(t,e){if(1&t&&(o.Xb(0,"mat-card-content",36),o.Lc(1,Bt,1,1,"m-loading-indicator",37),o.Lc(2,Ft,7,6,"ng-container",38),o.Wb()),2&t){const t=o.jc();o.pc("ngSwitch",t.value),o.Db(1),o.pc("ngSwitchCase",null)}}function qt(t,e){if(1&t&&(o.Xb(0,"div",49),o.Xb(1,"div",50),o.Nc(2),o.Wb(),o.Wb()),2&t){const t=o.jc();o.Db(2),o.Pc(" ",t.error," ")}}let Kt=(()=>{class t{constructor(){this.selectedDate=new Date,this.periodChanged=new o.o,this.dateChanged=new o.o,this.activePeriodLabel=""}ngOnInit(){if(this.periods){const t=this.periods.filter(t=>t.value===this.activePeriod)[0];this.activePeriodLabel=t?t.label:null}}ngOnChanges(){this.increase=null,null!==this.value&&null!==this.previous&&(this.increase=Math.round((this.value-this.previous)/this.previous*1e3)/10,0===this.previous&&(this.increase=0))}onPeriodChange(t){this.activePeriod=t,this.periodChanged.emit(t);const e=this.periods.filter(t=>t.value===this.activePeriod)[0];this.activePeriodLabel=e?e.label:null}yearHandler(t){this.selectedDate.setFullYear(t.getFullYear())}monthHandler(t,e){this.selectedDate.setMonth(t.getMonth()),this.selectedDate=new Date(this.selectedDate),e.close(),this.dateChanged.emit(this.selectedDate)}setSelectedDate(t){this.selectedDate=new Date(t),this.dateChanged.emit(this.selectedDate)}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=o.Lb({type:t,selectors:[["m-value-card"]],inputs:{caption:"caption",captionForButton:"captionForButton",selectedDate:"selectedDate",datepickerDepth:"datepickerDepth",tooltipCaption:"tooltipCaption",value:"value",previous:"previous",styleClass:"styleClass",description:"description",activePeriod:"activePeriod",periods:"periods",error:"error"},outputs:{periodChanged:"periodChanged",dateChanged:"dateChanged"},features:[o.Bb()],decls:15,vars:9,consts:[[1,"m-card","m-section"],[1,"m-card","m-section__content"],[1,"m-card","m-mat-card"],["ngClass","m-card"],[1,"m-card","card-title"],[2,"display","inline-block"],["class","la la-question-circle hint-icon dimmed more",3,"matTooltip",4,"ngIf"],[2,"display","table",3,"ngSwitch"],["style","display: table-cell",4,"ngSwitchCase"],[4,"ngSwitchCase"],["class","m-card m-portlet__nav",4,"ngIf"],[3,"ngSwitch",4,"ngIf"],["class","collapse show",4,"ngIf"],[1,"la","la-question-circle","hint-icon","dimmed","more",3,"matTooltip"],[2,"display","table-cell"],[1,"m-datepicker-input",3,"matDatepicker"],[1,"btn","m-btn--pill","btn-secondary","m-btn","m-btn--label-primary","m-btn--bolder","m-button-datapicker",3,"click"],["startView","multi-year",3,"yearSelected","monthSelected"],["multiYearPicker",""],[1,"m-datepicker-input",3,"matDatepicker","dateChange"],["picker",""],["class","btn btn-secondary m-btn--pill m-btn--label-primary  m-button-datapicker m-btn-disabled",4,"ngIf"],[1,"btn","btn-secondary","m-btn--pill","m-btn--label-primary","m-button-datapicker","m-btn-disabled"],[1,"m-card","m-portlet__nav"],["m-dropdown-toggle","hover",1,"m-portlet__nav-item","m-dropdown","m-dropdown--inline","m-dropdown--arrow","m-dropdown--align-right","m-dropdown--align-push"],["href","javascript:void(null)",1,"m-portlet__nav-link","m-dropdown__toggle","dropdown-toggle","btn","btn--sm","m-btn--pill","btn-secondary","m-btn","m-btn--label-brand"],[1,"m-dropdown__wrapper"],[1,"m-dropdown__arrow","m-dropdown__arrow--right","m-dropdown__arrow--adjust"],[1,"m-dropdown__inner"],[1,"m-dropdown__body"],[1,"m-dropdown__content"],[1,"m-nav"],["class","m-nav__item",4,"ngFor","ngForOf"],[1,"m-nav__item"],["href","javascript:void(null)",1,"m-nav__link",3,"click"],[1,"m-nav__link-text"],[3,"ngSwitch"],[3,"isInline",4,"ngSwitchCase"],[4,"ngSwitchDefault"],[3,"isInline"],[1,"m-card","m-card-content",3,"ngClass"],["class","desc-grey",4,"ngIf"],["class","m-card m-card-prev-value","style","display: inline-block; margin:10px 0 0 5px; width: 100px; line-height: 0.1; vertical-align: top;",3,"ngClass",4,"ngIf"],[1,"desc-grey"],[1,"m-card","m-card-prev-value",2,"display","inline-block","margin","10px 0 0 5px","width","100px","line-height","0.1","vertical-align","top",3,"ngClass"],[2,"vertical-align","text-top",3,"innerText"],[2,"margin-left","-10px"],[2,"color","#9699a2","white-space","nowrap","margin","-10px 0 0 5px"],[2,"font-size","0.8rem"],[1,"collapse","show"],[1,"card","card-body","m-card-error","f-s-14","f-w-400"]],template:function(t,e){1&t&&(o.Xb(0,"div",0),o.Xb(1,"div",1),o.Xb(2,"mat-card",2),o.Xb(3,"mat-card-header",3),o.Xb(4,"mat-card-title",4),o.Xb(5,"div",5),o.Nc(6),o.Wb(),o.Lc(7,Et,1,1,"i",6),o.Wb(),o.Xb(8,"div",7),o.Lc(9,It,7,5,"div",8),o.Lc(10,$t,7,5,"div",9),o.Lc(11,jt,2,1,"div",9),o.Lc(12,zt,11,2,"ul",10),o.Wb(),o.Wb(),o.Lc(13,Vt,3,2,"mat-card-content",11),o.Wb(),o.Lc(14,qt,3,1,"div",12),o.Wb(),o.Wb()),2&t&&(o.Db(6),o.Pc(" ",e.caption,""),o.Db(1),o.pc("ngIf",e.tooltipCaption),o.Db(1),o.pc("ngSwitch",e.datepickerDepth),o.Db(1),o.pc("ngSwitchCase","month"),o.Db(1),o.pc("ngSwitchCase","day"),o.Db(1),o.pc("ngSwitchCase","noDatePicker"),o.Db(1),o.pc("ngIf",(null==e.periods?null:e.periods.length)>0),o.Db(1),o.pc("ngIf",!e.error),o.Db(1),o.pc("ngIf",e.error))},directives:[Xt.a,Xt.c,a.k,Xt.e,a.m,a.o,a.p,T.a,gt.b,gt.a,a.l,Xt.b,a.q,_t.a,S.a],pipes:[a.e,Lt.a],styles:[".mat-card-header-text{width:100%;margin:0!important}.m-datepicker-input[_ngcontent-%COMP%]{width:0;height:0;padding:0;margin:0;border:none;visibility:hidden}.m-button-datapicker[_ngcontent-%COMP%]{font-family:Capriola,sans-serif;margin-top:-12px;margin-right:5px}.m-card-error[_ngcontent-%COMP%]{background-color:#fff0f0;color:red;border:1px solid #ffd6d6}"],changeDetection:0}),t})();var Ht=i("Ehhc");const Zt=["chart"];function Ut(t,e){if(1&t){const t=o.Yb();o.Xb(0,"i",13),o.fc("click",(function(){return o.Cc(t),o.jc().onExpandChart()})),o.Wb()}}function Qt(t,e){if(1&t&&(o.Sb(0,"i",14),o.kc(1,"async")),2&t){const t=o.jc();o.qc("matTooltip",o.lc(1,1,t.options$).description)}}let Gt=(()=>{class t{constructor(t,e){this.windowRefService=t,this.chartBoxExpansionService=e,this.animationTime=510,this.onlyFixed=!1,this.uniqueId="0",this.options$=new et.a(null),this.data=new et.a([]),this.isExpanded=this.chartBoxExpansionService.isExpanded,this.userOS=this.windowRefService.detectOperatingSystem()}set _options(t){this.options$.next(t)}set _series(t){this.data.next(t)}onExpandChart(){this.isExpanded=!this.isExpanded,this.chartBoxExpansionService.isExpanded=this.isExpanded,this.chartBoxExpansionService.expand.next({delay:this.animationTime,containerKey:this.uniqueId})}}return t.\u0275fac=function(e){return new(e||t)(o.Rb(Ht.a),o.Rb(ct.a))},t.\u0275cmp=o.Lb({type:t,selectors:[["m-chart-box"]],contentQueries:function(t,e,i){var a;1&t&&o.Jb(i,o.M,!0),2&t&&o.xc(a=o.gc())&&(e.contentTemplate=a.first)},viewQuery:function(t,e){var i;1&t&&o.Ic(Zt,!0),2&t&&o.xc(i=o.gc())&&(e.chart=i.first)},inputs:{onlyFixed:"onlyFixed",uniqueId:"uniqueId",_options:["options","_options"],_series:["data","_series"]},decls:20,vars:15,consts:[[3,"ngClass"],[1,"col"],[1,"m-card","m-section"],[1,"m-card","m-section__content"],["container",""],["class","la la-arrows-h d3-expand-chart-button",3,"click",4,"ngIf"],[1,"d3-header-container"],[1,"d3-header-item"],[1,"d3-header-title"],[1,"d3-chart-description"],["matTooltipClass","basic-font","class","la la-info-circle hint-icon dimmed",3,"matTooltip",4,"ngIf"],[1,"d3-header-subtitle"],[3,"ngTemplateOutlet"],[1,"la","la-arrows-h","d3-expand-chart-button",3,"click"],["matTooltipClass","basic-font",1,"la","la-info-circle","hint-icon","dimmed",3,"matTooltip"]],template:function(t,e){1&t&&(o.Xb(0,"div",0),o.Xb(1,"div",1),o.Xb(2,"div",2),o.Xb(3,"div",3),o.Xb(4,"div",0,4),o.Lc(6,Ut,1,0,"i",5),o.Xb(7,"div",6),o.Xb(8,"div",7),o.Xb(9,"div",8),o.Nc(10),o.kc(11,"async"),o.kc(12,"async"),o.Wb(),o.Xb(13,"div",9),o.Lc(14,Qt,2,3,"i",10),o.kc(15,"async"),o.Wb(),o.Xb(16,"div",11),o.Nc(17),o.kc(18,"async"),o.Wb(),o.Wb(),o.Wb(),o.Tb(19,12),o.Wb(),o.Wb(),o.Wb(),o.Wb(),o.Wb()),2&t&&(o.pc("ngClass",e.userOS+"-os row"),o.Db(4),o.pc("ngClass",e.onlyFixed?"d3-container-fixed":e.isExpanded?"d3-container-expanded":"d3-container-fixed"),o.Db(2),o.pc("ngIf",!e.onlyFixed),o.Db(4),o.Pc(" ",o.lc(11,7,e.options$).name||o.lc(12,9,e.options$).title||""," "),o.Db(4),o.pc("ngIf",o.lc(15,11,e.options$).description),o.Db(3),o.Pc(" ",o.lc(18,13,e.options$).subtitle||""," "),o.Db(2),o.pc("ngTemplateOutlet",e.contentTemplate))},directives:[a.k,a.m,a.r,T.a],pipes:[a.b],styles:[""],changeDetection:0}),t})();var Jt=i("VphZ"),te=i("nuVB"),ee=i("ITC6");const ie=["chartContainer"],ae=["plotContainer"],ne=["barsContainer"],se=["mouseMoveRect"],re=["linesContainer"],oe=["axisBottom"],le=["axisTop"],ce=["axisLeft"],he=["axisRight"],pe=["xGrid"],de=["yGrid"],me=["axisContextBottom"],ue=["axisContextLeft"],ge=["timecontext"],be=["timecontextLine"],fe=["timecontextBrush"],ye=["zoomContainer"],xe=["measureCanvas"],ve=["tooltipContainer"],we=["tooltipContainerBar"];function Se(t,e){if(1&t){const t=o.Yb();o.Xb(0,"div",45),o.fc("click",(function(){o.Cc(t);const i=e.$implicit;return o.jc(3).toggleSeries(i.key)})),o.Sb(1,"span",46),o.Xb(2,"span",47),o.Nc(3),o.Wb(),o.Wb()}if(2&t){const t=e.$implicit,i=o.jc(3);o.Db(1),o.Kc("background-color",i.legendSeriesMap.has(t.key)?i.getColorByKey(t.key):"#ccc"),o.Db(1),o.Kc("opacity",i.legendSeriesMap.has(t.key)?1:.3),o.Db(1),o.Pc("",i.getSeriesOptions(t.key).name," ")}}function ke(t,e){if(1&t&&(o.Vb(0),o.Xb(1,"div",42),o.Xb(2,"div",43),o.Lc(3,Se,4,5,"div",44),o.Wb(),o.Wb(),o.Ub()),2&t){const t=o.jc(2);o.Db(3),o.pc("ngForOf",t.drawingSeries)}}function Ce(t,e){if(1&t&&(o.Vb(0),o.Lc(1,ke,4,1,"ng-container",1),o.kc(2,"async"),o.Ub()),2&t){const t=o.jc();o.Db(1),o.pc("ngIf",o.lc(2,1,t.options$).showLegend)}}function Pe(t,e){if(1&t&&(o.ic(),o.Xb(0,"g",48),o.Sb(1,"path"),o.kc(2,"async"),o.Wb()),2&t){const t=o.jc();o.Db(1),o.Eb("d",t.drawVerticalLine(o.lc(2,1,t.tooltipXCoordinate$)))}}function Oe(t,e){if(1&t&&(o.ic(),o.Xb(0,"g",49),o.Xb(1,"text"),o.Nc(2),o.kc(3,"async"),o.Wb(),o.Wb()),2&t){const t=o.jc();o.Eb("transform","translate("+t.bottomAxisTranslate+","+(t.plotProps.height+t.padding.bottom-10)+")"),o.Db(2),o.Oc(o.lc(3,2,t.options$).xAxisTitle)}}function Me(t,e){if(1&t&&(o.ic(),o.Xb(0,"g",50),o.Xb(1,"text"),o.Nc(2),o.kc(3,"async"),o.Wb(),o.Wb()),2&t){const t=o.jc();o.Eb("transform","rotate(-90)  translate("+(0-t.leftAxisTitleTranslate)+","+(0-t.maxLabelYPrimaryWidth)+")"),o.Db(2),o.Oc(o.lc(3,2,t.options$).yAxisTitle)}}function De(t,e){if(1&t&&(o.ic(),o.Xb(0,"g",51),o.Xb(1,"text"),o.Nc(2),o.kc(3,"async"),o.Wb(),o.Wb()),2&t){const t=o.jc();o.Eb("transform","rotate(90) translate("+t.rightAxisTitleTranslate+","+(0-(t.plotProps.width+t.maxLabelYSecondaryWidth))+")"),o.Db(2),o.Oc(o.lc(3,2,t.options$).secondaryYAxisTitle)}}function Ae(t,e){if(1&t&&(o.ic(),o.Xb(0,"g"),o.Sb(1,"rect",54),o.Xb(2,"text"),o.Nc(3),o.Wb(),o.Wb()),2&t){const t=e.$implicit,i=e.index,a=o.jc(2);o.Db(1),o.Kc("fill",a.getColorByKey(a.drawingSeries[i].key)),o.qc("id",i),o.Eb("x",a.estimateCoords[i])("y",a.plotProps.height-15),o.Db(1),o.Eb("transform","translate("+a.estimateCoords[i]+", "+(a.plotProps.height-17)+")"),o.Db(1),o.Pc(" ",t," ")}}function Te(t,e){if(1&t&&(o.ic(),o.Xb(0,"g",null,52),o.Lc(2,Ae,4,7,"g",53),o.Wb()),2&t){const t=o.jc();o.Db(2),o.pc("ngForOf",t.estimate)}}function Xe(t,e){if(1&t&&(o.ic(),o.hc(),o.Xb(0,"div",55,56),o.kc(2,"async"),o.Xb(3,"span",57),o.Nc(4),o.Wb(),o.Sb(5,"ul",58),o.kc(6,"safe"),o.Wb()),2&t){const t=o.jc();o.Kc("opacity",o.lc(2,8,t.tooltipXCoordinate$)?".8":"0")("top",t.tooltipPosition.top,"px")("left",t.tooltipPosition.left,"px"),o.Db(4),o.Oc(t.tooltipHeader),o.Db(1),o.pc("innerHTML",o.mc(6,10,t.tooltipContent,"html"),o.Dc)}}function _e(t,e){if(1&t&&(o.ic(),o.hc(),o.Xb(0,"div",59,60),o.Xb(2,"span",57),o.Nc(3),o.Wb(),o.Sb(4,"ul",58),o.kc(5,"safe"),o.Wb()),2&t){const t=o.jc();o.Kc("opacity",t.selectedSeriesKey?".8":"0")("top",t.tooltipPosition.top,"px")("left",t.tooltipPosition.left,"px"),o.Db(3),o.Oc(t.tooltipHeader),o.Db(1),o.pc("innerHTML",o.mc(5,8,t.tooltipContent,"html"),o.Dc)}}let Le=(()=>{class t extends te.a{constructor(t,e){super(),this.cdr=t,this.chartBoxExpansionService=e,this.options$=new et.a(null),this.series$=new et.a([]),this.uniqueId="0",this.destroy$=new h.a,this.tooltipXCoordinate$=new et.a(null),this.maxLabelYPrimaryWidth=0,this.maxLabelYSecondaryWidth=0,this.fontSize=14,this.marginBetweenAxisLabelsAndTitle=15,this.rotationDegree=-20,this.tooltipPosition={left:0,top:0},this.tooltipContent="",this.tooltipHeader="",this.estimate=[],this.estimateCoords=[],this.legendSeriesMap=new Map,this.drawingSeries=new Array,this.formattedBarSeries=[],this.selectedSeriesKey=!1,this.axisTypeEnum=ut.b,Object(it.a)(this.options$.asObservable(),this.series$.pipe(Object(b.a)(t=>!!t))).pipe(Object(X.a)(this.destroy$),Object(nt.a)(250)).subscribe(([t,e])=>{this.pristineOptions=t,this.drawingSeries=e.map(e=>{const i=e;return i.data.map(e=>{const i=e;return i.label=this.dateParse(e.label,t),i}),i}),this.drawingSeries.forEach(t=>this.legendSeriesMap.set(t.key,t)),this.existBarSeries=this.drawingSeries.filter(t=>this.getSeriesOptions(t.key).chartType===ut.d.VerticalBar).length>0,this.existLineSeries=this.drawingSeries.filter(t=>this.getSeriesOptions(t.key).chartType!==ut.d.VerticalBar).length>0,this.existBarSeries&&(this.formattedBarSeries=this.convertBarData(this.drawingSeries.filter(t=>this.getSeriesOptions(t.key).chartType===ut.d.VerticalBar))),this.drawingSeries.length>0&&this.drawChart(this.drawingSeries,this.pristineOptions),setTimeout(()=>this.cdr.detectChanges())}),this.chartBoxExpansionService.expand.pipe(Object(X.a)(this.destroy$)).subscribe(t=>{setTimeout(()=>{this.uniqueId===t.containerKey&&(this.drawChart(this.drawingSeries,this.pristineOptions),this.cdr.detectChanges())},t.delay)})}set _options(t){this.options$.next(t)}set _seriesData(t){this.series$.next(t)}shiftPushed(){this.shiftState=!0}shiftReleased(){this.shiftState=!1}ngOnInit(){this.tooltipXCoordinate$.pipe(Object(b.a)(t=>null!==t),Object(X.a)(this.destroy$)).subscribe(t=>{this.tooltipContent=this.getTooltipContent(t)})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}ngAfterViewInit(){this.context=this.canvas.nativeElement.getContext("2d"),this.context.font=this.fontSize+"px Ubuntu"}drawChart(t,e){Jt.w(this.plotContainer.nativeElement).attr("clip-path","url(#clip"+this.uniqueId+")"),this.setUniqueAxisValues(t),this.context.font=this.fontSize+"px Ubuntu",this.maxLabelYPrimaryWidth=this.marginBetweenAxisLabelsAndTitle+this.getMaxWidth(this.yPrimaryValues,e.yAxisType),this.maxLabelYSecondaryWidth=this.marginBetweenAxisLabelsAndTitle+this.getMaxWidth(this.ySecondaryValues,e.yAxisType),this.padding.left=0,this.padding.left+=this.maxLabelYPrimaryWidth!==-1/0?this.maxLabelYPrimaryWidth:10,this.padding.left+=e.yAxisTitle?this.fontSize:0,this.padding.right=0,this.padding.right+=this.maxLabelYSecondaryWidth!==-1/0?this.maxLabelYSecondaryWidth:10,this.padding.right+=e.secondaryYAxisTitle?this.fontSize:0,this.padding.bottom=e.xAxisTitle?50:30,this.padding.bottom+=this.needRotateAxisLabel()?this.getMaxWidth(this.xPrimaryValues,e.xAxisType)*Math.cos(this.rotationDegree*Math.PI/180):0;const i=this.chartContainer.nativeElement.getBoundingClientRect().width-this.padding.left-this.padding.right,a=this.chartContainer.nativeElement.getBoundingClientRect().height-this.padding.top-this.padding.bottom;this.plotProps.width=i!==1/0?i:0,this.plotProps.height=a!==1/0?a:0,this.leftAxisTitleTranslate=(this.plotProps.height+this.context.measureText(e.yAxisTitle).width)/2,this.rightAxisTitleTranslate=(this.plotProps.height-this.context.measureText(e.secondaryYAxisTitle).width)/2,this.bottomAxisTranslate=(this.plotProps.width-this.context.measureText(e.xAxisTitle).width)/2,this.createScales(e),this.createAxis(e),this.appendAxis(),this.addGridLines(e),this.addMouseMoveRect(),this.setEstimate(),this.existBarSeries&&(this.createSubgroupScale(),this.drawBars()),setTimeout(()=>this.commonDraw(!0,t)),e.showTimeline&&(this.addZoom(),this.addTimelineAxis(this.axisTimelineBottom,e),Jt.w(this.axisTimelineBottom.nativeElement).selectAll("text").attr("transform",this.needRotateAxisLabel()?"rotate("+this.rotationDegree+")":null).style("text-anchor",this.needRotateAxisLabel()?"end":"middle"),this.drawTimeline(t))}brushed(){if(Jt.n&&Jt.n.sourceEvent&&"zoom"===Jt.n.sourceEvent.type)return;const t=Jt.n&&Jt.n.selection||this.xTimelineScale.range();this.xPrimaryScale.domain(t.map(this.xTimelineScale.invert,this.xTimelineScale)),this.createAxis(this.pristineOptions),Jt.w(this.axisBottom.nativeElement).call(this.xPrimaryAxis).selectAll("text").attr("transform",this.needRotateAxisLabel()?"rotate("+this.rotationDegree+")":null).style("text-anchor",this.needRotateAxisLabel()?"end":"middle"),Jt.w(this.timeContextBrush.nativeElement).selectAll(".handle--custom").attr("transform",e=>"w"===e?"translate("+t[0]+", 0)":"translate("+t[1]+", 0)"),Jt.w(this.timeContextBrush.nativeElement).selectAll(".handle--mini").attr("transform",e=>"w"===e?"translate("+(t[0]-2)+", 12)":"translate("+(t[1]-2)+", 12)"),this.commonDraw(!1,this.drawingSeries.filter(t=>this.legendSeriesMap.has(t.key))),Jt.w(this.zoomContainer.nativeElement).call(this.zoom.transform,Jt.I.scale(this.plotProps.width/(t[1]-t[0])).translate(-t[0],0))}zoomed(){if(this.shiftState){if(Jt.n.sourceEvent&&"brush"===Jt.n.sourceEvent.type)return;const t=Jt.n.transform;this.xPrimaryScale.domain(t.rescaleX(this.xTimelineScale).domain()),this.commonDraw(!1,this.drawingSeries.filter(t=>this.legendSeriesMap.has(t.key))),this.createAxis(this.pristineOptions),Jt.w(this.axisBottom.nativeElement).call(this.xPrimaryAxis).selectAll("text").attr("transform",this.needRotateAxisLabel()?"rotate("+this.rotationDegree+")":null).style("text-anchor",this.needRotateAxisLabel()?"end":"middle"),Jt.w(this.timeContextBrush.nativeElement).call(this.brush.move,this.xPrimaryScale.range().map(t.invertX,t)).selectAll("rect").attr("transform","translate("+this.padding.left+",0)")}}addMouseMoveRect(){Jt.w(this.zoomContainer.nativeElement).style("fill","none").style("pointer-events","all").attr("width",this.plotProps.width).attr("height",this.plotProps.height).on("mousemove",()=>this.showTooltipLine()).on("mouseleave",()=>this.hideTooltipLine())}appendAxis(){this.xPrimaryAxis&&Jt.w(this.axisBottom.nativeElement).transition().duration(800).call(this.xPrimaryAxis).selectAll("text").attr("transform",this.needRotateAxisLabel()?"rotate("+this.rotationDegree+")":null).style("text-anchor",this.needRotateAxisLabel()?"end":"middle"),this.xSecondaryAxis&&Jt.w(this.axisTop.nativeElement).transition().duration(800).call(this.xSecondaryAxis),this.yPrimaryAxis&&Jt.w(this.axisLeft.nativeElement).transition().duration(800).call(this.yPrimaryAxis),this.ySecondaryAxis&&Jt.w(this.axisRight.nativeElement).transition().duration(800).call(this.ySecondaryAxis)}createSubgroupScale(){const t=this.drawingSeries.filter(t=>this.getSeriesOptions(t.key).chartType===ut.d.VerticalBar).map(t=>t.key);this.xSubgroupScale=t.length>1?Jt.t().domain(t).range([0,this.xPrimaryScale.bandwidth()]).paddingInner(.25).paddingOuter(.3):Jt.t().domain(t).range([0,this.xPrimaryScale.bandwidth()]).paddingOuter(.25)}commonDraw(t,e){Jt.w(this.linesContainer.nativeElement).selectAll(".dots").remove(),Jt.w(this.linesContainer.nativeElement).selectAll(".dots-bg").remove(),Jt.w(this.linesContainer.nativeElement).selectAll("path").remove(),Object.keys(ut.d).filter(t=>/^[0-9]+$/.test(t)).map(t=>+t).filter(t=>t!==ut.d.VerticalBar).forEach(i=>{let a,n,s;const r=e.filter(t=>this.getSeriesOptions(t.key).chartType===i);if(t&&r.length>0)switch(a=Jt.w(this.linesContainer.nativeElement).append("g").attr("class",ut.d[i]),i){case ut.d.Line:case ut.d.Spline:n=a.selectAll(".spline-line").data(r).enter().append("path").attr("class",t=>t.key+" spline-line").attr("d",t=>this.drawLine(t.data,this.getSeriesOptions(t.key).yAxis,!0,i===ut.d.Spline)).attr("fill","none").attr("stroke",t=>this.getColorByKey(t.key)).attr("stroke-width",2).style("opacity",1).on("mousemove",()=>this.showTooltipLine()).on("mouseleave",()=>this.hideTooltipLine()),n.each((function(t){t.totalLength=this.getTotalLength()})).attr("stroke-dasharray",t=>t.totalLength+" "+t.totalLength).attr("stroke-dashoffset",t=>t.totalLength).transition().duration(2e3).attr("stroke-dashoffset",0);break;case ut.d.Area:case ut.d.AreaSpline:s=a.selectAll(".areaFill").data(r).enter().append("path").attr("class",t=>t.key+" areaFill").attr("fill",t=>this.getColorByKey(t.key)).attr("stroke",t=>this.getColorByKey(t.key)).attr("stroke-width",4).style("opacity",.2).attr("d",t=>this.drawArea(t.data,this.getSeriesOptions(t.key).yAxis,!1,i===ut.d.AreaSpline)).on("mousemove",()=>this.showTooltipLine()).on("mouseleave",()=>this.hideTooltipLine()).transition().duration(2e3).attr("d",t=>this.drawArea(t.data,this.getSeriesOptions(t.key).yAxis,!0,i===ut.d.AreaSpline)),n=a.selectAll(".areaContour").data(r).enter().append("path").attr("class",t=>t.key+" areaContour").attr("fill","none").attr("stroke",t=>this.getColorByKey(t.key)).attr("stroke-width",2).style("opacity",1).attr("d",t=>this.drawLine(t.data,this.getSeriesOptions(t.key).yAxis,!0,i===ut.d.AreaSpline)).transition().duration(2e3).attr("d",t=>this.drawLine(t.data,this.getSeriesOptions(t.key).yAxis,!0,i===ut.d.AreaSpline));break;case ut.d.Confidence:s=a.selectAll(".areaFill").data(r).enter().append("path").attr("class",t=>t.key+" areaFill").attr("fill",t=>this.getColorByKey(t.key)).attr("stroke",t=>this.getColorByKey(t.key)).attr("stroke-width",4).style("opacity",.2).attr("d",t=>this.drawConfidenceArea(t.data,this.getSeriesOptions(t.key).yAxis,!1,i!==ut.d.Confidence)).on("mousemove",()=>this.showTooltipLine()).on("mouseleave",()=>this.hideTooltipLine()).transition().duration(2e3).attr("d",t=>this.drawConfidenceArea(t.data,this.getSeriesOptions(t.key).yAxis,!0,i!==ut.d.Confidence)),n=a.selectAll(".spline-line").data(r).enter().append("path").attr("class",t=>t.key+" spline-line").attr("d",t=>this.drawLineConfidence(t.data,this.getSeriesOptions(t.key).yAxis,!0,i!==ut.d.Confidence)).attr("fill","none").attr("stroke",t=>this.getColorByKey(t.key)).attr("stroke-width",2).style("opacity",1).on("mousemove",()=>this.showTooltipLine()).on("mouseleave",()=>this.hideTooltipLine()),n.each((function(t){t.totalLength=this.getTotalLength()})).attr("stroke-dasharray",t=>t.totalLength+" "+t.totalLength).attr("stroke-dashoffset",t=>t.totalLength).transition().duration(2e3).attr("stroke-dashoffset",0)}else if(r.length>0)switch(a=Jt.w(this.linesContainer.nativeElement).select("."+ut.d[i]),i){case ut.d.Line:case ut.d.Spline:n=a.selectAll(".spline-line").data(r).enter().append("path").attr("d",t=>this.drawLine(t.data,this.getSeriesOptions(t.key).yAxis,!0,i===ut.d.Spline)).attr("class",t=>t.key+" spline-line").attr("fill","none").attr("stroke",t=>this.getColorByKey(t.key)).attr("stroke-width",2).attr("stroke-dashoffset",0).attr("stroke-dasharray",t=>this.getStrokeDasharray(t.key)).attr("stroke-dashoffset",t=>this.getStrokeDashoffset(t.key)).on("mousemove",()=>this.showTooltipLine()).on("mouseleave",()=>this.hideTooltipLine());break;case ut.d.Area:case ut.d.AreaSpline:s=a.selectAll(".areaFill").data(r).enter().append("path").attr("class",t=>t.key+" areaFill").attr("fill",t=>this.getColorByKey(t.key)).attr("stroke",t=>this.getColorByKey(t.key)).attr("stroke-width",4).style("opacity",.2).attr("d",t=>this.drawArea(t.data,this.getSeriesOptions(t.key).yAxis,!0,i===ut.d.AreaSpline)).on("mousemove",()=>this.showTooltipLine()).on("mouseleave",()=>this.hideTooltipLine()),n=a.selectAll(".areaContour").data(r).enter().append("path").attr("class",t=>t.key+" areaContour").attr("fill","none").attr("stroke",t=>this.getColorByKey(t.key)).attr("stroke-width",2).attr("stroke-dasharray",t=>this.getStrokeDasharray(t.key)).attr("stroke-dashoffset",t=>this.getStrokeDashoffset(t.key)).style("opacity",1).attr("d",t=>this.drawLine(t.data,this.getSeriesOptions(t.key).yAxis,!0,i===ut.d.AreaSpline))}r.forEach(t=>{Jt.w(this.linesContainer.nativeElement).append("g").classed("dots-bg "+t.key,!0).selectAll("circle").data(t.data).enter().append("circle").classed("dot-line-background",!0).attr("fill",e=>this.getColorByKey(t.key)).attr("cx",t=>this.xPrimaryScale(t.label)).attr("cy",e=>this.getSeriesOptions(t.key).yAxis===ut.a.Primary?this.yPrimaryScale(e.value):this.ySecondaryScale(e.value)).attr("r",8).attr("fill-opacity",0),Jt.w(this.linesContainer.nativeElement).append("g").classed("dots "+t.key,!0).selectAll("circle").data(t.data).enter().append("circle").classed("dot-line",!0).attr("fill",e=>this.getColorByKey(t.key)).attr("cx",t=>this.xPrimaryScale(t.label)).attr("cy",e=>this.getSeriesOptions(t.key).yAxis===ut.a.Primary?this.yPrimaryScale(e.value):this.ySecondaryScale(e.value)).attr("r",2).attr("stroke","white").attr("stroke-width",.1)})})}drawTimeline(t){t&&(Jt.w(this.timeContextLine.nativeElement).selectAll("path").remove(),Jt.w(this.timeContextLine.nativeElement).selectAll("path").data(t).enter().append("path").attr("class",t=>t.key+" timeline").attr("d",(t,e)=>this.drawContextLine(t.data,e)).attr("fill","none").attr("stroke",t=>this.getColorByKey(t.key)).attr("stroke-width",2).style("opacity",1))}drawLine(t,e,i=!0,a=!1){if(!t)return;const n=this.xPrimaryScale,s=e===ut.a.Primary?this.yPrimaryScale:this.ySecondaryScale;return Jt.p().curve(a?Jt.j:Jt.i).x(t=>n(t.label)).y(t=>s(i?t.value:0))(t)}drawContextLine(t,e){return Jt.p().x(t=>this.xTimelineScale(t.label)).y(t=>this.yTimelineScale(t.value))(t)}drawArea(t,e,i,a=!1){const n=this.xPrimaryScale,s=e===ut.a.Primary?this.yPrimaryScale:this.ySecondaryScale;return Jt.a().curve(a?Jt.j:Jt.i).x(t=>n(t.label)).y(s(0)).y1(t=>s(i?t.value:0))(t)}drawLineConfidence(t,e,i=!0,a=!1){if(!t)return;const n=this.xPrimaryScale,s=e===ut.a.Primary?this.yPrimaryScale:this.ySecondaryScale;return Jt.p().curve(a?Jt.j:Jt.i).x(t=>n(t.label)).y(t=>s(i?t.value:0))(t)}drawConfidenceArea(t,e,i,a=!1){const n=this.xPrimaryScale,s=e===ut.a.Primary?this.yPrimaryScale:this.ySecondaryScale;return Jt.a().curve(a?Jt.j:Jt.i).x(t=>n(t.label)).y(t=>i?s(t.value)-(t.stdError?t.stdError:1)*(t.tValue?t.tValue:1):s(0)).y1(t=>i?s(t.value)+(t.stdError?t.stdError:1)*(t.tValue?t.tValue:1):s(0))(t)}drawBars(){const t=Jt.w(this.barsContainer.nativeElement).selectAll("g").data(this.formattedBarSeries,t=>t.label);t.exit().remove();const e=t.enter().append("g").merge(t).attr("transform",t=>"translate("+this.xPrimaryScale(t.label)+", 0)").merge(t).selectAll("rect").data(t=>t.values);e.exit().remove(),e.enter().append("rect").merge(e).attr("class",t=>t.key+" v-bars").attr("x",t=>this.xSubgroupScale(t.key)).attr("width",this.xSubgroupScale.bandwidth()).attr("fill",t=>this.getColorByKey(t.key)).attr("y",t=>this.plotProps.height).attr("height",this.yPrimaryScale(0)).on("mouseover",t=>this.showTooltipRect(t)).on("mouseleave",t=>this.hideTooltipRect()).transition().duration(800).ease(Jt.m).attr("y",t=>this.yPrimaryScale(t.value)===this.plotProps.height?this.plotProps.height-1:this.yPrimaryScale(t.value)).attr("height",t=>this.plotProps.height-this.yPrimaryScale(t.value)==0?1:this.plotProps.height-this.yPrimaryScale(t.value))}convertBarData(t){const e=[];return t.forEach(t=>t.data.forEach((i,a)=>{0===e.filter(t=>t.label===i.label).length&&e.push({label:i.label,values:[]}),e.filter(t=>t.label===i.label)[0].values.push({key:t.key,value:i.value})})),e}needRotateAxisLabel(){let t=this.xPrimaryValues;if(this.options$.getValue().xAxisType===ut.b.Date){const e=this.xPrimaryValues.map(t=>new Date(+t)),i=Math.max.apply(null,e),a=Math.min.apply(null,e),n=Math.abs(i-a)/864e5;t=t.map(t=>n>365?new Date(+t).toLocaleDateString("ru-RU"):new Date(+t).toLocaleDateString("ru-RU").slice(0,-5))}const e=(this.chartContainer.nativeElement.getBoundingClientRect().width-this.padding.left-this.padding.right)/this.calculateTickCount(t),i=Math.max(...t.map(t=>this.context.measureText(t).width));return i>e||!(!this.xPrimaryScale||this.options$.getValue().xAxisType!==ut.b.Date)&&this.getMinimalTickDistance(this.xPrimaryScale)<i}showTooltipLine(){if(this.existLineSeries){const t=Jt.r(Jt.n.target)[0],e=this.drawingSeries.reduce((t,e)=>t.concat(e.data),[]).map(t=>t.label);let i=null,a=1/0;e.forEach(e=>{const n=Math.abs(t-this.xPrimaryScale(e));n<a&&(a=n,i=e)});const n=this.xPrimaryScale(i),s=this.tooltipRef.nativeElement.getBoundingClientRect(),r=this.getNearestSeriesKey(Jt.r(Jt.n.target)[1],i),o=this.drawingSeries.find(t=>t.key===r),l=o.data.find(t=>this.pristineOptions.xAxisType===ut.b.Date?new Date(+t.label).getTime()===new Date(+i).getTime():t.label===i).value,c=this.getSeriesOptions(o.key).yAxis===ut.a.Primary?this.yPrimaryScale(l):this.ySecondaryScale(l);this.tooltipPosition.left=n+this.padding.left-s.width/2+(this.pristineOptions.xAxisType===ut.b.Text?this.xPrimaryScale.bandwidth()/2:0),this.tooltipPosition.top=c-s.height+10,this.cdr.detectChanges(),this.tooltipXCoordinate$.next(i),Jt.w(this.linesContainer.nativeElement).selectAll("path").filter((function(){this.classList.contains(o.key)?(this.setAttribute("style","opacity:1"),this.classList.contains("areaFill")&&this.setAttribute("style","opacity:0.5")):this.setAttribute("style","opacity:0.2")})),Jt.w(this.linesContainer.nativeElement).selectAll(".dots-bg").selectAll("circle").attr("fill-opacity",0),Jt.w(".dots-bg."+o.key).selectAll("circle").attr("fill-opacity",t=>t.label instanceof Date&&i instanceof Date?t.label.getTime()===i.getTime()?.25:0:t.label===i?.25:0),Jt.w(this.linesContainer.nativeElement).selectAll(".dots").filter((function(){this.classList.contains(o.key)?Jt.w(this).selectAll("circle").attr("opacity",1).attr("r",t=>t.label instanceof Date&&i instanceof Date?t.label.getTime()===i.getTime()?4:2:t.label===i?4:2):Jt.w(this).selectAll("circle").attr("opacity",.2).attr("r",2)}))}}showTooltipRect(t){if(this.existBarSeries){const e=Jt.n.target.getBoundingClientRect();this.selectedSeriesKey=!0;const i=this.drawingSeries.filter(e=>e.key===t.key)[0];this.tooltipContent="",this.getSeriesOptions(i.key).name?this.tooltipContent=this.getSeriesOptions(i.key).name+": <strong>"+this.formatValue(t.value)+"</strong>":this.tooltipContent+=this.formatValue(t.value)+"",this.cdr.detectChanges(),Jt.w(this.barsContainer.nativeElement).selectAll("rect").filter((function(){this.classList.contains(i.key)?this.setAttribute("style","opacity:1"):this.setAttribute("style","opacity:0.2")}));const a=this.tooltipRefBar.nativeElement.getBoundingClientRect();this.tooltipPosition.top=e.top-a.height-6,this.tooltipPosition.left=e.left+e.width/2-a.width/2,this.cdr.detectChanges()}}hideTooltipRect(){this.selectedSeriesKey=!1,Jt.w(this.barsContainer.nativeElement).selectAll("rect").filter((function(){this.classList.contains("v-bars")&&this.setAttribute("style","opacity:1")})),this.cdr.detectChanges()}hideTooltipLine(){this.tooltipXCoordinate$.next(null),Jt.w(this.linesContainer.nativeElement).selectAll("path").filter((function(t,e){this.classList.contains("areaContour")&&this.setAttribute("style","opacity:1"),this.classList.contains("areaFill")&&this.setAttribute("style","opacity:0.2"),this.classList.contains("spline-line")&&this.setAttribute("style","opacity:1")})),Jt.w(this.linesContainer.nativeElement).selectAll(".dots").filter((function(){Jt.w(this).selectAll("circle").attr("opacity",1).attr("r",2)}))}getNearestSeriesKey(t,e){const i=[];return this.drawingSeries.length?(this.drawingSeries.filter(t=>this.legendSeriesMap.has(t.key)).map(a=>a.data.filter(t=>this.pristineOptions.xAxisType===ut.b.Date?new Date(+t.label).getTime()===new Date(+e).getTime():t.label===e).forEach(e=>i.push({key:a.key,value:Math.abs(t-(this.getSeriesOptions(a.key).yAxis===ut.a.Primary?this.yPrimaryScale(e.value):this.ySecondaryScale(e.value)))}))),i.sort((t,e)=>t.value>e.value?1:-1)[0].key):null}getTooltipContent(t){if(!this.series$.getValue()||!t)return"";this.tooltipHeader=this.pristineOptions.xAxisType===ut.b.Date?new Date(+t).toLocaleDateString("ru-RU"):t;let e="",i=0,a="",n=0;return this.drawingSeries.forEach(s=>{var r,o;const l=s.data.filter(e=>this.pristineOptions.xAxisType===ut.b.Date?new Date(+e.label).getTime()===new Date(+t).getTime():e.label===t)[0].value;s instanceof dt.c&&(i=null===(r=s.data.filter(e=>this.pristineOptions.xAxisType===ut.b.Date?new Date(+e.label).getTime()===new Date(+t).getTime():e.label===t)[0])||void 0===r?void 0:r.stdError,n=null===(o=s.data.filter(e=>this.pristineOptions.xAxisType===ut.b.Date?new Date(+e.label).getTime()===new Date(+t).getTime():e.label===t)[0])||void 0===o?void 0:o.tValue),a=0!==i&&0!==n?'<br><span style="margin: 0 3px; color:'+this.getColorByKey(s.key)+'">\u25cf</span>Upper endpoint: <b>'+(l+i*n<10?Math.round(10*(l+i*n))/10:Math.round(l+i*n))+'</b><br><span style="margin: 0 3px; color:'+this.getColorByKey(s.key)+'">\u25cf</span>Lower endpoint: <b>'+(l-i*n<10?Math.round(10*(l-i*n))/10:Math.round(l-i*n))+"</b>":"",e+='<li><span style="margin: 0 3px; color:'+this.getColorByKey(s.key)+'">\u25cf</span>'+this.getSeriesOptions(s.key).name+": <b>"+(l<10?Math.round(10*l)/10:Math.round(l))+"</b>"+a}),e}toggleSeries(t){if(this.legendSeriesMap.has(t))this.legendSeriesMap.delete(t);else{const e=this.drawingSeries.find(e=>e.key===t);this.legendSeriesMap.set(e.key,e)}this.setUniqueAxisValues(this.drawingSeries.filter(t=>this.legendSeriesMap.has(t.key))),this.yPrimaryScale=this.yPrimaryScale?this.setYScale(this.plotProps.height,this.yPrimaryValues,this.options$.getValue().yAxisType):null,this.ySecondaryScale=this.ySecondaryScale?this.setYScale(this.plotProps.height,this.ySecondaryValues,this.options$.getValue().secondaryYAxisType):null,this.yPrimaryScale&&(this.yPrimaryAxis=Jt.d(this.yPrimaryScale)),this.ySecondaryScale&&(this.ySecondaryAxis=Jt.e(this.ySecondaryScale)),this.yPrimaryAxis&&Jt.w(this.axisLeft.nativeElement).transition().duration(800).call(this.yPrimaryAxis),this.ySecondaryAxis&&Jt.w(this.axisRight.nativeElement).transition().duration(800).call(this.ySecondaryAxis),this.existBarSeries=this.drawingSeries.filter(t=>this.getSeriesOptions(t.key).chartType===ut.d.VerticalBar&&this.legendSeriesMap.has(t.key)).length>0,this.existBarSeries&&(this.formattedBarSeries=this.convertBarData(this.drawingSeries.filter(t=>this.getSeriesOptions(t.key).chartType===ut.d.VerticalBar&&this.legendSeriesMap.has(t.key)))),this.existBarSeries?(this.createSubgroupScale(),this.drawBars()):this.clearBars(),this.commonDraw(!1,this.drawingSeries.filter(t=>this.getSeriesOptions(t.key).chartType!==ut.d.VerticalBar&&this.legendSeriesMap.has(t.key)))}clearBars(){Jt.w(this.barsContainer.nativeElement).selectAll("g").remove()}getColorByKey(t){const e=this.drawingSeries.findIndex(e=>e.key===t);return-1===e?"#000":this.colorPalette[e%this.colorPalette.length]}formatValue(t){return Math.round(100*t)/100}getMaxWidth(t,e){if(e===ut.b.Date){const e=t.map(t=>new Date(+t)),i=Math.max.apply(null,e),a=Math.min.apply(null,e),n=Math.abs(i-a)/864e5;t=t.map(t=>n>365?new Date(+t).toLocaleDateString("ru-RU"):new Date(+t).toLocaleDateString("ru-RU").slice(0,-5))}return Math.max(...t.map(t=>isNaN(+t)?this.context.measureText(t).width:this.context.measureText(Math.round(10*+t)/10+"").width))+5+5}setEstimate(){this.pristineOptions.showEstimate&&this.pristineOptions.xAxisType===ut.b.Numeric&&this.pristineOptions.yAxisType===ut.b.Numeric&&(this.estimate=this.drawingSeries.map(t=>Math.floor(100*t.data.map(t=>t.value*t.label).reduce((t,e)=>t+e))/100),this.estimateCoords=this.estimate.map((t,e)=>this.getXScale(t,this.drawingSeries[e].data,this.pristineOptions,this.plotProps.width)))}randomizeFloat(t,e){if(null==e&&(e=null==t?Number.MAX_VALUE:t,t=0),t>=e)throw new Error("Incorrect arguments.");return t+(e-t)*this.randomizeValue()}randomizeValue(){var t=(1+1e-15)*Math.random();return t>1?1:t}}return t.\u0275fac=function(e){return new(e||t)(o.Rb(o.h),o.Rb(ct.a))},t.\u0275cmp=o.Lb({type:t,selectors:[["m-d3-plot"]],viewQuery:function(t,e){var i;1&t&&(o.Ic(ie,!0),o.Ic(ae,!0),o.Ic(ne,!0),o.Ic(se,!0),o.Ic(re,!0),o.Ic(oe,!0),o.Ic(le,!0),o.Ic(ce,!0),o.Ic(he,!0),o.Ic(pe,!0),o.Ic(de,!0),o.Ic(me,!0),o.Ic(ue,!0),o.Sc(ge,!0),o.Sc(be,!0),o.Sc(fe,!0),o.Sc(ye,!0),o.Sc(xe,!0),o.Sc(ve,!0),o.Sc(we,!0)),2&t&&(o.xc(i=o.gc())&&(e.chartContainer=i.first),o.xc(i=o.gc())&&(e.plotContainer=i.first),o.xc(i=o.gc())&&(e.barsContainer=i.first),o.xc(i=o.gc())&&(e.mouseMoveRect=i.first),o.xc(i=o.gc())&&(e.linesContainer=i.first),o.xc(i=o.gc())&&(e.axisBottom=i.first),o.xc(i=o.gc())&&(e.axisTop=i.first),o.xc(i=o.gc())&&(e.axisLeft=i.first),o.xc(i=o.gc())&&(e.axisRight=i.first),o.xc(i=o.gc())&&(e.xGrid=i.first),o.xc(i=o.gc())&&(e.yGrid=i.first),o.xc(i=o.gc())&&(e.axisTimelineBottom=i.first),o.xc(i=o.gc())&&(e.axisTimelineLeft=i.first),o.xc(i=o.gc())&&(e.timeContext=i.first),o.xc(i=o.gc())&&(e.timeContextLine=i.first),o.xc(i=o.gc())&&(e.timeContextBrush=i.first),o.xc(i=o.gc())&&(e.zoomContainer=i.first),o.xc(i=o.gc())&&(e.canvas=i.first),o.xc(i=o.gc())&&(e.tooltipRef=i.first),o.xc(i=o.gc())&&(e.tooltipRefBar=i.first))},hostBindings:function(t,e){1&t&&o.fc("keydown.shift",(function(){return e.shiftPushed()}),!1,o.Ac)("keyup.shift",(function(){return e.shiftReleased()}),!1,o.Ac)},inputs:{_options:["options","_options"],_seriesData:["data","_seriesData"],uniqueId:"uniqueId"},features:[o.Ab],decls:58,vars:51,consts:[[1,"d3-chart-wrapper"],[4,"ngIf"],[1,"block-relative"],["chartContainer",""],[3,"id"],[1,"inner"],["inner",""],["class","tooltip-line",4,"ngIf"],["class","axis-bottom-title",4,"ngIf"],["class","axis-left-title",4,"ngIf"],["class","axis-right-title",4,"ngIf"],[1,"axis","axis-x-bottom"],["axisBottom",""],[1,"axis","axis-x-top"],["axisTop",""],[1,"x-grid"],["xGrid",""],[1,"axis","axis-y-left"],["axisLeft",""],[1,"axis","axis-y-right"],["axisRight",""],[1,"y-grid"],["yGrid",""],[1,"plot"],["plotContainer",""],["zoomContainer",""],[1,"bars"],["barsContainer",""],[1,"lines"],["linesContainer",""],["timecontext",""],[1,"context"],["timecontextLine",""],[1,"brush"],["timecontextBrush",""],[1,"axis"],["axisContextBottom",""],["axisContextLeft",""],["class","tooltip-container-down",3,"opacity","top","left",4,"ngIf"],["class","tooltip-container-bar",3,"opacity","top","left",4,"ngIf"],[2,"display","none"],["measureCanvas",""],[1,"d3-legend-wrapper"],[1,"d3-legend-container"],["class","d3-legend-item",3,"click",4,"ngFor","ngForOf"],[1,"d3-legend-item",3,"click"],[1,"d3-legend-icon"],[1,"d3-legend-text"],[1,"tooltip-line"],[1,"axis-bottom-title"],[1,"axis-left-title"],[1,"axis-right-title"],["estimateContainer",""],[4,"ngFor","ngForOf"],["width","5","height","15",3,"id"],[1,"tooltip-container-down"],["tooltipContainer",""],[1,"tooltip-header"],[3,"innerHTML"],[1,"tooltip-container-bar"],["tooltipContainerBar",""]],template:function(t,e){1&t&&(o.Xb(0,"div",0),o.Lc(1,Ce,3,3,"ng-container",1),o.Xb(2,"div",2),o.ic(),o.Xb(3,"svg",null,3),o.Xb(5,"defs"),o.Xb(6,"clipPath",4),o.Sb(7,"rect"),o.Wb(),o.Wb(),o.Xb(8,"g",5,6),o.Lc(10,Pe,3,3,"g",7),o.kc(11,"async"),o.kc(12,"async"),o.Lc(13,Oe,4,4,"g",8),o.kc(14,"async"),o.Lc(15,Me,4,4,"g",9),o.kc(16,"async"),o.Lc(17,De,4,4,"g",10),o.kc(18,"async"),o.Sb(19,"g",11,12),o.Sb(21,"g",13,14),o.Sb(23,"g",15,16),o.Sb(25,"g",17,18),o.Sb(27,"g",19,20),o.Sb(29,"g",21,22),o.Xb(31,"g",23,24),o.Sb(33,"rect",null,25),o.Sb(35,"g",26,27),o.Sb(37,"g",28,29),o.kc(39,"async"),o.Wb(),o.Lc(40,Te,3,1,"g",1),o.kc(41,"async"),o.Wb(),o.Wb(),o.Xb(42,"svg",null,30),o.kc(44,"async"),o.Xb(45,"g",31),o.Sb(46,"g",28,32),o.Sb(48,"g",33,34),o.Sb(50,"g",35,36),o.Sb(52,"g",35,37),o.Wb(),o.Wb(),o.Lc(54,Xe,7,13,"div",38),o.Lc(55,_e,6,11,"div",39),o.Wb(),o.Wb(),o.hc(),o.Sb(56,"canvas",40,41)),2&t&&(o.Db(1),o.pc("ngIf",e.drawingSeries.length>1),o.Db(2),o.Kc("width","100%")("height",450,"px"),o.Db(3),o.pc("id","clip"+e.uniqueId),o.Db(1),o.Eb("width",e.plotProps.width)("height",e.plotProps.height),o.Db(1),o.Kc("height",e.plotProps.height,"px")("width",e.plotProps.width,"px"),o.Eb("transform","translate("+e.padding.left+","+e.padding.top+")"),o.Db(2),o.pc("ngIf",!!o.lc(11,35,e.series$)&&o.lc(12,37,e.series$).length),o.Db(3),o.pc("ngIf",o.lc(14,39,e.options$).xAxisTitle),o.Db(2),o.pc("ngIf",o.lc(16,41,e.options$).yAxisTitle),o.Db(2),o.pc("ngIf",o.lc(18,43,e.options$).secondaryYAxisTitle),o.Db(2),o.Eb("transform","translate(0,"+e.plotProps.height+")"),o.Db(4),o.Eb("transform","translate(0,"+e.plotProps.height+")"),o.Db(4),o.Eb("transform","translate("+e.plotProps.width+", 0)"),o.Db(6),o.Kc("width","100%"),o.Eb("fill","transparent"),o.Db(4),o.Eb("transform",o.lc(39,45,e.options$).xAxisType===e.axisTypeEnum.Text&&e.xPrimaryScale?"translate("+e.xPrimaryScale.bandwidth()/2+",0)":"translate(0,0)"),o.Db(3),o.pc("ngIf",o.lc(41,47,e.options$).showEstimate),o.Db(2),o.Kc("width","100%")("height","90px")("display",o.lc(44,49,e.options$).showTimeline?"block":"none"),o.Db(3),o.Eb("transform","translate("+e.padding.left+",0)"),o.Db(5),o.Eb("transform","translate(0,40)"),o.Db(4),o.pc("ngIf",e.drawingSeries.length&&e.existLineSeries),o.Db(1),o.pc("ngIf",e.drawingSeries.length&&e.existBarSeries))},directives:[a.m,a.l],pipes:[a.b,ee.a],styles:[".d3-plot[_ngcontent-%COMP%]{font-style:normal;color:#000}.axis[_ngcontent-%COMP%]   path[_ngcontent-%COMP%]{stroke:#0f0f11;stroke-dasharray:none!important}.line[_ngcontent-%COMP%]   path[_ngcontent-%COMP%]{stroke-width:2;fill:none;-webkit-transition:stroke-width 125ms linear,opacity 125ms linear;transition:stroke-width 125ms linear,opacity 125ms linear}.area[_ngcontent-%COMP%]   path[_ngcontent-%COMP%]{opacity:.3;-webkit-transition:opacity 125ms linear;transition:opacity 125ms linear}.dot-line[_ngcontent-%COMP%]{-webkit-transition:opacity 125ms linear,r 125ms linear;transition:opacity 125ms linear,r 125ms linear}.dot-hovered[_ngcontent-%COMP%]{opacity:.35!important;-webkit-filter:drop-shadow(3px 3px 3px #fff);filter:drop-shadow(3px 3px 3px white)}.dot-hovered-inner[_ngcontent-%COMP%]{opacity:1;stroke:#fff;stroke-width:.5}.legend[_ngcontent-%COMP%]{text-decoration:underline;cursor:pointer;float:right}.legend-icon[_ngcontent-%COMP%], .legend-item[_ngcontent-%COMP%]{display:inline-block}.legend-icon[_ngcontent-%COMP%]{height:12px;width:12px;border-radius:50%;vertical-align:middle}.legend-text[_ngcontent-%COMP%]{font-weight:700;font-size:12px;line-height:14px;-webkit-text-decoration-line:underline;text-decoration-line:underline;vertical-align:middle;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.legend-text[_ngcontent-%COMP%]:hover{opacity:1!important}.block-relative[_ngcontent-%COMP%]{position:relative}"]}),t})();const Ee=["chartContainer"],Ie=["plotContainer"],$e=["boxContainer"],We=["axisBottom"],je=["axisLeft"],Ye=["xGrid"],ze=["yGrid"],Be=["axisContextBottom"],Re=["axisContextLeft"],Ne=["zoomContainer"],Fe=["tooltipContainer"],Ve=["tooltipContainerBar"],qe=["measureCanvas"];function Ke(t,e){1&t&&(o.Xb(0,"span",31),o.Nc(1,"Outliers on "),o.Wb()),2&t&&o.Kc("opacity",1)}function He(t,e){1&t&&(o.Xb(0,"span",31),o.Nc(1,"Outliers Off "),o.Wb()),2&t&&o.Kc("opacity",1)}function Ze(t,e){if(1&t){const t=o.Yb();o.Vb(0),o.Xb(1,"div",26),o.Xb(2,"div",27),o.Xb(3,"div",28),o.fc("click",(function(){return o.Cc(t),o.jc(2).toggleSeries()})),o.Sb(4,"span",29),o.Lc(5,Ke,2,2,"span",30),o.Lc(6,He,2,2,"span",30),o.Wb(),o.Wb(),o.Wb(),o.Ub()}if(2&t){const t=o.jc(2);o.Db(3),o.Kc("opacity",t.showPoint?1:.6),o.Db(1),o.Kc("background-color","#6bcaff"),o.Db(1),o.pc("ngIf",t.showPoint),o.Db(1),o.pc("ngIf",!t.showPoint)}}function Ue(t,e){if(1&t&&(o.Vb(0),o.Lc(1,Ze,7,6,"ng-container",1),o.kc(2,"async"),o.Ub()),2&t){const t=o.jc();o.Db(1),o.pc("ngIf",o.lc(2,1,t.options$).showLegend)}}function Qe(t,e){if(1&t&&(o.ic(),o.Xb(0,"g",32),o.Xb(1,"text"),o.Nc(2),o.kc(3,"async"),o.Wb(),o.Wb()),2&t){const t=o.jc();o.Eb("transform","translate("+t.bottomAxisTranslate+","+(t.plotProps.height+t.padding.bottom-10)+")"),o.Db(2),o.Oc(o.lc(3,2,t.options$).xAxisTitle)}}function Ge(t,e){if(1&t&&(o.ic(),o.Xb(0,"g",33),o.Xb(1,"text"),o.Nc(2),o.kc(3,"async"),o.Wb(),o.Wb()),2&t){const t=o.jc();o.Eb("transform","rotate(-90)  translate("+(0-t.leftAxisTitleTranslate)+","+(0-t.maxLabelYPrimaryWidth)+")"),o.Db(2),o.Oc(o.lc(3,2,t.options$).yAxisTitle)}}function Je(t,e){if(1&t&&(o.ic(),o.hc(),o.Xb(0,"div",34,35),o.kc(2,"async"),o.Xb(3,"span",36),o.Nc(4),o.Wb(),o.Sb(5,"ul",37),o.kc(6,"safe"),o.Wb()),2&t){const t=o.jc();o.Kc("opacity",o.lc(2,8,t.tooltipXCoordinate$)?".8":"0")("top",t.tooltipPosition.top,"px")("left",t.tooltipPosition.left,"px"),o.Db(4),o.Oc(t.tooltipHeader),o.Db(1),o.pc("innerHTML",o.mc(6,10,t.tooltipContent,"html"),o.Dc)}}let ti=(()=>{class t{constructor(t,e){this.cdr=t,this.chartBoxExpansionService=e,this.options$=new et.a(null),this.series$=new et.a(null),this.uniqueId="0",this.destroy$=new h.a,this.tooltipXCoordinate$=new et.a(null),this.pristineOptions={},this.monthSet=new Set(["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]),this.maxLabelYPrimaryWidth=0,this.maxLabelYSecondaryWidth=0,this.fontSize=14,this.marginBetweenAxisLabelsAndTitle=15,this.rotationDegree=-20,this.tooltipPosition={left:0,top:0},this.tooltipContent="",this.tooltipHeader="",this.leftAxisTitleTranslate=0,this.bottomAxisTranslate=0,this.padding={top:20,right:0,bottom:50,left:0},this.plotProps={width:0,height:0},this.colorPalette=["#6bcaff","#ff7d85","#ffd363","#9edb89","#b1a6fe","#fca77d","#86ead6","#218fcc","#ef5b64","#dda820","#6ac04c","#cb7212","#2fc3a5","#0970aa","#d83a43","#ac7c00","#54921f","#501f76","#a15402"],this.legendSeriesMap=new Map,this.drawingSeries=new Array,this.formattedBarSeries=[],this.axisTypeEnum=ut.b,this.shiftState=!1,this.showPoint=!1,this.showZoom=!1,Object(it.a)(this.options$.asObservable(),this.series$.pipe(Object(b.a)(t=>!!t))).pipe(Object(X.a)(this.destroy$),Object(nt.a)(250)).subscribe(([t,e])=>{this.pristineOptions=t,this.drawingSeries=e.data.map(t=>{const e=t;return e.label=this.dateParse(t.label),e}),this.drawingSeries.forEach(t=>this.legendSeriesMap.set(t.label,t)),this.drawingSeries.length>0&&this.drawChart(this.drawingSeries,this.pristineOptions),setTimeout(()=>this.cdr.detectChanges())}),this.chartBoxExpansionService.expand.pipe(Object(X.a)(this.destroy$)).subscribe(t=>{setTimeout(()=>{this.uniqueId===t.containerKey&&(this.drawChart(this.drawingSeries,this.pristineOptions),this.cdr.detectChanges())},t.delay)})}set _options(t){this.options$.next(t)}set _seriesData(t){this.series$.next(t)}shiftPushed(){this.shiftState=!0}shiftReleased(){this.shiftState=!1}ngOnInit(){this.tooltipXCoordinate$.pipe(Object(b.a)(t=>null!==t),Object(X.a)(this.destroy$)).subscribe(t=>{this.tooltipContent=this.getTooltipContent(t)})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}ngAfterViewInit(){this.context=this.canvas.nativeElement.getContext("2d"),this.context.font=this.fontSize+"px Ubuntu"}drawChart(t,e){Jt.w(this.plotContainer.nativeElement).attr("clip-path","url(#clip"+this.uniqueId+")"),this.setUniqueAxisValues(t),this.context.font=this.fontSize+"px Ubuntu",this.maxLabelYPrimaryWidth=this.marginBetweenAxisLabelsAndTitle+this.getMaxWidth(this.yPrimaryValues,e.yAxisType),this.padding.left=0,this.padding.left+=this.maxLabelYPrimaryWidth!==-1/0?this.maxLabelYPrimaryWidth:10,this.padding.left+=e.yAxisTitle?this.fontSize:0,this.padding.right=0,this.padding.bottom=e.xAxisTitle?50:30,this.padding.bottom+=this.needRotateAxisLabel()?this.getMaxWidth(this.xPrimaryValues,e.xAxisType)*Math.cos(this.rotationDegree*Math.PI/180):0;const i=this.chartContainer.nativeElement.getBoundingClientRect().width-this.padding.left-this.padding.right,a=this.chartContainer.nativeElement.getBoundingClientRect().height-this.padding.top-this.padding.bottom;this.plotProps.width=i!==1/0?i:0,this.plotProps.height=a!==1/0?a:0,this.leftAxisTitleTranslate=(this.plotProps.height+this.context.measureText(e.yAxisTitle).width)/2,this.bottomAxisTranslate=(this.plotProps.width-this.context.measureText(e.xAxisTitle).width)/2,this.createScales(e),this.createAxis(e),this.appendAxis(),this.addGridLines(e),this.addMouseMoveRect(),this.addZoom(),setTimeout(()=>{this.showZoom=!1,this.commonDraw(!0,this.drawingSeries,this.xPrimaryScale,this.yPrimaryScale)})}zoomed(){this.shiftState&&"zoom"===Jt.n.type&&(this.showZoom=!0,this.new_yPrimaryScale=Jt.n.transform.rescaleY(this.yPrimaryScale),this.yPrimaryAxis=Jt.d(this.new_yPrimaryScale),Jt.w(this.axisLeft.nativeElement).transition().duration(0).call(this.yPrimaryAxis.scale(this.new_yPrimaryScale)),Jt.w(this.yGrid.nativeElement).call(this.yPrimaryAxis.tickArguments([7]).tickSize(-this.plotProps.width)),this.commonDraw(!1,this.drawingSeries,this.xPrimaryScale,this.new_yPrimaryScale))}addMouseMoveRect(){Jt.w(this.zoomContainer.nativeElement).style("fill","none").style("pointer-events","all").attr("width",this.plotProps.width).attr("height",this.plotProps.height)}appendAxis(){this.xPrimaryAxis&&Jt.w(this.axisBottom.nativeElement).transition().duration(800).call(this.xPrimaryAxis).selectAll("text").attr("transform",this.needRotateAxisLabel()?"rotate("+this.rotationDegree+")":null).style("text-anchor",this.needRotateAxisLabel()?"end":"middle"),this.yPrimaryAxis&&Jt.w(this.axisLeft.nativeElement).transition().duration(800).call(this.yPrimaryAxis)}commonDraw(t,e,i,a){Jt.w(this.boxContainer.nativeElement).selectAll(".box-point").remove(),Jt.w(this.boxContainer.nativeElement).selectAll(".box-line").remove(),Jt.w(this.boxContainer.nativeElement).selectAll(".box-rect").remove();let n=Jt.w(this.boxContainer.nativeElement),s=0;e.forEach(r=>{s=i(r.label);const o=r.value.sort(Jt.b),l=Jt.s(o,.25),c=Jt.s(o,.5),h=Jt.s(o,.75),p=h-l,d=l-1.5*p,m=h+1.5*p,u=o.filter(t=>t>d&&t<m),g=this.plotProps.width/e.length&&e.length<=3?80:this.plotProps.width/e.length-10;n.append("line").attr("class","box-line").attr("x1",s).attr("x2",s).attr("y1",a(u[0])).attr("y2",a(u[u.length-1])).attr("stroke","black"),n.append("line").attr("class","box-line").attr("x1",s-g/2).attr("x2",s+g/2).attr("y1",a(u[0])).attr("y2",a(u[0])).attr("stroke","black"),n.append("line").attr("class","box-line").attr("x1",s-g/2).attr("x2",s+g/2).attr("y1",a(u[u.length-1])).attr("y2",a(u[u.length-1])).attr("stroke","black"),t?n.append("rect").attr("class","box-rect").attr("x",s-g/2).attr("y",a(h)).attr("height",0).attr("width",g).attr("stroke","black").style("fill","#6bcaff").on("mousemove",()=>this.showTooltip()).on("mouseleave",()=>this.hideTooltip()).transition().ease(Jt.l).duration(1300).attr("height",a(l)-a(h)):n.append("rect").attr("class","box-rect").attr("x",s-g/2).attr("y",a(h)).attr("height",a(l)-a(h)).attr("width",g).attr("stroke","black").style("fill","#6bcaff").on("mousemove",()=>this.showTooltip()).on("mouseleave",()=>this.hideTooltip()),n.append("line").attr("class","box-line").attr("x1",s-g/2).attr("x2",s+g/2).attr("y1",a(c)).attr("y2",a(c)).attr("stroke","black").style("width",80),this.showPoint&&n.selectAll("toto").data(o.filter(t=>t<d||t>m)).enter().append("circle").attr("class","box-point").attr("cx",s).attr("cy",t=>a(t)).attr("r",4).style("fill","#6bcaff").attr("stroke","none").attr("opacity",.5)})}needRotateAxisLabel(){let t=this.xPrimaryValues;if(this.options$.getValue().xAxisType===ut.b.Date){const e=this.xPrimaryValues.map(t=>new Date(+t)),i=Math.max.apply(null,e),a=Math.min.apply(null,e),n=Math.abs(i-a)/864e5;t=t.map(t=>n>365?new Date(+t).toLocaleDateString("ru-RU"):new Date(+t).toLocaleDateString("ru-RU").slice(0,-5))}const e=(this.chartContainer.nativeElement.getBoundingClientRect().width-this.padding.left-this.padding.right)/this.calculateTickCount(t),i=Math.max(...t.map(t=>this.context.measureText(t).width));return i>e||!(!this.xPrimaryScale||this.options$.getValue().xAxisType!==ut.b.Date)&&this.getMinimalTickDistance(this.xPrimaryScale)<i}showTooltip(){const t=Jt.r(Jt.n.target)[0],e=this.drawingSeries.map(t=>t.label);let i=null,a=1/0;e.forEach(e=>{const n=Math.abs(t-this.xPrimaryScale(e));n<a&&(a=n,i=e)});const n=this.xPrimaryScale(i),s=this.tooltipRef.nativeElement.getBoundingClientRect();this.tooltipPosition.left=n+this.padding.left-s.width/2+(this.pristineOptions.xAxisType===ut.b.Text?this.xPrimaryScale.bandwidth()/2:0),this.tooltipPosition.top=Jt.r(Jt.n.target)[1]-s.height+10,this.cdr.detectChanges(),this.tooltipXCoordinate$.next(this.drawingSeries.filter(t=>t.label===i)[0])}hideTooltip(){this.tooltipXCoordinate$.next(null)}getTooltipContent(t){const e=t.value.sort(Jt.b),i=Jt.s(e,.25),a=Jt.s(e,.5),n=Jt.s(e,.75),s=n-i;return"<li>"+t.label+"</li><li>&nbsp</li><li> Median: <b>"+a+"</b></li><li> Q1: <b>"+i+"</b></li><li> Q3: <b>"+n+"</b></li><li> IQR: <b>"+s+"</b><br></li><li>&nbsp</li><li> Min: <b>"+(i-1.5*s)+"</b></li><li> Max: <b>"+(n+1.5*s)+"</b></li><li> Min Outlier: <b>"+e[0]+"</b></li><li> Max Outlier: <b>"+e[e.length-1]+"</b></li>"}toggleSeries(){this.showPoint?(this.showPoint=!1,this.createScales(this.pristineOptions),this.createAxis(this.pristineOptions),this.appendAxis(),this.addGridLines(this.pristineOptions),this.showZoom=!1,this.commonDraw(!0,this.drawingSeries,this.xPrimaryScale,this.yPrimaryScale)):(this.showPoint=!0,this.createScales(this.pristineOptions),this.createAxis(this.pristineOptions),this.appendAxis(),this.addGridLines(this.pristineOptions),this.commonDraw(!0,this.drawingSeries,this.xPrimaryScale,this.yPrimaryScale))}getColorByKey(t){const e=this.drawingSeries.findIndex(e=>e.label===t);return-1===e?"#000":this.colorPalette[e%this.colorPalette.length]}formatValue(t){return Math.round(100*t)/100}getMaxWidth(t,e){if(e===ut.b.Date){const e=t.map(t=>new Date(+t)),i=Math.max.apply(null,e),a=Math.min.apply(null,e),n=Math.abs(i-a)/864e5;t=t.map(t=>n>365?new Date(+t).toLocaleDateString("ru-RU"):new Date(+t).toLocaleDateString("ru-RU").slice(0,-5))}return Math.max(...t.map(t=>isNaN(+t)?this.context.measureText(t).width:this.context.measureText(Math.round(10*+t)/10+"").width))+5+5}dateParse(t){if(t instanceof Date)return t.getTime()+"";const e=new RegExp(/^([a-zA-Z]*)\s?([0-9]*)?,\s?([0-9][0-9][0-9][0-9])/),i=new RegExp(/^([0-9][0-9][0-9][0-9])\sQ([0-4])$/);if(!e.test(t)){if(i.test(t)){const e=t.match(i);return new Date(+e[1],3*+e[2],1).getTime()+""}return t}{const i=t.match(e);if(this.monthSet.has(i[1])){const t=new Date(Date.parse(i[1]+" 1,"+i[3])).getMonth();return new Date(+i[3],t,void 0===i[2]?1:+i[2]).getTime()+""}if("Wk"===i[1])return new Date(+i[3],0,1+7*(+i[2]-1)).getTime()+""}}setUniqueAxisValues(t){this.xPrimaryValues=[...new Set(t.flatMap(t=>t.label.toString()))],this.yPrimaryValues=[...new Set(t.flatMap(t=>t.value.map(t=>t)))]}createScales(t){this.xPrimaryScale=this.xPrimaryValues.length>0?this.setXScale(this.plotProps.width,this.xPrimaryValues,t.xAxisType):null,this.yPrimaryScale=this.yPrimaryValues.length>0?this.setYScale(this.plotProps.height,this.yPrimaryValues,t.yAxisType):null}setXScale(t,e,i){switch(i){case ut.b.Date:return Jt.v().range([0,t]).domain(Jt.o(e.map(t=>new Date(+t))));case ut.b.Numeric:let i=e.map(t=>parseFloat(t));return Jt.u().range([0,t]).domain([i[0],i[i.length-1]]);case ut.b.Text:return Jt.t().range([0,t]).padding(.1).domain(e)}}setYScale(t,e,i){switch(i){case ut.b.Date:return Jt.v().range([t,0]).domain(Jt.o(e.map(t=>new Date(+t))));case ut.b.Numeric:const i=e.sort((t,e)=>t-e);if(this.showPoint){const e=.2*(Math.abs(i[0])+Math.abs(i[i.length-1])/2);return Jt.u().rangeRound([t,0]).domain([i[0]-e,i[i.length-1]+e])}{const e=Jt.s(i,.25),a=Jt.s(i,.75),n=a-e,s=e-1.5*n,r=a+1.5*n,o=i.filter(t=>t>s&&t<r),l=.2*(Math.abs(o[0])+Math.abs(o[o.length-1])/2);return Jt.u().rangeRound([t,0]).domain([o[0]-l,o[o.length-1]+l])}case ut.b.Text:return Jt.t().range([t,0]).padding(.1).domain(e)}}createAxis(t){this.xPrimaryScale&&(this.xPrimaryAxis=Jt.c(this.xPrimaryScale).tickArguments([this.calculateTickCount(this.xPrimaryValues.filter(t=>new Date(+t)<=this.xPrimaryScale.domain()[1]&&new Date(+t)>=this.xPrimaryScale.domain()[0]))]).tickFormat(t.xAxisType===ut.b.Date?this.tickFormat(ut.b.Date,this.xPrimaryScale):null)),this.yPrimaryScale&&(this.yPrimaryAxis=Jt.d(this.yPrimaryScale))}addGridLines(t){t.showXGridLine&&this.xPrimaryAxis&&Jt.w(this.xGrid.nativeElement).call(this.xPrimaryAxis.tickArguments([this.calculateTickCount(this.xPrimaryValues)/3]).tickSize(-this.plotProps.height)),t.showYGridLine&&this.yPrimaryAxis&&Jt.w(this.yGrid.nativeElement).call(this.yPrimaryAxis.tickArguments([7]).tickSize(-this.plotProps.width))}tickFormat(t,e){if(t===ut.b.Date){const t=e.domain(),i=Math.abs(t[1].getTime()-t[0].getTime())/864e5;return Jt.G(i<365?"%d.%m":"%d.%m.%y")}return null}calculateTickCount(t){return Math.min(t.length,10)}addZoom(){this.zoom=Jt.H().scaleExtent([1,5]).translateExtent([[0,0],[this.plotProps.width,this.plotProps.height]]).extent([[0,0],[this.plotProps.width,this.plotProps.height]]).on("zoom",()=>this.zoomed()),Jt.w(this.zoomContainer.nativeElement).call(this.zoom)}getMinimalTickDistance(t){const e=t.ticks(this.calculateTickCount(this.xPrimaryValues.filter(t=>new Date(+t)<=this.xPrimaryScale.domain()[1]&&new Date(+t)>=this.xPrimaryScale.domain()[0]))),i=Array();for(let a=0;a<e.length-1;a++)i.push(t(e[a+1])-t(e[a]));return Math.min(...i)}}return t.\u0275fac=function(e){return new(e||t)(o.Rb(o.h),o.Rb(ct.a))},t.\u0275cmp=o.Lb({type:t,selectors:[["m-d3-box-plot"]],viewQuery:function(t,e){var i;1&t&&(o.Ic(Ee,!0),o.Ic(Ie,!0),o.Ic($e,!0),o.Ic(We,!0),o.Ic(je,!0),o.Ic(Ye,!0),o.Ic(ze,!0),o.Ic(Be,!0),o.Ic(Re,!0),o.Sc(Ne,!0),o.Sc(Fe,!0),o.Sc(Ve,!0),o.Sc(qe,!0)),2&t&&(o.xc(i=o.gc())&&(e.chartContainer=i.first),o.xc(i=o.gc())&&(e.plotContainer=i.first),o.xc(i=o.gc())&&(e.boxContainer=i.first),o.xc(i=o.gc())&&(e.axisBottom=i.first),o.xc(i=o.gc())&&(e.axisLeft=i.first),o.xc(i=o.gc())&&(e.xGrid=i.first),o.xc(i=o.gc())&&(e.yGrid=i.first),o.xc(i=o.gc())&&(e.axisTimelineBottom=i.first),o.xc(i=o.gc())&&(e.axisTimelineLeft=i.first),o.xc(i=o.gc())&&(e.zoomContainer=i.first),o.xc(i=o.gc())&&(e.tooltipRef=i.first),o.xc(i=o.gc())&&(e.tooltipRefBar=i.first),o.xc(i=o.gc())&&(e.canvas=i.first))},hostBindings:function(t,e){1&t&&o.fc("keydown.shift",(function(){return e.shiftPushed()}),!1,o.Ac)("keyup.shift",(function(){return e.shiftReleased()}),!1,o.Ac)},inputs:{_options:["options","_options"],_seriesData:["data","_seriesData"],uniqueId:"uniqueId"},decls:34,vars:28,consts:[[1,"d3-chart-wrapper"],[4,"ngIf"],[1,"block-relative"],["chartContainer",""],[3,"id"],[1,"inner"],["inner",""],["class","axis-bottom-title",4,"ngIf"],["class","axis-left-title",4,"ngIf"],[1,"axis","axis-x-bottom"],["axisBottom",""],[1,"x-grid"],["xGrid",""],[1,"y-grid"],["yGrid",""],[1,"axis","axis-y-left"],["axisLeft",""],[1,"plot"],["plotContainer",""],["zoomContainer",""],[1,"box"],["boxContainer",""],["class","tooltip-container-down",3,"opacity","top","left",4,"ngIf"],[1,"d3-chart-description"],[2,"display","none"],["measureCanvas",""],[1,"d3-legend-wrapper"],[1,"d3-legend-container"],[1,"d3-legend-item",3,"click"],[1,"d3-legend-icon"],["class","d3-legend-text",3,"opacity",4,"ngIf"],[1,"d3-legend-text"],[1,"axis-bottom-title"],[1,"axis-left-title"],[1,"tooltip-container-down"],["tooltipContainer",""],[1,"tooltip-header"],[3,"innerHTML"]],template:function(t,e){1&t&&(o.Xb(0,"div",0),o.Lc(1,Ue,3,3,"ng-container",1),o.Xb(2,"div",2),o.ic(),o.Xb(3,"svg",null,3),o.Xb(5,"defs"),o.Xb(6,"clipPath",4),o.Sb(7,"rect"),o.Wb(),o.Wb(),o.Xb(8,"g",5,6),o.Lc(10,Qe,4,4,"g",7),o.kc(11,"async"),o.Lc(12,Ge,4,4,"g",8),o.kc(13,"async"),o.Sb(14,"g",9,10),o.Sb(16,"g",11,12),o.Sb(18,"g",13,14),o.Sb(20,"g",15,16),o.Xb(22,"g",17,18),o.Sb(24,"rect",null,19),o.Sb(26,"g",20,21),o.kc(28,"async"),o.Wb(),o.Wb(),o.Wb(),o.Lc(29,Je,7,13,"div",22),o.hc(),o.Xb(30,"span",23),o.Nc(31," Info: Hold Shift and scroll to zoom. "),o.Wb(),o.Wb(),o.Wb(),o.Sb(32,"canvas",24,25)),2&t&&(o.Db(1),o.pc("ngIf",e.drawingSeries.length>1),o.Db(2),o.Kc("width","100%")("height",450,"px"),o.Db(3),o.pc("id","clip"+e.uniqueId),o.Db(1),o.Eb("width",e.plotProps.width)("height",e.plotProps.height),o.Db(1),o.Kc("height",e.plotProps.height,"px")("width",e.plotProps.width,"px"),o.Eb("transform","translate("+e.padding.left+","+e.padding.top+")"),o.Db(2),o.pc("ngIf",o.lc(11,22,e.options$).xAxisTitle),o.Db(2),o.pc("ngIf",o.lc(13,24,e.options$).yAxisTitle),o.Db(2),o.Eb("transform","translate(0,"+e.plotProps.height+")"),o.Db(2),o.Eb("transform","translate(0,"+e.plotProps.height+")"),o.Db(8),o.Kc("width","100%"),o.Eb("fill","transparent"),o.Db(2),o.Eb("transform",o.lc(28,26,e.options$).xAxisType===e.axisTypeEnum.Text&&e.xPrimaryScale?"translate("+e.xPrimaryScale.bandwidth()/2+",0)":"translate(0,0)"),o.Db(3),o.pc("ngIf",e.drawingSeries.length>0))},directives:[a.m],pipes:[a.b,ee.a],styles:[".d3-plot[_ngcontent-%COMP%]{font-style:normal;color:#000}.axis[_ngcontent-%COMP%]   path[_ngcontent-%COMP%]{stroke:#0f0f11;stroke-dasharray:none!important}.line[_ngcontent-%COMP%]   path[_ngcontent-%COMP%]{stroke-width:2;fill:none;-webkit-transition:stroke-width 125ms linear,opacity 125ms linear;transition:stroke-width 125ms linear,opacity 125ms linear}.area[_ngcontent-%COMP%]   path[_ngcontent-%COMP%]{opacity:.3;-webkit-transition:opacity 125ms linear;transition:opacity 125ms linear}.dot-line[_ngcontent-%COMP%]{-webkit-transition:opacity 125ms linear,r 125ms linear;transition:opacity 125ms linear,r 125ms linear}.dot-hovered[_ngcontent-%COMP%]{opacity:.35!important;-webkit-filter:drop-shadow(3px 3px 3px #fff);filter:drop-shadow(3px 3px 3px white)}.dot-hovered-inner[_ngcontent-%COMP%]{opacity:1;stroke:#fff;stroke-width:.5}.legend[_ngcontent-%COMP%]{text-decoration:underline;cursor:pointer;float:right}.legend-icon[_ngcontent-%COMP%], .legend-item[_ngcontent-%COMP%]{display:inline-block}.legend-icon[_ngcontent-%COMP%]{height:12px;width:12px;border-radius:50%;vertical-align:middle}.legend-text[_ngcontent-%COMP%]{font-weight:700;font-size:12px;line-height:14px;-webkit-text-decoration-line:underline;text-decoration-line:underline;vertical-align:middle;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.legend-text[_ngcontent-%COMP%]:hover{opacity:1!important}.block-relative[_ngcontent-%COMP%]{position:relative}  .tick line{stroke-dasharray:5 5}"]}),t})();var ei=i("cWD+"),ii=i("FH+O"),ai=i("h4wM"),ni=i("iaTl"),si=i("Y+mK");const ri=["svg"],oi=["svgbrush"];function li(t,e){if(1&t){const t=o.Yb();o.Xb(0,"div",7),o.Xb(1,"div",8),o.ic(),o.Xb(2,"svg",9),o.fc("mousemove",(function(e){return o.Cc(t),o.jc(2).showTooltip(e)}))("mouseleave",(function(){return o.Cc(t),o.jc(2).hideTooltip()})),o.Sb(3,"g",10),o.Wb(),o.Wb(),o.hc(),o.Xb(4,"div",11),o.ic(),o.Xb(5,"svg",12,13),o.Xb(7,"defs"),o.Xb(8,"filter"),o.Sb(9,"feGaussianBlur"),o.Wb(),o.Xb(10,"pattern"),o.Sb(11,"image"),o.Wb(),o.Xb(12,"linearGradient"),o.Sb(13,"stop"),o.Sb(14,"stop"),o.Sb(15,"stop"),o.Sb(16,"stop"),o.Sb(17,"stop"),o.Wb(),o.Wb(),o.Wb(),o.Wb(),o.hc(),o.Xb(18,"div",14),o.ic(),o.Sb(19,"svg",15,16),o.Wb(),o.hc(),o.Xb(21,"span",17),o.Nc(22," Info: "),o.Xb(23,"strong",18),o.Nc(24,"SHIFT + SCROLL"),o.Wb(),o.Nc(25," to zoom. Hold "),o.Xb(26,"strong",18),o.Nc(27,"CTRL"),o.Wb(),o.Nc(28," for coordinates. Hold "),o.Xb(29,"strong",18),o.Nc(30,"S"),o.Wb(),o.Nc(31," for selection. "),o.Xb(32,"strong",18),o.Nc(33,"ESC"),o.Wb(),o.Nc(34," to exit selection mode. "),o.Wb(),o.Wb()}if(2&t){const t=o.jc(2);o.Db(2),o.Eb("width",t.width+128+"px")("height",t.height+"px")("id","axissvg"),o.Db(3),o.Eb("width",t.width+"px")("height",t.height+"px")("preserveAspectRatio","none")("id","imagesvg"),o.Db(3),o.Eb("id","blurMe"),o.Db(1),o.Eb("in","SourceGraphic")("stdDeviation","35"),o.Db(1),o.Eb("id","img1")("patternUnits","userSpaceOnUse")("width","100%")("height","100%"),o.Db(1),o.Eb("href",t.url,null,"xlink")("x","0")("y","0")("width","100%")("height","100%"),o.Db(1),o.Eb("id","legend1"),o.Db(1),o.Eb("offset","0%")("stop-color","#16cbe0"),o.Db(1),o.Eb("offset","25%")("stop-color","#0fff83"),o.Db(1),o.Eb("offset","50%")("stop-color","#fefe22"),o.Db(1),o.Eb("offset","75%")("stop-color","#ffa000"),o.Db(1),o.Eb("offset","100%")("stop-color","#ff2400"),o.Db(2),o.Eb("width",t.width-1+"px")("height",t.height-1+"px")("preserveAspectRatio","none")}}function ci(t,e){if(1&t&&(o.Vb(0),o.Xb(1,"div",3,4),o.Sb(3,"m-loading-indicator",5),o.Wb(),o.Lc(4,li,35,33,"div",6),o.Ub()),2&t){const t=e.ngIf;o.jc();const i=o.yc(4);o.Db(3),o.pc("isInline",!0),o.Db(1),o.pc("ngIf",t.data)("ngIfElse",i)}}function hi(t,e){if(1&t&&(o.Xb(0,"div",20),o.Nc(1," Map options are not set for "),o.Xb(2,"strong"),o.Nc(3),o.Wb(),o.Wb()),2&t){const t=e.ngIf;o.Db(3),o.Oc(null==t.options?null:t.options.name)}}const pi=function(t){return{options:t}};function di(t,e){if(1&t&&(o.Lc(0,hi,4,1,"div",19),o.kc(1,"async")),2&t){const t=o.jc();o.pc("ngIf",o.uc(3,pi,o.lc(1,1,t.options$)))}}const mi=function(t){return{data:t}};let ui=(()=>{class t{constructor(t){this.ref=t,this.destroy$=new h.a,this.mapOptions$=new et.a(null),this.isInline=!1,this.defaultOptions={invertXAxis:!1,invertYAxis:!0,name:"",subtitle:"",description:"",zoomOutsideMap:!1},this.defaultMapOptions={},this.preZoomDefaultOptions={},this.options$=new et.a(Object.assign({},this.defaultOptions)),this.windowResize$=new et.a(!1),this.series$=new et.a(null),this.height=650,this.width=650,this.url="",this.crossAirOn=!1,this.resetMap=!1,this.frequency=23,this.radius=[7,11,15,19,23],this.currentZoomScale=1,this.currentXPosition=1,this.currentYPosition=1,this.separatorColors=[],Object(it.a)([this.options$.asObservable(),this.mapOptions$.asObservable(),this.series$.pipe(Object(b.a)(t=>!!t)),this.windowResize$.asObservable()]).pipe(Object(X.a)(this.destroy$),Object(nt.a)(250)).subscribe(([t,e,i,a])=>{const n=this;if(!e||t.zoomOutsideMap){e||0!==i.data.length||(this.defaultMapOptions.url="/assets/app/media/img/maps/not_enough_data.png");let t=Number.MAX_SAFE_INTEGER,a=Number.MAX_SAFE_INTEGER,n=Number.MIN_SAFE_INTEGER,s=Number.MIN_SAFE_INTEGER;i.data.forEach(e=>{t=e.x<t?e.x:t,a=e.y<a?e.y:a,n=e.x>n?e.x:n,s=e.y>s?e.y:s}),e?(this.defaultMapOptions.url=e.url,this.preZoomDefaultOptions.minX=e.minX<t?e.minX:1.2*t,this.preZoomDefaultOptions.maxX=e.maxX>n?e.maxX:1.2*n,this.preZoomDefaultOptions.minY=e.minY<a?e.minY:1.2*a,this.preZoomDefaultOptions.maxY=e.maxY>s?e.maxY:1.2*s,this.defaultMapOptions.minX=e.minX,this.defaultMapOptions.minY=e.minY,this.defaultMapOptions.maxX=e.maxX,this.defaultMapOptions.maxY=e.maxY):this.defaultMapOptions.url="/assets/app/media/img/maps/placeholder_image.jpg"}else this.defaultMapOptions.url=e.url||"/assets/app/media/img/maps/not_enough_data.png",this.defaultMapOptions.url=e.url,this.defaultMapOptions.minX=e.minX,this.defaultMapOptions.minY=e.minY,this.defaultMapOptions.maxX=e.maxX,this.defaultMapOptions.maxY=e.maxY;this.loadImage(this.defaultMapOptions.url).then(a=>(n.url=this.defaultMapOptions.url,n.width=650,n.height=650,!t.zoomOutsideMap&&e&&(i.data=i.data.filter(t=>t.x>=e.minX&&t.x<=e.maxX&&t.y>=e.minY&&t.y<=e.maxY)),n.clearMapAll(),n.renderChart(i,this.defaultMapOptions,t),setTimeout(()=>this.ref.detectChanges()),n)),this.width=n.width,this.height=n.height})}set _mapOptions(t){this.mapOptions$.next(t)}set _options(t){this.options$.next(Object.assign(Object.assign({},this.defaultOptions),t||{}))}set series(t){t.data=t.data.filter(t=>!(0===t.x&&0===t.y)),this.series$.next(t)}setBrushOn(t){switch(t.code){case"KeyS":this.brushContainer.nativeElement.setAttribute("style","display: block");break;case"Escape":this.resetMap=!0,this.brushed();break;case"ControlLeft":this.crossAirOn=!0}}setBrushOff(t){switch(t.code){case"KeyS":break;case"Escape":this.resetMap=!1,this.brushContainer.nativeElement.setAttribute("style","display: none"),Jt.w("#crossTextTooltip").remove(),Jt.w("#polygonTooltip").remove(),this.brushend();break;case"ControlLeft":this.crossAirOn=!1}}ngOnDestroy(){this.options$.unsubscribe(),this.mapOptions$.unsubscribe(),this.series$.unsubscribe(),this.windowResize$.unsubscribe()}showTooltip(t){const e=this.chartContainer.nativeElement.getBoundingClientRect();this.crossAirOn?this.crossLineToolTip(t.clientX-e.left,t.clientY-e.top,null,null,null):this.crossLineToolTipClear()}distance(t,e,i,a){return Math.sqrt(Math.pow(t-i,2)+Math.pow(e-a,2))}hideTooltip(){this.crossLineToolTipClear()}loadImage(t){return new Promise((e,i)=>{const a=new Image;a.addEventListener("load",()=>e(a)),a.addEventListener("error",t=>i(t)),a.src=t})}renderChart(t,e,i){let a;Jt.w(".d3-expand-chart-button").attr("style","visibility:hidden"),Jt.w(".heatmap-inner-image").attr("style","top:"+-this.height+"px"),this.imagesvg=Jt.w(".imagesvg"),this.selectRectMap=Jt.g().on("end",()=>this.brushed()),Jt.w(".d3brushmapimage").call(this.selectRectMap),this.resetMap=!1,this.brushContainer.nativeElement.setAttribute("style","display:none"),this.brushend(),void 0===this.imagesvg.select(".map.xy.box")._groups[0][0]&&this.imagesvg.append("svg:rect").attr("class","map xy box").attr("width",`${this.width}px`).attr("height",`${this.height}px`).attr("fill","url(#img1)").attr("opacity",.6).attr("transform","translate(0, 0) scale(1, 1)"),void 0===this.imagesvg.select(".innerImageTop1")._groups[0][0]&&this.imagesvg.append("g").attr("class","innerImageTop1"),void 0===this.imagesvg.select(".innerImageTop2")._groups[0][0]&&this.imagesvg.append("g").attr("class","innerImageTop2"),void 0===this.imagesvg.select(".innerImageTop3")._groups[0][0]&&this.imagesvg.append("g").attr("class","innerImageTop3"),void 0===this.imagesvg.select(".innerImageTop4")._groups[0][0]&&this.imagesvg.append("g").attr("class","innerImageTop4"),void 0===this.imagesvg.select(".innerImageTop5")._groups[0][0]&&this.imagesvg.append("g").attr("class","innerImageTop5"),this.svg=Jt.w(".zoomableOf");const n=this.svg.append("g").attr("id","containerMap").attr("transform","translate(0, 0)");n.append("g").attr("class","x axis top").attr("transform",`translate(0, ${this.height-1})`),n.append("g").attr("class","y axis right").attr("transform","translate(0, 0)"),n.append("g").attr("class","x axis bottom").attr("transform","translate(0, 0)"),n.append("g").attr("class","y axis left").attr("transform",`translate(${this.width}, 0)`);const s=i.invertXAxis?[e.maxX,e.minX]:[e.minX,e.maxX];this.xScale=Jt.u().domain(s).range([0,this.height]),this.xAxisTop=Jt.f(this.xScale).tickFormat(()=>""),this.xAxisBottom=Jt.c(this.xScale).tickFormat(()=>"");const r=i.invertYAxis?[e.maxY,e.minY]:[e.minY,e.maxY];this.yScale=Jt.u().domain(r).range([this.width,0]),this.yAxisRight=Jt.e(this.yScale).tickFormat(()=>""),this.yAxisLeft=Jt.d(this.yScale).tickFormat(()=>""),this.svg.select("g.x.axis.top").call(this.xAxisTop),this.svg.select("g.x.axis.bottom").call(this.xAxisBottom),this.svg.select("g.y.axis.right").call(this.yAxisRight),this.svg.select("g.y.axis.left").call(this.yAxisLeft),this.zoomScale={xScale:this.xScale.domain(),yScale:this.yScale.domain()},n.append("svg:rect").attr("class","zoom xy box").attr("width",this.width).attr("height",this.height).style("visibility","hidden").attr("pointer-events","all"),this.newData=t.data.map(e=>({killerX:Math.round(e.x),killerY:Math.round(e.y),viewBoxX:this.xScale(e.x),viewBoxY:this.yScale(e.y),distanceAllPoint:(()=>t.data.map(t=>this.distance(this.xScale(e.x),this.yScale(e.y),this.xScale(t.x),this.yScale(t.y))).filter(t=>t<=this.frequency))(),frequencyAllPoint:(()=>t.data.map(t=>this.distance(this.xScale(e.x),this.yScale(e.y),this.xScale(t.x),this.yScale(t.y))).filter(t=>t<=this.radius[0]))(),rate:(()=>{const i=[];for(let a=0;a<t.length;a++){const n=this.distance(this.xScale(e.x),this.yScale(e.y),this.xScale(t[a].x),this.yScale(t[a].y));0===n&&i.push(n)}return i.length})()}));const o=this.newData.reduce((t,e)=>{const i=t.find(t=>t.viewBoxX===e.viewBoxX&&t.viewBoxY===e.viewBoxY);return i?(i.rate=i.rate+1,t):t.concat([e])},[]);this.newData=[...o];const l=Math.max(...this.newData.map(t=>t.distanceAllPoint.length)),c=l/5;if(this.separatorColors=[Math.ceil(l-4*c),Math.ceil(l-3*c),Math.ceil(l-2*c),Math.ceil(l-c),Math.ceil(l)],this.layer1=this.imagesvg.select(".innerImageTop1").selectAll("circle").data(this.newData.filter(t=>t.distanceAllPoint.length>=1)).enter().append("svg:circle").attr("id","layer1").attr("opacity",.2).attr("filter","blurMe").attr("fill","#16cbe0"),this.layer2=this.imagesvg.select(".innerImageTop2").selectAll("circle").data(this.newData.filter(t=>t.distanceAllPoint.length>=11)).enter().append("svg:circle").attr("id","layer2").attr("opacity",.2).attr("filter","blurMe").attr("fill","#0fff94"),this.layer3=this.imagesvg.select(".innerImageTop3").selectAll("circle").data(this.newData.filter(t=>t.distanceAllPoint.length>=15)).enter().append("svg:circle").attr("id","layer3").attr("opacity",.7).attr("filter","blurMe").attr("fill","#fefe22"),this.layer4=this.imagesvg.select(".innerImageTop4").selectAll("circle").data(this.newData.filter(t=>t.distanceAllPoint.length>=19)).enter().append("svg:circle").attr("id","layer4").attr("opacity",.2).attr("filter","blurMe").attr("fill","#ffa000"),this.layer5=this.imagesvg.select(".innerImageTop5").selectAll("circle").data(this.newData.filter(t=>t.distanceAllPoint.length>=this.frequency)).enter().append("svg:circle").attr("id","layer5").attr("opacity",.2).attr("filter","blurMe").attr("fill","#ff2400"),void 0===this.imagesvg.select(".heatmap-gradient")._groups[0][0]&&(this.imagesvg.append("rect").attr("x",30).attr("y",.94*this.height).attr("class","heatmap-gradient").attr("width",.18*this.width).attr("height",20).attr("fill","url(#legend1)").attr("stroke","#000000").attr("stroke-width",1),this.imagesvg.append("text").attr("class","d3-font").attr("id","legendMin").attr("x",30).attr("y",.935*this.height).text("min"),this.imagesvg.append("text").attr("class","d3-font").attr("id","legendMax").attr("x",.188*this.width).attr("y",.935*this.height).text("max")),Jt.H().on("zoom",null),i.zoomOutsideMap){a=Jt.H().filter(()=>"wheel"!==Jt.n.type||Jt.n.shiftKey).extent([[0,0],[this.width,this.height]]).on("zoom",()=>this.zoomed());const t=Math.ceil(Math.abs(this.xScale.domain()[0]-this.xScale.domain()[1])),n=Math.ceil(Math.abs(this.preZoomDefaultOptions.minX-this.preZoomDefaultOptions.maxX)),s=Math.ceil(Math.abs(this.yScale.domain()[0]-this.yScale.domain()[1])),r=Math.ceil(Math.abs(this.preZoomDefaultOptions.minY-this.preZoomDefaultOptions.maxY));this.currentZoomScale=t/n>s/r?s/r:t/n;const o=i.invertXAxis?[this.preZoomDefaultOptions.maxX,this.preZoomDefaultOptions.minX]:[this.preZoomDefaultOptions.minX,this.preZoomDefaultOptions.maxX],l=i.invertYAxis?[this.preZoomDefaultOptions.maxY,this.preZoomDefaultOptions.minY]:[this.preZoomDefaultOptions.minY,this.preZoomDefaultOptions.maxY],c=Jt.u().domain(o).range([0,this.height]),h=Jt.u().domain(l).range([this.width,0]);this.currentXPosition=c(e.minX),this.currentYPosition=h(e.maxY)}else a=Jt.H().filter(()=>"wheel"!==Jt.n.type||Jt.n.shiftKey).extent([[0,0],[this.width,this.height]]).scaleExtent([1,15]).translateExtent([[0,0],[this.width,this.height]]).on("zoom",()=>this.zoomed());const h=this.svg.append("rect").attr("class","zoomCatcher").attr("x",0).attr("y",0).attr("width",this.width).attr("height",this.height).attr("fill","transparent").attr("stroke","none").call(a);h.call(a.transform,Jt.I.translate(this.currentXPosition,this.currentYPosition).scale(this.currentZoomScale)),h.attr("transform","translate(0, 0)").attr("x",0).attr("y",0)}zoomed(){const t=Jt.n.transform;this.currentZoomScale=t.k,this.currentXPosition=t.x,this.currentYPosition=t.y,this.newXScale=t.rescaleX(this.xScale),this.newYScale=t.rescaleY(this.yScale),this.svg.select("g.x.axis.top").transition().duration(50),this.svg.select("g.y.axis.right").transition().duration(50),this.svg.select("g.x.axis.bottom").transition().duration(50),this.svg.select("g.y.axis.left").transition().duration(50),this.newData=this.newData.map(t=>{const e={killerX:t.killerX,killerY:t.killerY,viewBoxX:this.newXScale(t.killerX),viewBoxY:this.newYScale(t.killerY),distanceAllPoint:t.distanceAllPoint,radiusOne:0,radiusTwo:0,radiusThree:0,radiusFour:0,radiusFive:0,rate:t.rate,frequencyAllPoint:t.frequencyAllPoint};return e.distanceAllPoint.length+t.rate>=0&&e.distanceAllPoint.length+t.rate<=this.separatorColors[0]?e.radiusOne=this.radius[0]:e.distanceAllPoint.length+t.rate>=this.separatorColors[0]&&e.distanceAllPoint.length+t.rate<=this.separatorColors[1]?e.radiusOne=this.radius[1]:e.distanceAllPoint.length+t.rate>=this.separatorColors[1]&&e.distanceAllPoint.length+t.rate<=this.separatorColors[2]?e.radiusOne=this.radius[2]:e.distanceAllPoint.length+t.rate>=this.separatorColors[2]&&e.distanceAllPoint.length+t.rate<=this.separatorColors[3]?e.radiusOne=this.radius[3]:e.distanceAllPoint.length+t.rate>=this.separatorColors[3]&&e.distanceAllPoint.length+t.rate<=this.separatorColors[4]&&(e.radiusOne=this.radius[4]),e.distanceAllPoint.length+t.rate>=this.separatorColors[0]&&e.distanceAllPoint.length+t.rate<=this.separatorColors[1]?e.radiusTwo=this.radius[0]:e.distanceAllPoint.length+t.rate>=this.separatorColors[1]&&e.distanceAllPoint.length+t.rate<=this.separatorColors[2]?e.radiusTwo=this.radius[1]:e.distanceAllPoint.length+t.rate>=this.separatorColors[2]&&e.distanceAllPoint.length+t.rate<=this.separatorColors[3]?e.radiusTwo=this.radius[2]:e.distanceAllPoint.length+t.rate>=this.separatorColors[3]&&e.distanceAllPoint.length+t.rate<=this.separatorColors[4]&&(e.radiusTwo=this.radius[3]),e.distanceAllPoint.length+t.rate>=this.separatorColors[1]&&e.distanceAllPoint.length+t.rate<=this.separatorColors[2]?e.radiusThree=this.radius[0]:e.distanceAllPoint.length+t.rate>=this.separatorColors[2]&&e.distanceAllPoint.length+t.rate<=this.separatorColors[3]?e.radiusThree=this.radius[1]:e.distanceAllPoint.length+t.rate>=this.separatorColors[3]&&e.distanceAllPoint.length+t.rate<=this.separatorColors[4]&&(e.radiusThree=this.radius[2]),e.distanceAllPoint.length+t.rate>=this.separatorColors[2]&&e.distanceAllPoint.length+t.rate<=this.separatorColors[3]?e.radiusFour=this.radius[0]:e.distanceAllPoint.length+t.rate>=this.separatorColors[3]&&e.distanceAllPoint.length+t.rate<=this.separatorColors[4]&&(e.radiusFour=this.radius[1]),e.distanceAllPoint.length+t.rate>=this.separatorColors[3]&&e.distanceAllPoint.length+t.rate<=this.separatorColors[4]&&(e.radiusFive=this.radius[0]),e}),this.layer1.data(this.newData.filter(t=>t.distanceAllPoint.length>=0)),this.layer1.attr("r",t=>t.radiusOne),this.layer1.attr("cx",t=>this.newXScale(t.killerX)),this.layer1.attr("cy",t=>this.newYScale(t.killerY)),this.layer2.data(this.newData.filter(t=>t.distanceAllPoint.length>=this.radius[1])),this.layer2.attr("r",t=>t.radiusTwo),this.layer2.attr("cx",t=>this.newXScale(t.killerX)),this.layer2.attr("cy",t=>this.newYScale(t.killerY)),this.layer3.data(this.newData.filter(t=>t.distanceAllPoint.length>=this.radius[2])),this.layer3.attr("r",t=>t.radiusThree),this.layer3.attr("cx",t=>this.newXScale(t.killerX)),this.layer3.attr("cy",t=>this.newYScale(t.killerY)),this.layer4.data(this.newData.filter(t=>t.distanceAllPoint.length>=this.radius[3])),this.layer4.attr("r",t=>t.radiusFour),this.layer4.attr("cx",t=>this.newXScale(t.killerX)),this.layer4.attr("cy",t=>this.newYScale(t.killerY)),this.layer5.data(this.newData.filter(t=>t.distanceAllPoint.length>=this.radius[4])),this.layer5.attr("r",t=>t.radiusFive),this.layer5.attr("cx",t=>this.newXScale(t.killerX)),this.layer5.attr("cy",t=>this.newYScale(t.killerY)),this.svg.select("rect.map.xy.box").attr("transform","translate("+t.x+","+t.y+") scale("+t.k+","+t.k+")"),this.imagesvg.select("rect.map.xy.box").attr("transform","translate("+t.x+","+t.y+") scale("+t.k+","+t.k+")"),this.zoomScale={xScale:this.newXScale.domain(),yScale:this.newYScale.domain()};const e=Math.ceil(Math.abs(this.xScale.domain()[0]-this.xScale.domain()[1])/t.k/10),i=this.width/10;Jt.w(".d3-legend").remove(),Jt.w("#TextLegend").remove(),this.imagesvg.append("path").attr("d",this.legendPath(this.width,this.height,i)).attr("stroke-width","2px").attr("stroke","#000000").attr("class","d3-legend"),this.imagesvg.append("text").attr("class","d3-font").attr("id","TextLegend").attr("x",.86*this.width).attr("y",.97*this.height).append("tspan").text(e),Jt.w(".d3-loader").attr("style","display:none"),Jt.w(".d3-chart-col-2").attr("style","visibility: visible;")}brushed(){let t=[[],[]];this.resetMap?(t[0][0]=this.mapOptions$.getValue().minX,t[1][0]=this.mapOptions$.getValue().maxX,t[0][1]=this.mapOptions$.getValue().minY,t[1][1]=this.mapOptions$.getValue().maxY):t=Jt.n.selection;let e=0;this.newData&&this.newData.length&&t&&(this.newData.forEach(i=>{this.newXScale(i.killerX)>=t[0][0]&&this.newXScale(i.killerX)<=t[1][0]&&this.newYScale(i.killerY)>=t[0][1]&&this.newYScale(i.killerY)<=t[1][1]&&(0===i.rate?e++:e+=i.rate+1)}),this.layer1.attr("style",e=>this.isSelectedCircle(t,e.killerX,e.killerY)?"fill:#16cbe0":"fill:#ababab"),this.layer2.attr("style",e=>this.isSelectedCircle(t,e.killerX,e.killerY)?"fill:#0fff94":"fill:#ababab"),this.layer3.attr("style",e=>this.isSelectedCircle(t,e.killerX,e.killerY)?"fill:#fefe22":"fill:#ababab"),this.layer4.attr("style",e=>this.isSelectedCircle(t,e.killerX,e.killerY)?"fill:#ffa000":"fill:#ababab"),this.layer5.attr("style",e=>this.isSelectedCircle(t,e.killerX,e.killerY)?"fill:#ff2400":"fill:#ababab"),this.crossLineToolTip(t[1][0],t[0][1]+(t[1][1]-t[0][1])/2,"selected",e+" points",t[0][0]))}isSelectedCircle(t,e,i){let a=!1;return this.newXScale(e)>=t[0][0]&&this.newXScale(e)<=t[1][0]&&this.newYScale(i)>=t[0][1]&&this.newYScale(i)<=t[1][1]&&(a=!0),a}brushend(){Jt.w(".d3brushmapimage").call(this.selectRectMap.move,null)}crossLineToolTip(t,e,i,a,n){Jt.w("#crossCenterX").remove(),Jt.w("#crossCenterY").remove(),Jt.w("#crossTextTooltip").remove(),Jt.w("#polygonTooltip").remove();const s=Math.abs(this.zoomScale.xScale[0]-this.zoomScale.xScale[1]),r=Math.abs(this.zoomScale.yScale[0]-this.zoomScale.yScale[1]);let o=t/this.width*s,l=e/this.height*r;o=this.zoomScale.xScale[this.zoomScale.xScale[0]<this.zoomScale.xScale[1]?0:1]+o;const c=this.zoomScale.yScale[0]>this.zoomScale.yScale[1]?0:1;if(l=this.zoomScale.yScale[c]+(c?-1:1)*l,!i&&!a){const i=Jt.w(".imagesvg");i.append("g").attr("id","crossCenterX").append("svg:line").attr("x1",t).attr("y1",0).attr("x2",t).attr("y2",this.height).attr("class","svg-killmap-cross-air"),i.append("g").attr("id","crossCenterY").append("svg:line").attr("x1",0).attr("y1",e).attr("x2",this.width).attr("y2",e).attr("class","svg-killmap-cross-air")}const h=o>0?" ":"";i||a||(i=`Y:${l>0?" ":""}${Math.round(l)}`,a=`X:${h}${Math.round(o)}`);let p=0;const d=i.length>=a.length?10*i.length:10*a.length;this.width-t>d?(p=12,Jt.w(".imagesvg").append("polyline").attr("id","polygonTooltip").attr("stroke","#3B4298").attr("fill","white").attr("stroke-linecap","round").attr("points",t+","+e+" "+(t+5)+","+(e-5)+" "+(t+5)+","+(e-18)+" "+(t+d)+","+(e-18)+" "+(t+d)+","+(e+18)+" "+(t+5)+","+(e+18)+" "+(t+5)+","+(e+18)+" "+(t+5)+","+(e+10)+" "+(t+5)+","+(e+5)+" "+t+","+e)):(n&&(t=n),p=5-d,Jt.w(".imagesvg").append("polyline").attr("id","polygonTooltip").attr("stroke","#3B4298").attr("fill","white").attr("stroke-linecap","round").attr("points",t+","+e+" "+(t-5)+","+(e-5)+" "+(t-5)+","+(e-15)+" "+(t-d)+","+(e-15)+" "+(t-d)+","+(e+18)+" "+(t-5)+","+(e+18)+" "+(t-5)+","+(e+18)+" "+(t-5)+","+(e+10)+" "+(t-5)+","+(e+5)+" "+t+","+e)),Jt.w(".imagesvg").append("text").attr("class","title").attr("id","crossTextTooltip").attr("x",t+p).attr("y",e+14).attr("font-size",14).attr("fill","black").attr("font-family","monospace").append("tspan").text(i),Jt.w("#crossTextTooltip").append("tspan").attr("x",t+p).attr("y",e-2).text(a)}legendPath(t,e,i){const a=.94*t,n=a-i,s=.95*e,r=.94*e;return`M ${a},${s} ${a},${r} M ${a},${s} ${n},${s} ${n},${r} ${n},${s}`}crossLineToolTipClear(){Jt.w("#crossCenterX").remove(),Jt.w("#crossCenterY").remove(),Jt.w("#crossTextTooltip").remove(),Jt.w("#polygonTooltip").remove()}clearMapAll(){Jt.w(".innerImageTop").html("")}}return t.\u0275fac=function(e){return new(e||t)(o.Rb(o.h))},t.\u0275cmp=o.Lb({type:t,selectors:[["m-d3-heatmap"]],viewQuery:function(t,e){var i;1&t&&(o.Sc(ri,!0),o.Sc(oi,!0)),2&t&&(o.xc(i=o.gc())&&(e.chartContainer=i.first),o.xc(i=o.gc())&&(e.brushContainer=i.first))},hostBindings:function(t,e){1&t&&o.fc("keydown",(function(t){return e.setBrushOn(t)}),!1,o.Ac)("keyup",(function(t){return e.setBrushOff(t)}),!1,o.Ac)},inputs:{isInline:"isInline",_mapOptions:["mapOptions","_mapOptions"],_options:["options","_options"],series:["data","series"]},decls:5,vars:7,consts:[[1,"d3-section"],[4,"ngIf"],["noMapError",""],[1,"d3-loader"],["loader",""],[3,"isInline"],["class","d3-heatmap-chart",4,"ngIf","ngIfElse"],[1,"d3-heatmap-chart"],[1,"heatmap-over-image"],[3,"mousemove","mouseleave"],[1,"zoomableOf"],[1,"heatmap-inner-image"],[1,"imagesvg"],["svg",""],[1,"d3-heatmap-brush"],[1,"d3brushmapimage"],["svgbrush",""],[1,"d3-chart-description","mt-2"],[1,"f-w-600"],["class","m-card-error f-s-14 f-w-400 mar-r-l",4,"ngIf"],[1,"m-card-error","f-s-14","f-w-400","mar-r-l"]],template:function(t,e){1&t&&(o.Xb(0,"div",0),o.Lc(1,ci,5,3,"ng-container",1),o.kc(2,"async"),o.Wb(),o.Lc(3,di,2,5,"ng-template",null,2,o.Mc)),2&t&&(o.Kc("width",e.width+40,"px"),o.Db(1),o.pc("ngIf",o.uc(5,mi,o.lc(2,3,e.series$))))},directives:[a.m,_t.a],pipes:[a.b],styles:[".d3-section[_ngcontent-%COMP%]{background-color:#fff}.heatmap-over-image[_ngcontent-%COMP%]{position:relative;top:0;z-index:5;display:block;width:80%;height:100%}.heatmap-inner-image[_ngcontent-%COMP%]{top:-1071px;z-index:4}.d3-heatmap-brush[_ngcontent-%COMP%], .heatmap-inner-image[_ngcontent-%COMP%]{position:relative;display:block;width:80%;height:0}.d3-heatmap-brush[_ngcontent-%COMP%]{top:-649px;z-index:10}.zoom.xy.box[_ngcontent-%COMP%]{z-index:10}.cssload-box-loading[_ngcontent-%COMP%]{position:relative!important}.d3-legend[_ngcontent-%COMP%]{fill:none;stroke:#000;stroke-width:2px}  .d3-heatmap-brush .selection{stroke:#0f0f11;stroke-dasharray:5px;fill:transparent}  g .x.axis.bottom path,   g .x.axis.top path,   g .y.axis.left path,   g .y.axis.right path{stroke:#c4c4c4}  .axis .tick line{stroke:#0f0f11!important}  .svg-killmap-cross-air{fill:none;stroke:#585858;stroke-width:2px;stroke-opacity:1;stroke-dasharray:10 10}.dimmed.more[_ngcontent-%COMP%]{opacity:.15;font-size:1.4em;vertical-align:text-bottom}.mar-r-l[_ngcontent-%COMP%]{margin-right:20px!important;margin-left:20px!important;display:block!important;border-radius:3px;padding:10px}.d3-loader[_ngcontent-%COMP%]{padding:10px;margin:10px}.mat-tab-body.mat-tab-body-active[_ngcontent-%COMP%]{margin-top:20px}"],changeDetection:0}),t})();var gi=function(t){return t[t.All=0]="All",t[t.Killers=1]="Killers",t[t.Victims=2]="Victims",t[t.Suicide=3]="Suicide",t}({});const bi=["svg"],fi=["svgbrush"];function yi(t,e){if(1&t){const t=o.Yb();o.Xb(0,"div"),o.Xb(1,"div",7),o.Xb(2,"div",8),o.Xb(3,"div",9),o.fc("click",(function(){o.Cc(t);const e=o.jc().ngIf,i=o.jc();return i.changeMode(i.killmapEnum.All,e.type)})),o.Nc(4," Killers and Victims "),o.Wb(),o.Xb(5,"div",9),o.fc("click",(function(){o.Cc(t);const e=o.jc().ngIf,i=o.jc();return i.changeMode(i.killmapEnum.Killers,e.type)})),o.Nc(6," Killers "),o.Wb(),o.Xb(7,"div",9),o.fc("click",(function(){o.Cc(t);const e=o.jc().ngIf,i=o.jc();return i.changeMode(i.killmapEnum.Victims,e.type)})),o.Nc(8," Victims "),o.Wb(),o.Xb(9,"div",9),o.fc("click",(function(){o.Cc(t);const e=o.jc().ngIf,i=o.jc();return i.changeMode(i.killmapEnum.Suicide,e.type)})),o.Nc(10," Suicide "),o.Wb(),o.Wb(),o.Xb(11,"div",10),o.ic(),o.Xb(12,"svg",11),o.fc("mousemove",(function(e){return o.Cc(t),o.jc(2).showTooltip(e)}))("mouseleave",(function(){return o.Cc(t),o.jc(2).hideTooltip()})),o.Sb(13,"g",12),o.Wb(),o.Wb(),o.hc(),o.Xb(14,"div",13),o.ic(),o.Xb(15,"svg",14,15),o.Xb(17,"defs"),o.Xb(18,"filter"),o.Sb(19,"feGaussianBlur"),o.Wb(),o.Xb(20,"pattern"),o.Sb(21,"image"),o.Wb(),o.Wb(),o.Wb(),o.Wb(),o.hc(),o.Xb(22,"div",16),o.ic(),o.Xb(23,"svg",17,18),o.Sb(25,"g"),o.Wb(),o.Wb(),o.Wb(),o.hc(),o.Xb(26,"span",19),o.Nc(27," Info: "),o.Xb(28,"strong",20),o.Nc(29,"SHIFT + SCROLL"),o.Wb(),o.Nc(30," to zoom. Hold "),o.Xb(31,"strong",20),o.Nc(32,"CTRL"),o.Wb(),o.Nc(33," for coordinates. Hold "),o.Xb(34,"strong",20),o.Nc(35,"S"),o.Wb(),o.Nc(36," for selection. "),o.Xb(37,"strong",20),o.Nc(38,"ESC"),o.Wb(),o.Nc(39," to exit selection mode. "),o.Wb(),o.Wb()}if(2&t){const t=o.jc().ngIf,e=o.jc();o.Db(3),o.Hb("active",t.type===e.killmapEnum.All),o.Db(2),o.Hb("active",t.type===e.killmapEnum.Killers),o.Db(2),o.Hb("active",t.type===e.killmapEnum.Victims),o.Db(2),o.Hb("active",t.type===e.killmapEnum.Suicide),o.Db(3),o.Eb("width",e.width+128+"px")("height",e.height+"px")("id","axissvg"),o.Db(3),o.Eb("width",e.width+"px")("height",e.height+"px")("preserveAspectRatio","none"),o.Db(3),o.Eb("id","blurMe"),o.Db(1),o.Eb("in","SourceGraphic")("stdDeviation","4"),o.Db(1),o.Eb("id","img1")("patternUnits","userSpaceOnUse")("width","100%")("height","100%"),o.Db(1),o.Eb("href",e.url,null,"xlink")("x","0")("y","0")("width","100%")("height","100%"),o.Db(2),o.Eb("width",e.width+"px")("height",e.height+"px")("preserveAspectRatio","none"),o.Db(2),o.Eb("id","layoutbrush")}}function xi(t,e){if(1&t&&(o.Vb(0),o.Xb(1,"div",3,4),o.Sb(3,"m-loading-indicator",5),o.Wb(),o.Lc(4,yi,40,30,"div",6),o.Ub()),2&t){const t=e.ngIf;o.jc();const i=o.yc(5);o.Db(3),o.pc("isInline",!0),o.Db(1),o.pc("ngIf",t.data)("ngIfElse",i)}}function vi(t,e){if(1&t&&(o.Xb(0,"div",22),o.Nc(1," Map options are not set for "),o.Xb(2,"strong"),o.Nc(3),o.Wb(),o.Wb()),2&t){const t=e.ngIf;o.Db(3),o.Oc(null==t.options?null:t.options.name)}}const wi=function(t){return{options:t}};function Si(t,e){if(1&t&&(o.Lc(0,vi,4,1,"div",21),o.kc(1,"async")),2&t){const t=o.jc();o.pc("ngIf",o.uc(3,wi,o.lc(1,1,t.options$)))}}const ki=function(t,e){return{data:t,type:e}};let Ci=(()=>{class t{constructor(t){this.cdr=t,this.destroy$=new h.a,this.mapOptions$=new et.a(null),this.data$=new et.a([]),this.killmapType$=new et.a(gi.All),this.defaultOptions={invertXAxis:!1,invertYAxis:!0,name:"",subtitle:"",description:"",teamColors:{},radius:3,zoomOutsideMap:!1},this.defaultMapOptions={},this.preZoomDefaultOptions={},this.options$=new et.a(Object.assign({},this.defaultOptions)),this.killmapEnum=gi,this.height=650,this.width=650,this.url="",this.crossAirOn=!1,this.crossScale=4,this.teamColors=new Map,this.currentZoomScale=1,this.currentXPosition=1,this.currentYPosition=1,this.resetMap=!1,this.margin={top:0,bottom:80,left:0,right:0},this.colorPalette=["#34BFA3","#716ACA","#f4516C","#EECC02","#00c5dc","#3B4298","#BD1F75","#F1941E","#9A66E1","#22A3A6","#1474E5","#EC5B63","#8CDE4B","#CB7212","#4DAEFA","#39994A","#E1B7E1","#D83A43","#75B53E"],Object(it.a)([this.options$.asObservable(),this.mapOptions$.asObservable(),this.killmapType$.asObservable(),this.data$.pipe(Object(b.a)(t=>t instanceof Array))]).pipe(Object(X.a)(this.destroy$),Object(nt.a)(250)).subscribe(([t,e,i,a])=>{const n=this;if(!e||t.zoomOutsideMap)if(e||0!==a.length){let t=Number.MAX_SAFE_INTEGER,i=Number.MAX_SAFE_INTEGER,n=Number.MIN_SAFE_INTEGER,s=Number.MIN_SAFE_INTEGER;a.forEach(e=>{t=e.killerX<t?e.killerX:t,i=e.killerY<i?e.killerY:i,n=e.killerX>n?e.killerX:n,s=e.killerY>s?e.killerY:s}),e?(this.defaultMapOptions.url=e.url,this.preZoomDefaultOptions.minX=e.minX<t?e.minX:1.2*t,this.preZoomDefaultOptions.maxX=e.maxX>n?e.maxX:1.2*n,this.preZoomDefaultOptions.minY=e.minY<i?e.minY:1.2*i,this.preZoomDefaultOptions.maxY=e.maxY>s?e.maxY:1.2*s,this.defaultMapOptions.minX=e.minX,this.defaultMapOptions.minY=e.minY,this.defaultMapOptions.maxX=e.maxX,this.defaultMapOptions.maxY=e.maxY):this.defaultMapOptions.url="/assets/app/media/img/maps/placeholder_image.jpg"}else this.defaultMapOptions.url="/assets/app/media/img/maps/not_enough_data.png";else this.defaultMapOptions.url=e.url||"/assets/app/media/img/maps/not_enough_data.png",this.defaultMapOptions.minX=e.minX,this.defaultMapOptions.minY=e.minY,this.defaultMapOptions.maxX=e.maxX,this.defaultMapOptions.maxY=e.maxY;this.loadImage(this.defaultMapOptions.url).then(s=>(n.url=this.defaultMapOptions.url,n.width=650,n.height=650,n.clearMapAll(),t.zoomOutsideMap||null===e||(a=a.filter(t=>t.killerX>=e.minX&&t.killerX<=e.maxX&&t.killerY>=e.minY&&t.killerY<=e.maxY&&t.victimX>=e.minX&&t.victimX<=e.maxX&&t.victimY>=e.minY&&t.victimY<=e.maxY)),n.renderChart(a,this.defaultMapOptions,i,t),setTimeout(()=>this.cdr.detectChanges()),n)),this.width=n.width,this.height=n.height})}set _mapOptions(t){this.mapOptions$.next(t)}set _options(t){this.options$.next(Object.assign(Object.assign({},this.defaultOptions),t||{}))}set _data(t){const e=(t||[]).filter(t=>0!==t.killerX&&0!==t.killerY);this.data$.next(e)}setBrushOn(t){switch(t.code){case"KeyS":this.brushContainer.nativeElement.setAttribute("style","display: block");break;case"Escape":this.resetMap=!0,this.brushed();break;case"ControlLeft":this.crossAirOn=!0}}setBrushOff(t){switch(t.code){case"KeyS":break;case"Escape":this.resetMap=!1,this.brushContainer.nativeElement.setAttribute("style","display: none"),Jt.w("#crossTextTooltip").remove(),Jt.w("#polygonTooltip").remove(),this.brushend();break;case"ControlLeft":this.crossAirOn=!1}}ngOnDestroy(){this.options$.unsubscribe(),this.mapOptions$.unsubscribe(),this.killmapType$.unsubscribe(),this.data$.unsubscribe()}showTooltip(t){const e=this.chartContainer.nativeElement.getBoundingClientRect();this.crossAirOn?this.crossLineToolTip(t.clientX-e.left,t.clientY-e.top,null,null,null):this.crossLineToolTipClear()}hideTooltip(){this.crossLineToolTipClear()}loadImage(t){return new Promise((e,i)=>{const a=new Image;a.addEventListener("load",()=>e(a)),a.addEventListener("error",t=>i(t)),a.src=t})}renderChart(t,e,i,a){let n;if(this.killmapType=i,Jt.w(".d3-expand-chart-button").attr("style","visibility:hidden"),this.svgImage=Jt.w(".d3KillMapImage"),this.svg=Jt.w(".d3KillMapZoomableOf"),this.selectRectMap=Jt.g().on("end",()=>this.brushed()),Jt.w("#layoutbrush").call(this.selectRectMap),Jt.w(".d3-killmap-inner-image").attr("style","top:"+-this.height+"px"),this.resetMap=!1,this.brushContainer.nativeElement.setAttribute("style","display:none"),this.brushend(),void 0===this.svgImage.select(".map.xy.box")._groups[0][0]&&this.svgImage.append("svg:rect").attr("class","map xy box").attr("width",`${this.width}px`).attr("height",`${this.height}px`).attr("fill","url(#img1)").attr("opacity",.4).attr("transform","translate(0, 0) scale(1, 1)"),void 0===this.svgImage.select(".innerImageTop")._groups[0][0]&&this.svgImage.append("g").attr("class","innerImageTop"),void 0===this.svg.select("#containerMap")._groups[0][0]){const t=this.svg.append("g").attr("id","containerMap").attr("transform",`translate(${this.margin.left}, ${this.margin.top})`);t.append("g").attr("class","x axis top").attr("transform",`translate(0, ${this.height-1})`),t.append("g").attr("class","y axis right").attr("transform","translate(0, 0)"),t.append("g").attr("class","x axis bottom").attr("transform","translate(0, 0)"),t.append("g").attr("class","y axis left").attr("transform",`translate(${this.width}, 0)`);const i=a.invertXAxis?[e.maxX,e.minX]:[e.minX,e.maxX];this.xScale=Jt.u().domain(i).range([0,this.height]),this.xAxisTop=Jt.f(this.xScale).tickFormat(()=>""),this.xAxisBottom=Jt.c(this.xScale).tickFormat(()=>"");const n=a.invertYAxis?[e.maxY,e.minY]:[e.minY,e.maxY];this.yScale=Jt.u().domain(n).range([this.width,0]),this.yAxisRight=Jt.e(this.yScale).tickFormat(()=>""),this.yAxisLeft=Jt.d(this.yScale).tickFormat(()=>""),this.svg.select("g.x.axis.top").call(this.xAxisTop),this.svg.select("g.x.axis.bottom").call(this.xAxisBottom),this.svg.select("g.y.axis.right").call(this.yAxisRight),this.svg.select("g.y.axis.left").call(this.yAxisLeft),this.zoomScale={xScale:this.xScale.domain(),yScale:this.yScale.domain()},t.append("svg").attr("class","zoom xy box").attr("width",this.width).attr("height",this.height).style("visibility","hidden").attr("pointer-events","all")}if(this.teamColors.clear(),a.teamColors){const e=new Set;t.forEach(t=>{e.add(t.killerTeam),e.add(t.victimTeam)});let i=0;e.forEach(t=>{a.teamColors[t]?this.teamColors.set(t,a.teamColors[t]):(this.teamColors.set(t,this.colorPalette[i]),i=i<this.colorPalette.length-1?i+1:0)})}const s=!a.teamColors,r=t.map(t=>({killerX:Math.round(t.killerX),killerY:Math.round(t.killerY),killerTeam:s?"#161515":this.teamColors.get(t.killerTeam),victimX:Math.round(t.victimX),victimY:Math.round(t.victimY),victimTeam:s?"#FF3131":this.teamColors.get(t.victimTeam),deathReason:t.deathReason}));if(this.svgImage.select(".innerImageTop").select("circle").remove(),i===gi.All&&(this.linesKill=this.svgImage.select(".innerImageTop").selectAll("line").data(r.filter(t=>"kill"===t.deathReason)).enter().append("line").attr("x1",t=>this.xScale(t.killerX)).attr("x2",t=>this.xScale(t.victimX)).attr("y1",t=>this.yScale(t.killerY)).attr("y2",t=>this.yScale(t.victimY)).attr("opacity",.4).attr("class","svg-killmap-line").attr("style",t=>`stroke: ${t.victimTeam};`)),i!==gi.All&&i!==gi.Killers||(this.killerPoints=this.svgImage.select(".innerImageTop").selectAll("circle").data(r.filter(t=>"kill"===t.deathReason)).enter().append("circle").attr("class","d3-killmap-circle").attr("cx",t=>this.xScale(t.killerX)).attr("cy",t=>this.yScale(t.killerY)).attr("r",a.radius).attr("opacity",1).attr("fill",t=>t.killerTeam)),i!==gi.All&&i!==gi.Victims&&i!==gi.Suicide||(this.victimCrosses=this.svgImage.select(".innerImageTop").selectAll("path").data(r.filter(i===gi.Suicide?t=>"suicide"===t.deathReason:t=>"kill"===t.deathReason)).enter().append("path").attr("d",t=>this.crossPath(t.victimX,t.victimY,this.crossScale,this.xScale,this.yScale)).attr("opacity",1).attr("class","svgKillMapCross").attr("style",t=>`stroke: ${t.victimTeam}; stroke-width: 3px;`)),Jt.H().on("zoom",null),a.zoomOutsideMap){n=Jt.H().filter(()=>"wheel"!==Jt.n.type||Jt.n.shiftKey).extent([[0,0],[this.width,this.height]]).on("zoom",()=>this.zoomed());const t=Math.ceil(Math.abs(this.xScale.domain()[0]-this.xScale.domain()[1])),i=Math.ceil(Math.abs(this.preZoomDefaultOptions.minX-this.preZoomDefaultOptions.maxX)),s=Math.ceil(Math.abs(this.yScale.domain()[0]-this.yScale.domain()[1])),r=Math.ceil(Math.abs(this.preZoomDefaultOptions.minY-this.preZoomDefaultOptions.maxY));this.currentZoomScale=t/i>s/r?s/r:t/i;const o=a.invertXAxis?[this.preZoomDefaultOptions.maxX,this.preZoomDefaultOptions.minX]:[this.preZoomDefaultOptions.minX,this.preZoomDefaultOptions.maxX],l=a.invertYAxis?[this.preZoomDefaultOptions.maxY,this.preZoomDefaultOptions.minY]:[this.preZoomDefaultOptions.minY,this.preZoomDefaultOptions.maxY],c=Jt.u().domain(o).range([0,this.height]),h=Jt.u().domain(l).range([this.width,0]);this.currentXPosition=c(e.minX),this.currentYPosition=h(e.maxY)}else n=Jt.H().filter(()=>"wheel"!==Jt.n.type||Jt.n.shiftKey).extent([[0,0],[this.width,this.height]]).scaleExtent([1,15]).translateExtent([[0,0],[this.width,this.height]]).on("zoom",()=>this.zoomed());this.svg.select(".zoomCatcher").remove();const o=this.svg.append("rect").attr("class","zoomCatcher").attr("x",this.margin.left).attr("y",this.margin.top).attr("width",this.width).attr("height",this.height).attr("fill","transparent").attr("stroke","none").call(n);o.call(n.transform,Jt.I.translate(this.currentXPosition,this.currentYPosition).scale(this.currentZoomScale)),o.attr("transform",`translate(${this.margin.left}, ${this.margin.top})`).attr("x",0).attr("y",0)}brushed(){let t=[[],[]];if(this.resetMap?(t[0][0]=this.mapOptions$.getValue().minX,t[1][0]=this.mapOptions$.getValue().maxX,t[0][1]=this.mapOptions$.getValue().minY,t[1][1]=this.mapOptions$.getValue().maxY):t=Jt.n.selection,t&&1===this.currentZoomScale){let e=0,i=0;this.killmapType$.getValue()!==gi.All&&this.killmapType$.getValue()!==gi.Killers||this.killerPoints.attr("style",i=>this.isSelectedCircleNoScale(t,i.killerX,i.killerY)?(e++,""):"fill: #ABABAB;"),this.killmapType$.getValue()!==gi.All&&this.killmapType$.getValue()!==gi.Victims&&this.killmapType$.getValue()!==gi.Suicide||this.victimCrosses.attr("style",e=>this.isSelectedCircleNoScale(t,e.victimX,e.victimY)?(i++,"stroke: #FF3131; stroke-width: 3;"):"opacity: 0.3; stroke: #ABABAB; stroke-width: 3;"),this.killmapType$.getValue()===gi.All&&this.linesKill.attr("style",e=>this.isSelectedLineNoScale(t,e.killerX,e.killerY,e.victimX,e.victimY)?"opacity: .4; stroke: #FF3131; stroke-width: 1.5;":"opacity: .4; stroke: #FF3131; stroke-width: 1.5; stroke :#ABABAB;"),this.crossLineToolTip(t[1][0],t[0][1]+(t[1][1]-t[0][1])/2,"killers:"+e,"victims:"+i,t[0][0])}else if(t){let e=0,i=0;this.killmapType$.getValue()!==gi.All&&this.killmapType$.getValue()!==gi.Killers||this.killerPoints.attr("style",i=>this.isSelectedCircle(t,i.killerX,i.killerY)?(e++,""):"fill: #ABABAB;"),this.killmapType$.getValue()!==gi.All&&this.killmapType$.getValue()!==gi.Victims&&this.killmapType$.getValue()!==gi.Suicide||this.victimCrosses.attr("style",e=>this.isSelectedCircle(t,e.victimX,e.victimY)?(i++,"stroke: #FF3131; stroke-width: 3;"):"opacity: .4; stroke: #ABABAB; stroke-width: 3;"),this.killmapType$.getValue()===gi.All&&this.linesKill.attr("style",e=>this.isSelectedLine(t,e.killerX,e.killerY,e.victimX,e.victimY)?"opacity: .4; stroke: #FF3131; stroke-width: 1.5;":"opacity: .4; stroke: #FF3131; stroke-width: 1.5; stroke: #ABABAB;"),this.crossLineToolTip(t[1][0],t[0][1]+(t[1][1]-t[0][1])/2,"killers:"+e,"victims:"+i,t[0][0])}}isSelectedCircle(t,e,i){let a=!1;return this.newXScale(e)>=t[0][0]&&this.newXScale(e)<=t[1][0]&&this.newYScale(i)>=t[0][1]&&this.newYScale(i)<=t[1][1]&&(a=!0),a}isSelectedLine(t,e,i,a,n){let s=!1;return this.newXScale(e)>=t[0][0]&&this.newXScale(e)<=t[1][0]&&this.newYScale(i)>=t[0][1]&&this.newYScale(i)<=t[1][1]&&this.newXScale(a)>=t[0][0]&&this.newXScale(a)<=t[1][0]&&this.newYScale(n)>=t[0][1]&&this.newYScale(n)<=t[1][1]&&(s=!0),s}isSelectedCircleNoScale(t,e,i){let a=!1;return this.xScale(e)>=t[0][0]&&this.xScale(e)<=t[1][0]&&this.yScale(i)>=t[0][1]&&this.yScale(i)<=t[1][1]&&(a=!0),a}isSelectedLineNoScale(t,e,i,a,n){let s=!1;return this.xScale(e)>=t[0][0]&&this.xScale(e)<=t[1][0]&&this.yScale(i)>=t[0][1]&&this.yScale(i)<=t[1][1]&&this.xScale(a)>=t[0][0]&&this.xScale(a)<=t[1][0]&&this.yScale(n)>=t[0][1]&&this.yScale(n)<=t[1][1]&&(s=!0),s}brushend(){Jt.w("#layoutbrush").call(this.selectRectMap.move,null)}zoomed(){if("zoom"===Jt.n.type){const t=Jt.n.transform;this.currentZoomScale=t.k,this.currentXPosition=t.x,this.currentYPosition=t.y,this.newXScale=t.rescaleX(this.xScale),this.newYScale=t.rescaleY(this.yScale),this.svg.select("g.x.axis.top").transition().duration(0),this.svg.select("g.y.axis.right").transition().duration(0),this.svg.select("g.x.axis.bottom").transition().duration(0),this.svg.select("g.y.axis.left").transition().duration(0),this.killmapType!==gi.All&&this.killmapType!==gi.Killers||(this.killerPoints.attr("cx",t=>this.newXScale(t.killerX)),this.killerPoints.attr("cy",t=>this.newYScale(t.killerY))),this.killmapType!==gi.All&&this.killmapType!==gi.Victims&&this.killmapType!==gi.Suicide||this.victimCrosses.attr("d",t=>this.crossPath(t.victimX,t.victimY,this.crossScale,this.newXScale,this.newYScale)),this.killmapType===gi.All&&(this.linesKill.attr("x1",t=>this.newXScale(t.killerX)),this.linesKill.attr("y1",t=>this.newYScale(t.killerY)),this.linesKill.attr("x2",t=>this.newXScale(t.victimX)),this.linesKill.attr("y2",t=>this.newYScale(t.victimY)));const e=`translate(${t.x}, ${t.y}) scale(${t.k}, ${t.k})`;this.svg.select("rect.map.xy.box").attr("transform",e),this.svgImage.select("rect.map.xy.box").attr("transform",e),this.zoomScale={xScale:this.newXScale.domain(),yScale:this.newYScale.domain()};const i=Math.ceil(Math.abs(this.xScale.domain()[0]-this.xScale.domain()[1])/t.k/10),a=this.width/10;Jt.w(".d3-legend").remove(),Jt.w("#TextLegend").remove(),this.svgImage.append("path").attr("d",this.legendPath(this.width,this.height,a)).attr("stroke-width","2px").attr("stroke","#000000").attr("class","d3-legend"),this.svgImage.append("text").attr("class","d3-font").attr("id","TextLegend").attr("x",.86*this.width).attr("y",.97*this.height).append("tspan").text(i)}Jt.w(".d3-loader").attr("style","display:none"),Jt.w(".d3-tab-button-group").attr("style","display:flex"),Jt.w(".d3-chart-col-2").attr("style","visibility: visible;")}crossLineToolTip(t,e,i,a,n){Jt.w("#crossCenterX").remove(),Jt.w("#crossCenterY").remove(),Jt.w("#crossTextTooltip").remove(),Jt.w("#polygonTooltip").remove();const s=Math.abs(this.zoomScale.xScale[0]-this.zoomScale.xScale[1]),r=Math.abs(this.zoomScale.yScale[0]-this.zoomScale.yScale[1]);let o=t/this.width*s,l=e/this.height*r;o=this.zoomScale.xScale[this.zoomScale.xScale[0]<this.zoomScale.xScale[1]?0:1]+o;const c=this.zoomScale.yScale[0]>this.zoomScale.yScale[1]?0:1;if(l=this.zoomScale.yScale[c]+(c?-1:1)*l,null===i&&null===a){const i=Jt.w(".d3KillMapImage");i.append("g").attr("id","crossCenterX").append("svg:line").attr("x1",t).attr("y1",0).attr("x2",t).attr("y2",this.height).attr("class","svg-killmap-cross-air"),i.append("g").attr("id","crossCenterY").append("svg:line").attr("x1",0).attr("y1",e).attr("x2",this.width).attr("y2",e).attr("class","svg-killmap-cross-air")}const h=o>0?" ":"";let p;null===i&&null===a&&(i=`Y:${l>0?" ":""}${Math.round(l)}`,a=`X:${h}${Math.round(o)}`);const d=i.length>=a.length?10*i.length:10*a.length;this.width-t>d?(p=12,Jt.w(".d3KillMapImage").append("polyline").attr("id","polygonTooltip").attr("stroke","#3B4298").attr("fill","white").attr("stroke-linecap","round").attr("points",t+","+e+" "+(t+5)+","+(e-5)+" "+(t+5)+","+(e-18)+" "+(t+d)+","+(e-18)+" "+(t+d)+","+(e+18)+" "+(t+5)+","+(e+18)+" "+(t+5)+","+(e+18)+" "+(t+5)+","+(e+10)+" "+(t+5)+","+(e+5)+" "+t+","+e)):(n&&(t=n),p=5-d,Jt.w(".d3KillMapImage").append("polyline").attr("id","polygonTooltip").attr("stroke","#3B4298").attr("fill","white").attr("stroke-linecap","round").attr("points",t+","+e+" "+(t-5)+","+(e-5)+" "+(t-5)+","+(e-15)+" "+(t-d)+","+(e-15)+" "+(t-d)+","+(e+18)+" "+(t-5)+","+(e+18)+" "+(t-5)+","+(e+18)+" "+(t-5)+","+(e+10)+" "+(t-5)+","+(e+5)+" "+t+","+e)),Jt.w(".d3KillMapImage").append("text").attr("class","title").attr("id","crossTextTooltip").attr("x",t+p).attr("y",e+14).attr("font-size",14).attr("fill","black").attr("font-family","monospace").append("tspan").text(i),Jt.w("#crossTextTooltip").append("tspan").attr("x",t+p).attr("y",e-2).text(a)}crossPath(t,e,i,a,n){const s=a(t)+i,r=a(t)-i,o=n(e)+i,l=n(e)-i;return`M ${r},${l} ${s},${o} m ${r},${o} M ${r},${o} ${s},${l}`}legendPath(t,e,i){const a=.94*t,n=a-i,s=.95*e,r=.94*e;return`M ${a},${s} ${a},${r} M ${a},${s} ${n},${s} ${n},${r} ${n},${s}`}crossLineToolTipClear(){Jt.w("#crossCenterX").remove(),Jt.w("#crossCenterY").remove(),Jt.w("#crossTextTooltip").remove(),Jt.w("#polygonTooltip").remove()}clearMapAll(){Jt.w(".innerImageTop").html("")}changeMode(t,e){t!==e&&this.killmapType$.next(t)}}return t.\u0275fac=function(e){return new(e||t)(o.Rb(o.h))},t.\u0275cmp=o.Lb({type:t,selectors:[["m-d3-killmap"]],viewQuery:function(t,e){var i;1&t&&(o.Sc(bi,!0),o.Sc(fi,!0)),2&t&&(o.xc(i=o.gc())&&(e.chartContainer=i.first),o.xc(i=o.gc())&&(e.brushContainer=i.first))},hostBindings:function(t,e){1&t&&o.fc("keydown",(function(t){return e.setBrushOn(t)}),!1,o.Ac)("keyup",(function(t){return e.setBrushOff(t)}),!1,o.Ac)},inputs:{_mapOptions:["mapOptions","_mapOptions"],_options:["options","_options"],_data:["data","_data"]},decls:6,vars:10,consts:[[1,"d3-section"],[4,"ngIf"],["noMapError",""],[1,"d3-loader"],["loader",""],[3,"isInline"],[4,"ngIf","ngIfElse"],[1,"d3-killmap-chart"],[1,"d3-tab-button-group","d3-font"],[1,"d3-tab-button","clickable",3,"click"],[1,"d3-killmap-over-image"],[3,"mousemove","mouseleave"],[1,"d3KillMapZoomableOf"],[1,"d3-killmap-inner-image"],[1,"d3KillMapImage"],["svg",""],[1,"d3-killmap-brush"],[1,"d3brushmapimage"],["svgbrush",""],[1,"d3-chart-description","mt-2"],[1,"f-w-600"],["class","m-card-error f-s-14 f-w-400 mar-r-l",4,"ngIf"],[1,"m-card-error","f-s-14","f-w-400","mar-r-l"]],template:function(t,e){1&t&&(o.Xb(0,"div",0),o.Lc(1,xi,5,3,"ng-container",1),o.kc(2,"async"),o.kc(3,"async"),o.Wb(),o.Lc(4,Si,2,5,"ng-template",null,2,o.Mc)),2&t&&(o.Kc("width",e.width+40,"px"),o.Db(1),o.pc("ngIf",o.vc(7,ki,o.lc(2,3,e.data$),o.lc(3,5,e.killmapType$))))},directives:[a.m,_t.a],pipes:[a.b],styles:[".d3-section[_ngcontent-%COMP%]{background-color:#fff}.d3-killmap-chart[_ngcontent-%COMP%]{width:auto;height:auto;-webkit-transform:scale(1);transform:scale(1)}.d3-killmap-over-image[_ngcontent-%COMP%]{position:relative;top:0;z-index:5;display:block;width:80%;height:100%}.d3-killmap-inner-image[_ngcontent-%COMP%]{top:-991px;z-index:4}.d3-killmap-brush[_ngcontent-%COMP%], .d3-killmap-inner-image[_ngcontent-%COMP%]{position:relative;display:block;width:80%;height:0}.d3-killmap-brush[_ngcontent-%COMP%]{top:-649px;z-index:10}.d3-tab-button[_ngcontent-%COMP%]{padding:0;margin:0;width:120px;height:20px;text-align:center;border:1px solid #c4c4c4;border-bottom:none;font-size:11px;background-color:#e5e5e5;display:-webkit-box;display:flex;-webkit-box-align:center;align-items:center;-webkit-box-pack:center;justify-content:center;font-weight:400;position:relative;z-index:50}.d3-tab-button[_ngcontent-%COMP%]:not(:last-child){border-right:0}.d3-tab-button.active[_ngcontent-%COMP%]{font-weight:500;background-color:#fafafa}.d3-tab-button[_ngcontent-%COMP%]:hover{background-color:#e0e0e0}.d3-tab-button-group[_ngcontent-%COMP%]{-webkit-box-orient:horizontal;-webkit-box-direction:normal;flex-flow:row nowrap;-webkit-box-align:center;align-items:center;align-content:center;-webkit-box-pack:justify;justify-content:space-between;float:left;z-index:10;display:none}  g .x.axis.bottom path,   g .x.axis.top path,   g .y.axis.left path,   g .y.axis.right path{stroke:#c4c4c4}  .axis .tick line{stroke:#0f0f11!important}.zoom.xy.box[_ngcontent-%COMP%]{position:relative;z-index:10}  .d3-killmap-brush .selection{stroke:#0f0f11;stroke-dasharray:5px;fill:transparent}  .svg-killmap-line{stroke-width:1.5px;stroke-opacity:.4;fill:none}  .svg-killmap-cross{stroke-width:4px;stroke-opacity:1;fill:none}  .svg-killmap-cross-air{fill:none;stroke:#585858;stroke-width:2px;stroke-opacity:1;stroke-dasharray:10 10}.m-card[_ngcontent-%COMP%]   .hint-icon[_ngcontent-%COMP%]{font-size:2rem;font-weight:600;vertical-align:text-bottom}.mar-r-l[_ngcontent-%COMP%]{margin-right:20px!important;margin-left:20px!important;display:block!important}.d3-loader[_ngcontent-%COMP%]{padding:10px;margin:10px}.mat-tab-body.mat-tab-body-active[_ngcontent-%COMP%]{margin-top:20px}"],changeDetection:0}),t})();function Pi(t,e){if(1&t&&(o.Vb(0),o.Xb(1,"div",3),o.Xb(2,"div",4),o.Xb(3,"h1",5),o.Nc(4,"NO DATA FOUND"),o.Wb(),o.Xb(5,"h2",5),o.Nc(6,"USING CURRENT FILTERS"),o.Wb(),o.Wb(),o.Wb(),o.Ub()),2&t){const t=o.jc();o.Db(1),o.pc("ngClass",t.chartBoxExpansionService.isExpanded?"error-container-expanded":"error-container-fixed")}}function Oi(t,e){if(1&t&&(o.Vb(0),o.Xb(1,"div",3),o.Xb(2,"div",4),o.Xb(3,"h1",6),o.Nc(4,"NO MAP SELECTED"),o.Wb(),o.Xb(5,"h2",6),o.Nc(6,"PLEASE SELECT A MAP"),o.Wb(),o.Wb(),o.Wb(),o.Ub()),2&t){const t=o.jc();o.Db(1),o.pc("ngClass",t.chartBoxExpansionService.isExpanded?"error-container-expanded":"error-container-fixed")}}function Mi(t,e){if(1&t&&(o.Vb(0),o.Xb(1,"div",7),o.Nc(2),o.Wb(),o.Ub()),2&t){const t=o.jc();o.Db(2),o.Pc(" ",t.errorMessage," ")}}let Di=(()=>{class t{constructor(t){this.chartBoxExpansionService=t,this.ErrorTypes=ht}ngOnInit(){}}return t.\u0275fac=function(e){return new(e||t)(o.Rb(ct.a))},t.\u0275cmp=o.Lb({type:t,selectors:[["m-analytics-error"]],inputs:{currentErrorType:"currentErrorType",errorMessage:"errorMessage"},decls:4,vars:3,consts:[[3,"ngSwitch"],[4,"ngSwitchCase"],[4,"ngSwitchDefault"],[3,"ngClass"],[1,"error-wrapper"],[1,"no-data"],[1,"no-map-selected"],[1,"card","card-body","m-card-error","f-s-14","f-w-400"]],template:function(t,e){1&t&&(o.Vb(0,0),o.Lc(1,Pi,7,1,"ng-container",1),o.Lc(2,Oi,7,1,"ng-container",1),o.Lc(3,Mi,3,1,"ng-container",2),o.Ub()),2&t&&(o.pc("ngSwitch",e.currentErrorType),o.Db(1),o.pc("ngSwitchCase",e.ErrorTypes.ValuesAreZero),o.Db(1),o.pc("ngSwitchCase",e.ErrorTypes.MapIsNotSelected))},directives:[a.o,a.p,a.q,a.k],styles:[".error-container-expanded[_ngcontent-%COMP%], .error-container-fixed[_ngcontent-%COMP%]{width:900px;box-sizing:border-box;height:40vh;background-color:#fff;display:-webkit-box;display:flex;-webkit-box-pack:center;justify-content:center;-webkit-box-align:center;align-items:center}.error-container-expanded[_ngcontent-%COMP%]   .error-wrapper[_ngcontent-%COMP%], .error-container-fixed[_ngcontent-%COMP%]   .error-wrapper[_ngcontent-%COMP%]{padding:10%;-webkit-box-flex:0;flex:0 1;width:-webkit-max-content;width:-moz-max-content;width:max-content;text-align:center;display:-webkit-box;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;flex-flow:column;-webkit-box-align:center;align-items:center;-webkit-box-pack:center;justify-content:center}.error-container-expanded[_ngcontent-%COMP%]{width:100%}h1[_ngcontent-%COMP%], h2[_ngcontent-%COMP%]{-webkit-box-flex:0;flex:0 1;width:-webkit-max-content;width:-moz-max-content;width:max-content}h1[_ngcontent-%COMP%]{font-size:56px}h1[_ngcontent-%COMP%], h2[_ngcontent-%COMP%]{font-weight:900}h2[_ngcontent-%COMP%]{font-size:30px}h1.no-data[_ngcontent-%COMP%], h2.no-data[_ngcontent-%COMP%]{background-image:-webkit-repeating-linear-gradient(135deg,#f4516c,#f4516c 1px,transparent 2px,transparent 0,#f4516c 3px);background-image:repeating-linear-gradient(135deg,#f4516c,#f4516c 1px,transparent 2px,transparent 0,#f4516c 3px)}h1.no-data[_ngcontent-%COMP%], h1.no-map-selected[_ngcontent-%COMP%], h2.no-data[_ngcontent-%COMP%], h2.no-map-selected[_ngcontent-%COMP%]{background-size:4px 4px;-webkit-background-clip:text;-webkit-text-fill-color:transparent}h1.no-map-selected[_ngcontent-%COMP%], h2.no-map-selected[_ngcontent-%COMP%]{background-image:-webkit-repeating-linear-gradient(135deg,#34bfa2,#34bfa2 1px,transparent 2px,transparent 0,#34bfa2 3px);background-image:repeating-linear-gradient(135deg,#34bfa2,#34bfa2 1px,transparent 2px,transparent 0,#34bfa2 3px)}"]}),t})();function Ai(t,e){if(1&t){const t=o.Yb();o.Xb(0,"button",12),o.fc("click",(function(){o.Cc(t);const i=e.$implicit;return o.jc(3).toggleMetric(i.id)})),o.Nc(1),o.Wb()}if(2&t){const t=e.$implicit,i=o.jc(3);o.Hb("active",i.metricMap.get(t.id))("disabled",!i.metricMap.get(t.id)),o.Db(1),o.Pc(" ",t.name," ")}}function Ti(t,e){if(1&t){const t=o.Yb();o.Xb(0,"div"),o.Xb(1,"m-param-box",16),o.fc("onChange",(function(i){o.Cc(t);const a=e.$implicit;return o.jc(5).onParamChange(a,i)}))("onRemove",(function(){o.Cc(t);const i=e.$implicit;return o.jc(5).onParamRemove(i)})),o.kc(2,"async"),o.Wb(),o.Wb()}if(2&t){const t=e.$implicit,i=o.jc(5);o.Db(1),o.pc("name",t.name)("isRequired",o.lc(2,6,i.requiredParams$).has(t.id))("type",t.type)("value",i.dataMap.has(t.key)?i.dataMap.get(t.key):null)("key",t.key)("selectOptions",t.values?t.values:i.dynamicDataMap.has(t.key)?i.dynamicDataMap.get(t.key):null)}}function Xi(t,e){if(1&t&&(o.Vb(0),o.Lc(1,Ti,3,8,"div",15),o.Ub()),2&t){const t=o.jc(4);o.Db(1),o.pc("ngForOf",t.injectedParams)}}function _i(t,e){if(1&t){const t=o.Yb();o.Vb(0),o.Xb(1,"button",20),o.fc("click",(function(){o.Cc(t);const i=e.$implicit;return o.jc(5).onParamAdd(i)})),o.Nc(2),o.Wb(),o.Ub()}if(2&t){const t=e.$implicit;o.Db(2),o.Pc(" ",t.name," ")}}function Li(t,e){if(1&t){const t=o.Yb();o.Vb(0),o.Xb(1,"div",17,18),o.fc("click",(function(){return o.Cc(t),o.yc(2).openMenu()})),o.Wb(),o.Xb(3,"mat-menu",null,19),o.Lc(5,_i,3,1,"ng-container",15),o.Wb(),o.Ub()}if(2&t){const t=o.yc(4),e=o.jc(4);o.Db(1),o.pc("matMenuTriggerFor",t),o.Db(4),o.pc("ngForOf",e.availableParams)}}function Ei(t,e){if(1&t&&(o.Xb(0,"div",13),o.Xb(1,"div",6),o.Xb(2,"h6",7),o.Nc(3,"Filters"),o.Wb(),o.Lc(4,Xi,2,1,"ng-container",14),o.Lc(5,Li,6,2,"ng-container",14),o.Wb(),o.Wb()),2&t){const t=o.jc(3);o.Db(4),o.pc("ngIf",(null==t.injectedParams?null:t.injectedParams.length)>0),o.Db(1),o.pc("ngIf",(null==t.availableParams?null:t.availableParams.length)>0)}}function Ii(t,e){1&t&&(o.Xb(0,"span",37),o.Nc(1," omitted "),o.Wb())}function $i(t,e){if(1&t&&(o.Xb(0,"mat-option",34),o.Xb(1,"span",35),o.Nc(2),o.Wb(),o.Lc(3,Ii,2,0,"span",36),o.Wb()),2&t){const t=e.$implicit;o.pc("value",t),o.Db(1),o.Hb("italic",t._isOmitted),o.Db(1),o.Pc(" ",t.name," "),o.Db(1),o.pc("ngIf",t._isActive&&t._isOmitted)}}function Wi(t,e){if(1&t&&o.Tb(0,49),2&t){o.jc(5);const t=o.yc(3);o.pc("ngTemplateOutlet",t)}}const ji=function(t,e){return{errorMsg:t,errorType:e}};function Yi(t,e){if(1&t&&(o.Tb(0,50),o.kc(1,"async"),o.kc(2,"async")),2&t){const t=o.jc(5),e=o.yc(7);o.pc("ngTemplateOutlet",e)("ngTemplateOutletContext",o.vc(6,ji,o.lc(1,2,t.queryError$),o.lc(2,4,t.queryError$)))}}const zi=function(t){return{name:t}};function Bi(t,e){if(1&t&&o.Tb(0,50),2&t){const t=o.jc().$implicit;o.jc(5);const e=o.yc(9);o.pc("ngTemplateOutlet",e)("ngTemplateOutletContext",o.uc(2,zi,t.visualization.name))}}function Ri(t,e){if(1&t&&o.Sb(0,"m-value-card",61),2&t){const t=o.jc(2).$implicit;o.pc("value",t.data.value)("caption",t.data.label)("description",t.visualization.label)("tooltipCaption",t.visualization.description)}}function Ni(t,e){if(1&t&&(o.Sb(0,"m-d3-plot",63),o.kc(1,"async")),2&t){const t=o.jc(3),e=t.$implicit,a=t.index,n=o.jc(5);var i;const s=(null==(i=o.lc(1,3,n.activeQuery$))?null:i.key)+"-"+a;o.pc("data",e.data)("options",e.visualization)("uniqueId",s)}}function Fi(t,e){if(1&t&&(o.Xb(0,"m-chart-box",62),o.kc(1,"async"),o.Lc(2,Ni,2,5,"ng-template"),o.Wb()),2&t){const t=o.jc(2),e=t.$implicit,a=t.index,n=o.jc(5);var i;const s=(null==(i=o.lc(1,3,n.activeQuery$))?null:i.key)+"-"+a;o.pc("data",e.data)("options",e.visualization)("uniqueId",s)}}function Vi(t,e){if(1&t&&(o.Sb(0,"m-d3-box-plot",63),o.kc(1,"async")),2&t){const t=o.jc(3),e=t.$implicit,a=t.index,n=o.jc(5);var i;const s=(null==(i=o.lc(1,3,n.activeQuery$))?null:i.key)+"-"+a;o.pc("data",e.data)("options",e.visualization)("uniqueId",s)}}function qi(t,e){if(1&t&&(o.Xb(0,"m-chart-box",64),o.kc(1,"async"),o.Lc(2,Vi,2,5,"ng-template"),o.Wb()),2&t){const t=o.jc(2),e=t.$implicit,a=t.index,n=o.jc(5);var i;const s=(null==(i=o.lc(1,3,n.activeQuery$))?null:i.key)+"-"+a;o.pc("data",e.data)("options",e.visualization)("uniqueId",s)}}function Ki(t,e){if(1&t&&o.Sb(0,"m-d3-synchronized",66),2&t){const t=o.jc(3).$implicit;o.pc("seriesData",t.data)("options",t.visualization)}}function Hi(t,e){if(1&t&&(o.Xb(0,"m-chart-box",65),o.Lc(1,Ki,1,2,"ng-template"),o.Wb()),2&t){const t=o.jc(2).$implicit;o.pc("data",t.data)("options",t.visualization)}}function Zi(t,e){if(1&t&&o.Sb(0,"m-d3-horizontal-bars",68),2&t){const t=o.jc(3).$implicit;o.pc("seriesData",t.data)("options",t.visualization)("countRows",0)}}function Ui(t,e){if(1&t&&(o.Xb(0,"m-chart-box",67),o.Lc(1,Zi,1,3,"ng-template"),o.Wb()),2&t){const t=o.jc(2).$implicit;o.pc("data",t.data)("options",t.visualization)}}function Qi(t,e){if(1&t&&o.Sb(0,"m-d3-scatterplot",66),2&t){const t=o.jc(3).$implicit;o.pc("seriesData",t.data)("options",t.visualization)}}function Gi(t,e){if(1&t&&(o.Xb(0,"m-chart-box",67),o.Lc(1,Qi,1,2,"ng-template"),o.Wb()),2&t){const t=o.jc(2).$implicit;o.pc("data",t.data)("options",t.visualization)}}function Ji(t,e){if(1&t&&o.Sb(0,"m-d3-funnel",66),2&t){const t=o.jc(4).$implicit;o.pc("seriesData",t.data)("options",t.visualization)}}function ta(t,e){if(1&t&&(o.Xb(0,"m-chart-box",67),o.Lc(1,Ji,1,2,"ng-template"),o.Wb()),2&t){const t=o.jc(3).$implicit;o.pc("data",t.data)("options",t.visualization)}}function ea(t,e){if(1&t&&o.Sb(0,"m-d3-segmented-funnel",66),2&t){const t=o.jc(4).$implicit;o.pc("seriesData",t.data)("options",t.visualization)}}function ia(t,e){if(1&t&&(o.Xb(0,"m-chart-box",67),o.Lc(1,ea,1,2,"ng-template"),o.Wb()),2&t){const t=o.jc(3).$implicit;o.pc("data",t.data)("options",t.visualization)}}function aa(t,e){if(1&t&&(o.Vb(0),o.Lc(1,ta,2,2,"m-chart-box",69),o.Lc(2,ia,2,2,"m-chart-box",69),o.Ub()),2&t){const t=o.jc(2).$implicit;o.Db(1),o.pc("ngIf",1===t.data.length),o.Db(1),o.pc("ngIf",t.data.length>1)}}function na(t,e){if(1&t&&o.Sb(0,"m-d3-heatmap",71),2&t){const t=o.jc(3).$implicit;o.pc("data",t.data)("mapOptions",t.map)("options",t.visualization)}}function sa(t,e){if(1&t&&(o.Xb(0,"m-chart-box",70),o.Lc(1,na,1,3,"ng-template"),o.Wb()),2&t){const t=o.jc(2).$implicit;o.pc("options",t.visualization)("data",t.data)("onlyFixed",!0)}}function ra(t,e){if(1&t&&o.Sb(0,"m-d3-killmap",73),2&t){const t=o.jc(3).$implicit;o.pc("mapOptions",t.map)("data",t.data)("options",t.visualization)}}function oa(t,e){if(1&t&&(o.Xb(0,"m-chart-box",72),o.Lc(1,ra,1,3,"ng-template"),o.Wb()),2&t){const t=o.jc(2).$implicit;o.pc("data",t.data)("options",t.visualization)("onlyFixed",!0)}}function la(t,e){if(1&t&&(o.Vb(0,52),o.Lc(1,Ri,1,4,"m-value-card",53),o.Lc(2,Fi,3,5,"m-chart-box",54),o.Lc(3,qi,3,5,"m-chart-box",55),o.Lc(4,Hi,2,2,"m-chart-box",56),o.Lc(5,Ui,2,2,"m-chart-box",57),o.Lc(6,Gi,2,2,"m-chart-box",57),o.Lc(7,aa,3,2,"ng-container",58),o.Lc(8,sa,2,3,"m-chart-box",59),o.Lc(9,oa,2,3,"m-chart-box",60),o.Ub()),2&t){const t=o.jc().$implicit,e=o.jc(5);o.pc("ngSwitch",t.visualization.kind),o.Db(1),o.pc("ngSwitchCase",e.nodeKind.Indicator),o.Db(1),o.pc("ngSwitchCase",e.nodeKind.CommonPlot),o.Db(1),o.pc("ngSwitchCase",e.nodeKind.BoxPlot),o.Db(1),o.pc("ngSwitchCase",e.nodeKind.SynchronizedPlot),o.Db(1),o.pc("ngSwitchCase",e.nodeKind.HorizontalBars),o.Db(1),o.pc("ngSwitchCase",e.nodeKind.Scatter),o.Db(1),o.pc("ngSwitchCase",e.nodeKind.Funnel),o.Db(1),o.pc("ngSwitchCase",e.nodeKind.Heatmap),o.Db(1),o.pc("ngSwitchCase",e.nodeKind.Killmap)}}function ca(t,e){if(1&t&&(o.Xb(0,"div"),o.Lc(1,Bi,1,4,"ng-container",40),o.Lc(2,la,10,10,"ng-container",51),o.Wb()),2&t){const t=e.$implicit;o.Db(1),o.pc("ngIf",!t.data||0===t.data.length),o.Db(1),o.pc("ngIf",t.data)}}function ha(t,e){if(1&t&&(o.Xb(0,"th",77),o.Nc(1),o.Wb()),2&t){const t=o.jc().$implicit;o.Db(1),o.Oc(t)}}function pa(t,e){if(1&t&&(o.Xb(0,"td",78),o.Nc(1),o.Wb()),2&t){const t=e.$implicit,i=o.jc().$implicit;o.Db(1),o.Pc(" ",null!=t[i]&&t[i].length?t[i]:(t[i]-0).toFixed(1)," ")}}function da(t,e){1&t&&(o.Vb(0,74),o.Lc(1,ha,2,1,"th",75),o.Lc(2,pa,2,1,"td",76),o.Ub()),2&t&&o.pc("matColumnDef",e.$implicit)}function ma(t,e){1&t&&o.Sb(0,"tr",79)}function ua(t,e){1&t&&o.Sb(0,"tr",80)}const ga=function(){return[10,20,50,100]};function ba(t,e){if(1&t){const t=o.Yb();o.Xb(0,"div",38),o.Lc(1,Wi,1,1,"ng-container",39),o.kc(2,"async"),o.Lc(3,Yi,3,9,"ng-container",40),o.kc(4,"async"),o.Xb(5,"mat-tab-group",41),o.kc(6,"async"),o.Xb(7,"mat-tab",42),o.Lc(8,ca,3,2,"div",15),o.kc(9,"async"),o.Wb(),o.Xb(10,"mat-tab",43),o.Xb(11,"table",44),o.fc("matSortChange",(function(e){return o.Cc(t),o.jc(4).sortTable(e)})),o.Lc(12,da,3,1,"ng-container",45),o.Lc(13,ma,1,0,"tr",46),o.Lc(14,ua,1,0,"tr",47),o.Wb(),o.Sb(15,"mat-paginator",48),o.Wb(),o.Wb(),o.Wb()}if(2&t){const t=o.jc(4);var i;const e=0===(null==(i=o.lc(6,13,t.queryResult$))?null:i.length);o.Db(1),o.pc("ngIf",o.lc(2,9,t.queryInProgress$)),o.Db(2),o.pc("ngIf",o.lc(4,11,t.queryError$)),o.Db(2),o.pc("hidden",e),o.Db(3),o.pc("ngForOf",o.lc(9,15,t.queryResult$)),o.Db(3),o.pc("dataSource",t.dataSource),o.Db(1),o.pc("ngForOf",t.displayedColumns),o.Db(1),o.pc("matHeaderRowDef",t.displayedColumns),o.Db(1),o.pc("matRowDefColumns",t.displayedColumns),o.Db(1),o.pc("pageSizeOptions",o.tc(17,ga))}}const fa=function(){return{standalone:!0}};function ya(t,e){if(1&t){const t=o.Yb();o.Xb(0,"div",21),o.Xb(1,"h6",7),o.Nc(2,"Query"),o.Wb(),o.Xb(3,"div",22),o.Xb(4,"form",23),o.Xb(5,"mat-form-field",24),o.Xb(6,"mat-select",25),o.fc("selectionChange",(function(e){return o.Cc(t),o.jc(3).onQueryChange(e.value)})),o.kc(7,"async"),o.Xb(8,"mat-select-trigger"),o.Nc(9),o.kc(10,"async"),o.Wb(),o.Xb(11,"mat-option"),o.Sb(12,"ngx-mat-select-search",26),o.Wb(),o.Lc(13,$i,4,5,"mat-option",27),o.kc(14,"async"),o.Wb(),o.Xb(15,"mat-icon",28),o.Nc(16,"search"),o.Wb(),o.Wb(),o.Wb(),o.Xb(17,"button",29),o.fc("click",(function(){return o.Cc(t),o.jc(3).sendQuery()})),o.Sb(18,"i",30),o.Wb(),o.Xb(19,"div",31),o.kc(20,"async"),o.Xb(21,"a",32),o.kc(22,"async"),o.Nc(23," Download CSV "),o.Wb(),o.Wb(),o.Wb(),o.Lc(24,ba,16,18,"div",33),o.kc(25,"async"),o.Wb()}if(2&t){const t=o.jc(3);var i,a;const e=0===(null==(a=o.lc(20,16,t.queryResult$))?null:a.length);var n,s;const r=(null==(s=o.lc(25,20,t.activeQuery$))?null:null==s.nodes?null:s.nodes.length)>0;o.Db(6),o.pc("ngModel",o.lc(7,10,t.activeQuery$))("ngModelOptions",o.tc(22,fa)),o.Db(3),o.Pc(" ",null==(i=o.lc(10,12,t.activeQuery$))?null:i.name," "),o.Db(3),o.pc("formControl",t.queryFilterCtrl),o.Db(1),o.pc("ngForOf",o.lc(14,14,t.filteredQueries$)),o.Db(6),o.pc("hidden",e),o.Db(2),o.sc("filename","",t.database,"_",null==(n=o.lc(22,18,t.activeQuery$))?null:n.key,".csv"),o.pc("data",t.dataSource.data),o.Db(3),o.pc("ngIf",r)}}function xa(t,e){if(1&t){const t=o.Yb();o.Vb(0),o.Xb(1,"div",5),o.Xb(2,"div",6),o.Xb(3,"h6",7),o.Nc(4,"Query types"),o.Wb(),o.Xb(5,"button",8),o.fc("click",(function(){return o.Cc(t),o.jc(2).toggleAllMetric()})),o.Nc(6," All "),o.Wb(),o.Lc(7,Ai,2,5,"button",9),o.kc(8,"async"),o.Wb(),o.Wb(),o.Lc(9,Ei,6,2,"div",10),o.Lc(10,ya,26,23,"div",11),o.kc(11,"async"),o.Ub()}if(2&t){const t=o.jc(2);o.Db(5),o.Hb("active",t.isAllMetricActive())("disabled",!t.isAllMetricActive()),o.Db(2),o.pc("ngForOf",o.lc(8,7,t.analyticsData$).metrics),o.Db(2),o.pc("ngIf",t.queryParamMap.size>0),o.Db(1),o.pc("ngIf",o.lc(11,9,t.filteredQueries$))}}function va(t,e){if(1&t&&(o.Xb(0,"div"),o.Lc(1,xa,12,11,"ng-container",0),o.kc(2,"async"),o.Wb()),2&t){const t=o.jc(),e=o.yc(5);o.Db(1),o.pc("ngIf",o.lc(2,2,t.analyticsData$).queries.length>0)("ngIfElse",e)}}function wa(t,e){1&t&&o.Sb(0,"m-loading-indicator",81),2&t&&o.pc("isInline",!0)}function Sa(t,e){if(1&t&&(o.Xb(0,"div",5),o.Xb(1,"div",82),o.Xb(2,"div",83),o.Xb(3,"div"),o.Xb(4,"span"),o.Nc(5,"Project "),o.Xb(6,"strong"),o.Nc(7),o.Wb(),o.Nc(8," does not contain any queries"),o.Wb(),o.Wb(),o.Wb(),o.Wb(),o.Wb()),2&t){const t=o.jc();o.Db(7),o.Oc(t.project.name)}}function ka(t,e){if(1&t&&o.Sb(0,"m-analytics-error",84),2&t){const t=e.errorMsg;o.pc("currentErrorType",e.errorType)("errorMessage",t)}}function Ca(t,e){if(1&t&&(o.Xb(0,"div",85),o.Xb(1,"span"),o.Nc(2,"Sub-query "),o.Xb(3,"strong"),o.Nc(4),o.Wb(),o.Nc(5," failed"),o.Wb(),o.Wb()),2&t){const t=e.name;o.Db(4),o.Oc(t)}}let Pa=(()=>{class t{constructor(t,e,i,a,s){this.router=t,this.route=e,this.queryService=i,this.cdr=a,this.chartBoxExpansionService=s,this.destroy$=new h.a,this.analyticsData$=new et.a(null),this.metricMap=new Map,this.activeMetrics$=new et.a(new Set),this.gameMaps=new Map,this.projectParamMap=new Map,this.queryParamMap=new Map,this.injectedParams=new Array,this.availableParams=new Array,this.requiredParams$=new et.a(new Set),this.dataMap=new Map,this.dynamicDataMap=new Map,this.dynamicSubMap=new Map,this.queryKey="query",this.queryFilterCtrl=new n.c,this.filteredQueries$=new et.a(null),this.activeQuery$=new et.a(null),this.queryInProgress$=new et.a(!1),this.queryError$=new et.a(null),this.queryResult$=new et.a([]),this.nodeKind=ut.j,this.dataSource=new A.k([]),this.ErrorTypes=ht,Object(it.a)(this.route.data,this.route.queryParamMap).pipe(Object(X.a)(this.destroy$),Object(g.a)(([t,e])=>{const i=t.activeProject,a=!this.project||this.project.id!==i.project.id;return a&&this.analyticsData$.next(null),Object(it.a)(Object(p.a)(i.project),Object(p.a)(i.database),Object(p.a)(e),a?this.queryService.getAnalyticsData(i.project.id):Object(p.a)(null)).pipe(Object(X.a)(this.destroy$))})).subscribe(([t,e,i,a])=>{a&&(this.project=t,this.database=e,this.initialize(a)),a=a||this.analyticsData$.getValue();const n=i.has(this.queryKey)?i.get(this.queryKey):null,s=n?a.queries.filter(t=>t.key===n)[0]:null;if(0===a.queries.length)i.keys.length>0&&this.navigate(null);else if(n&&s){this.activeQuery$.getValue(),this.activeQuery$.next(s),this.queryResult$.next([]),this.queryError$.next(null);const t=new Set([...s.requiredParams]);this.requiredParams$.next(t),this.queryParamMap.clear(),s.params.map(t=>this.projectParamMap.get(t)).forEach(t=>this.queryParamMap.set(t.key,t));const e=new Set;if(i.keys.filter(t=>!(t===this.queryKey||this.queryParamMap.has(t))).forEach(t=>e.add(t)),e.size>0){const t={};return i.keys.filter(t=>!e.has(t)).forEach(e=>t[e]=i.get(e)),void this.navigate(s.key,t)}const a=new Map;let n=!1;if([...Array.from(this.queryParamMap.values())].forEach(e=>{const n=i.has(e.key)?i.get(e.key):void 0,s=void 0!==n?this.deserialize(e,n):void 0,r=void 0!==s&&this.validate(e,s),o=t.has(e.id);o&&!r?a.set(e.key,this.serialize(e,this.defaultValue(e))):o||r||void 0===n||a.set(e.key,void 0)}),a.size>0){const t={};return a.forEach((e,i)=>{void 0===e?delete t[i]:t[i]=e}),void this.navigate(s.key,t)}this.dataMap.clear(),this.injectedParams.length=0,this.availableParams.length=0,i.keys.filter(t=>t!==this.queryKey).map(t=>this.queryParamMap.get(t)).forEach(t=>this.dataMap.set(t.key,this.deserialize(t,i.get(t.key)))),[...Array.from(this.queryParamMap.values())].forEach(t=>this.dataMap.has(t.key)?this.injectedParams.push(t):this.availableParams.push(t)),this.injectedParams.filter(t=>t.inputSql).forEach(e=>{const i={};t.has(e.id)&&this.dataMap.has(e.key)&&!this.dataMap.get(e.key)&&(n=!0),e.dependsOn instanceof Array&&e.dependsOn.forEach(t=>{const e=this.projectParamMap.get(t),a=this.dataMap.has(e.key)?this.dataMap.get(e.key):void 0;e instanceof pt.h&&void 0!==a&&""!==a&&(i[e.key]=this.toRequestJson(e,a))}),this.dynamicSubMap.has(e.key)&&this.dynamicSubMap.get(e.key)instanceof c.a&&(this.dynamicSubMap.get(e.key).unsubscribe(),this.dynamicSubMap.delete(e.key));const a=this.queryService.retrieveParameterValues(i,this.project.id,this.database,e.key).pipe(Object(X.a)(this.destroy$)).subscribe(t=>this.dynamicDataMap.set(e.key,t.items));this.dynamicSubMap.set(e.key,a)}),i.keys.find(t=>"map_id"===t)&&!i.get("map_id")&&this.queryError$.next(this.ErrorTypes.MapIsNotSelected),n||this.sendQuery()}else this.navigate(a.queries[0].key,{})})}set matSort(t){this.dataSource.sort=t}ngAfterViewInit(){Object(it.a)(this.activeMetrics$.asObservable(),this.activeQuery$.asObservable(),this.queryFilterCtrl.valueChanges.pipe(Object(at.a)("")),this.analyticsData$.pipe(Object(b.a)(t=>!!t))).pipe(Object(X.a)(this.destroy$),Object(nt.a)(150)).subscribe(([t,e,i,a])=>{const n=a.queries.map(a=>{const n=0===this.metricMap.size||0===a.metrics.length||a.metrics.filter(e=>t.has(e)).length>0,s=(i||"").trim().toLocaleLowerCase(),r=0===s.length||-1!==a.name.toLocaleLowerCase().indexOf(s);return a._isOmitted=!(n&&r),a._isActive=e&&a.key===e.key,a}).filter(t=>t._isActive||!t._isOmitted);this.filteredQueries$.next(n)})}ngOnDestroy(){this.subData instanceof c.a&&this.subData.unsubscribe(),this.dynamicSubMap.forEach((t,e)=>t.unsubscribe()),this.destroy$.next(),this.destroy$.complete()}initialize(t){const e=new Set;this.metricMap.clear(),t.metrics.forEach(t=>{this.metricMap.set(t.id,!0),e.add(t.id)}),this.activeMetrics$.next(e),this.gameMaps.clear(),t.maps.forEach(t=>this.gameMaps.set(t.name,t)),this.projectParamMap.clear(),t.params.forEach(t=>this.projectParamMap.set(t.id,t)),this.filteredQueries$.next(t.queries),this.injectedParams.length=0,this.availableParams.length=0,this.dataMap.clear(),this.dynamicSubMap.forEach((t,e)=>t.unsubscribe()),this.dynamicSubMap.clear(),this.injectedParams.length=0,this.availableParams.length=0,this.analyticsData$.next(t)}navigate(t,e={},i=!0,a=null){return"string"==typeof t?e[this.queryKey]=t:delete e[this.queryKey],this.router.navigate([],{queryParams:e,replaceUrl:i,queryParamsHandling:a})}serialize(t,e){switch(t.type){case dt.h.Boolean:return`${!!e}`;case dt.h.Numeric:return`${e}`;case dt.h.Date:return lt.a.DateSerializer.toJson(e);case dt.h.DateRange:return`${lt.a.DateSerializer.toJson(e.begin)}:${lt.a.DateSerializer.toJson(e.end)}`;case dt.h.TimePartition:return dt.l.toJson(e);case dt.h.Select:default:return`${e}`}}deserialize(t,e){switch(t.type){case dt.h.Boolean:return"true"===e;case dt.h.Numeric:return parseFloat(e);case dt.h.Date:return lt.a.DateSerializer.fromJson(e);case dt.h.DateRange:const[i,a]=e.split(":");return{begin:lt.a.DateSerializer.fromJson(i),end:lt.a.DateSerializer.fromJson(a)};case dt.h.TimePartition:return dt.l.fromJson(e);case dt.h.Select:switch(t.valueType){case dt.f.Bool:return"true"===e;case dt.f.Number:return parseFloat(e);case dt.f.String:default:return e}default:return e}}toRequestJson(t,e){switch(t.type){case dt.h.Boolean:case dt.h.Numeric:case dt.h.Select:return e;case dt.h.Date:return lt.a.DateTimeSerializer.toJson(e);case dt.h.DateRange:return{from:lt.a.DateTimeSerializer.toJson(e.begin),to:lt.a.DateTimeSerializer.toJson(e.end)};case dt.h.TimePartition:return dt.l.toJson(e);default:return`${e}`}}validate(t,e){switch(t.type){case dt.h.Boolean:return"boolean"==typeof e;case dt.h.Numeric:return"number"==typeof e&&!isNaN(e);case dt.h.Date:return e instanceof Date;case dt.h.DateRange:return e&&e.begin instanceof Date&&e.end instanceof Date;case dt.h.TimePartition:return null!==dt.l.toJson(e);case dt.h.Select:if(t.values instanceof Array)return t.values.filter(t=>t.value===e).length>0;switch(t.valueType){case dt.f.Bool:return"boolean"==typeof e;case dt.f.Number:return"number"==typeof e;case dt.f.String:return"string"==typeof e;default:return!1}default:return!1}}defaultValue(t){switch(t.type){case dt.h.Boolean:return!0;case dt.h.Numeric:return 0;case dt.h.Date:return new Date;case dt.h.DateRange:const e=new Date,i=new Date(e);return i.setMonth(i.getMonth()-1),{begin:i,end:e};case dt.h.TimePartition:return dt.l.Day;case dt.h.Select:if(t.inputSql)return"";if(t.values instanceof Array)return t.values.length>0?t.values[0].value:null;switch(t.valueType){case dt.f.Bool:return!0;case dt.f.Number:return 0;case dt.f.String:return"";default:return null}default:return null}}isAllMetricActive(){return 0===this.metricMap.size||0===Array.from(this.metricMap.values()).filter(t=>!t).length}toggleAllMetric(){const t=!this.isAllMetricActive();Array.from(this.metricMap.keys()).forEach(e=>this.metricMap.set(e,t)),this.activeMetrics$.next(t?new Set(this.metricMap.keys()):new Set)}toggleMetric(t){const e=!this.metricMap.get(t);this.metricMap.set(t,e);const i=this.activeMetrics$.getValue();e?i.add(t):i.delete(t),this.activeMetrics$.next(i)}onParamAdd(t){const e={};e[t.key]=this.serialize(t,this.defaultValue(t)),this.navigate(this.activeQuery$.getValue().key,e,!0,"merge")}onParamChange(t,e){const i={};i[t.key]=this.serialize(t,e),this.navigate(this.activeQuery$.getValue().key,i,!0,"merge")}onParamRemove(t){const e={};e[t.key]=void 0,this.navigate(this.activeQuery$.getValue().key,e,!0,"merge")}onQueryChange(t){this.navigate(t.key,{},!1,"merge")}sendQuery(){this.subData instanceof c.a&&(this.subData.unsubscribe(),this.subData=null);const t=this.activeQuery$.getValue();if(t){this.queryResult$.getValue().length>0&&this.queryResult$.next([]),this.queryError$.next(null),this.queryInProgress$.next(!0);const e={};if(!t.nodes.map(t=>this.checkOptions(t)).every(t=>t))return this.queryError$.next(this.ErrorTypes.OptionsAreIncorrect),void this.queryInProgress$.next(!1);this.dataMap.forEach((t,i)=>{e[i]=this.toRequestJson(this.queryParamMap.get(i),t)}),this.subData=this.queryService.sendAnalyticsRequest(e,this.project.id,this.database,t.key).pipe(Object(X.a)(this.destroy$),Object(st.a)(()=>this.queryInProgress$.next(!1))).subscribe(e=>{if(e||this.queryError$.next(this.ErrorTypes.AnalyticsQueryFailed),0===e.result.map(t=>t.result.map(t=>t.data.map(t=>t.value).filter(t=>0!==t))).flat(3).length)this.queryError$.next(this.ErrorTypes.ValuesAreZero);else{const i=t.nodes.map((t,i)=>{const a=e.result[i],n={data:null,map:null,visualization:t.output};if(!(a instanceof mt.d))return n;switch(n.visualization.kind){case ut.j.Indicator:const t=a.result[0].data[0];n.data={label:t.label,value:t.value};break;case ut.j.CommonPlot:case ut.j.SynchronizedPlot:case ut.j.HorizontalBars:case ut.j.Funnel:n.data=a.result;break;case ut.j.Heatmap:const e=a.result[0].maps,i=1===e.length?e[0]:null;n.map=this.gameMaps.has(i)?this.gameMaps.get(i):null,n.data=a.result[0];break;case ut.j.Killmap:const s=a.result[0].map;n.map=this.gameMaps.has(s)?this.gameMaps.get(s):null,n.data=a.result[0].data;break;case ut.j.Scatter:n.data=a.result}return n});this.queryResult$.next(i),e.result=e.result.map(t=>null===t?void 0:t),this.refreshTable(e.result)}},t=>{if(t instanceof tt.c)switch(t.status){case 403:this.queryError$.next("Error: 403 Forbidden");break;case 404:this.queryError$.next("Error: 404 File not Found");break;case 500:this.queryError$.next("Error: 500 Internal Server Error");break;default:this.queryError$.next(t)}})}}refreshTable(t){const e=t[0].result,i=this.queryResult$.getValue(),a=this.activeQuery$.getValue(),n=[];this.displayedColumns=[],this.dataSource=new A.k([]),void 0!==e[0]&&(e.forEach((t,e)=>{switch(a.nodes[0].output.kind){case ut.j.Indicator:case ut.j.CommonPlot:case ut.j.SynchronizedPlot:case ut.j.HorizontalBars:case ut.j.Funnel:this.displayedColumns=Object.keys(i[0].data[0].data[0]),t.data.forEach(t=>{n.filter(e=>e.label===t.label)[0]?n.filter(e=>e.label===t.label)[0][this.displayedColumns[e+1]]=t.value:n.push({label:t.label,[this.displayedColumns[e+1]]:t.value})});break;case ut.j.Heatmap:this.displayedColumns=Object.keys(i[0].data.data[0]),t.data.forEach(t=>n.push(t));break;case ut.j.Killmap:this.displayedColumns=Object.keys(i[0].data[0]),t.data.forEach(t=>n.push(t))}}),this.dataSource=new A.k(n)),this.dataSource.paginator=this.paginator,this.dataSource.sort=this.matSort}sortTable(t){const e=this.dataSource.data.slice();t.active&&""!==t.direction?(this.dataSource.data=e.sort((e,i)=>{const a="asc"===t.direction;return Object(ot.a)(e[t.active],i[t.active],a)}),setTimeout(()=>this.cdr.detectChanges())):this.dataSource.data=e}checkOptions(t){return!(t.output instanceof ut.f)||t.output.series.map(e=>!(e.yAxis===ut.a.Primary&&!t.output.yAxisType||e.yAxis===ut.a.Secondary&&!t.output.secondaryYAxisType)).every(t=>t)}}return t.\u0275fac=function(e){return new(e||t)(o.Rb(s.g),o.Rb(s.a),o.Rb(rt.a),o.Rb(o.h),o.Rb(ct.a))},t.\u0275cmp=o.Lb({type:t,selectors:[["m-analytics-overview"]],viewQuery:function(t,e){var i;1&t&&(o.Sc(P.a,!0),o.Ic(D.a,!0)),2&t&&(o.xc(i=o.gc())&&(e.paginator=i.first),o.xc(i=o.gc())&&(e.matSort=i.first))},decls:10,vars:4,consts:[[4,"ngIf","ngIfElse"],["loading",""],["noProjectQueries",""],["error",""],["queryError",""],[1,"row","first-row"],[1,"col-xl-12","col-lg-12","col-md-12","col-sm-12"],[1,"m-heading"],[1,"btn","btn-brand","m-btn","m-btn--air","m-btn-metric-type","bold",3,"click"],["class","btn btn-brand m-btn m-btn--air m-btn-metric-type",3,"active","disabled","click",4,"ngFor","ngForOf"],["class","row",4,"ngIf"],["class","query-wrapper",4,"ngIf"],[1,"btn","btn-brand","m-btn","m-btn--air","m-btn-metric-type",3,"click"],[1,"row"],[4,"ngIf"],[4,"ngFor","ngForOf"],[3,"name","isRequired","type","value","key","selectOptions","onChange","onRemove"],[1,"m-plus",3,"matMenuTriggerFor","click"],["filtersMenuTrigger","matMenuTrigger"],["filtersMenu","matMenu"],["mat-menu-item","",3,"click"],[1,"query-wrapper"],[1,"query-drop-down-row"],[2,"width","100%"],[1,"m-metric-select"],[3,"ngModel","ngModelOptions","selectionChange"],["placeholderLabel","Start typing for filtering","noEntriesFoundLabel","No queries match filter criteria",3,"formControl"],[3,"value",4,"ngFor","ngForOf"],[1,"m-search-icon","f-s-24"],[1,"btn","query-btn","btn-metal","m-btn","m-btn--air","m-btn-metric-type","bold",2,"width","40px","height","40px","padding","2px",3,"click"],[1,"la","la-refresh","hint-icon","f-w-600","f-s-24"],[1,"m-btn-csv-download",3,"hidden"],["csvLink","",1,"btn","btn-brand","m-btn","m-btn--air","m-btn-download","active",3,"data","filename"],["class","ldfjkdsl;kf;lskf;lsdkf",4,"ngIf"],[3,"value"],[1,"m-option-font"],["class","m-option-small italic ml-1",4,"ngIf"],[1,"m-option-small","italic","ml-1"],[1,"ldfjkdsl;kf;lskf;lsdkf"],[3,"ngTemplateOutlet",4,"ngIf"],[3,"ngTemplateOutlet","ngTemplateOutletContext",4,"ngIf"],[1,"neat-font",3,"hidden"],["label","Visual"],["label","Data Table"],["mat-table","","matSort","","matSortDisableClear","",1,"mat-elevation-z8",3,"dataSource","matSortChange"],[3,"matColumnDef",4,"ngFor","ngForOf"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["showFirstLastButtons","",3,"pageSizeOptions"],[3,"ngTemplateOutlet"],[3,"ngTemplateOutlet","ngTemplateOutletContext"],[3,"ngSwitch",4,"ngIf"],[3,"ngSwitch"],[3,"value","caption","description","tooltipCaption",4,"ngSwitchCase"],["class","common-plot",3,"data","options","uniqueId",4,"ngSwitchCase"],["class","box-plot",3,"data","options","uniqueId",4,"ngSwitchCase"],["class","sync",3,"data","options",4,"ngSwitchCase"],[3,"data","options",4,"ngSwitchCase"],[4,"ngSwitchCase"],[3,"options","data","onlyFixed",4,"ngSwitchCase"],[3,"data","options","onlyFixed",4,"ngSwitchCase"],[3,"value","caption","description","tooltipCaption"],[1,"common-plot",3,"data","options","uniqueId"],[3,"data","options","uniqueId"],[1,"box-plot",3,"data","options","uniqueId"],[1,"sync",3,"data","options"],[3,"seriesData","options"],[3,"data","options"],[3,"seriesData","options","countRows"],[3,"data","options",4,"ngIf"],[3,"options","data","onlyFixed"],[3,"data","mapOptions","options"],[3,"data","options","onlyFixed"],[3,"mapOptions","data","options"],[3,"matColumnDef"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],["mat-header-row",""],["mat-row",""],[3,"isInline"],[1,"col-sm-12"],[1,"card","card-body","m-card-warning","f-s-14","f-w-400"],[3,"currentErrorType","errorMessage"],[1,"card","card-body","m-card-error","f-s-14","f-w-400"]],template:function(t,e){if(1&t&&(o.Lc(0,va,3,4,"div",0),o.kc(1,"async"),o.Lc(2,wa,1,1,"ng-template",null,1,o.Mc),o.Lc(4,Sa,9,1,"ng-template",null,2,o.Mc),o.Lc(6,ka,1,2,"ng-template",null,3,o.Mc),o.Lc(8,Ca,6,1,"ng-template",null,4,o.Mc)),2&t){const t=o.yc(3);o.pc("ngIf",o.lc(1,2,e.analyticsData$))("ngIfElse",t)}},directives:[a.m,a.l,Dt,C.d,C.e,C.b,n.r,n.k,n.l,y.a,O.a,n.j,n.m,O.c,l.o,H,n.d,S.a,At.a,Tt.b,Tt.a,A.j,D.a,A.g,A.i,P.a,a.r,a.o,a.p,Kt,Gt,Le,ti,ei.a,ii.a,ai.a,ni.a,si.a,ui,Ci,A.c,A.e,A.b,A.d,D.b,A.a,A.f,A.h,_t.a,Di],pipes:[a.b],styles:['.m-heading[_ngcontent-%COMP%]{font-size:16px;font-weight:700;margin-bottom:0}.m-plus[_ngcontent-%COMP%]{border-radius:5px;width:70px;height:70px;background-color:initial;border:2px solid #716aca;position:relative;display:inline;float:left;margin:5px 0;cursor:pointer;opacity:.3}.m-plus[_ngcontent-%COMP%], .m-plus[_ngcontent-%COMP%]:hover{-webkit-transition:opacity .5s linear;transition:opacity .5s linear}.m-plus[_ngcontent-%COMP%]:hover, .m-plus[_ngcontent-%COMP%]:hover:after, .m-plus[_ngcontent-%COMP%]:hover:before{opacity:1}.m-plus[_ngcontent-%COMP%]:after{height:4px;margin-top:-2px;top:50%;left:8px;right:8px}.m-plus[_ngcontent-%COMP%]:after, .m-plus[_ngcontent-%COMP%]:before{content:" ";position:absolute;display:block;background-color:#716aca;z-index:9}.m-plus[_ngcontent-%COMP%]:before{width:4px;margin-left:-2px;left:50%;top:8px;bottom:8px}.row[_ngcontent-%COMP%]{margin-top:14px}.m-metric-select[_ngcontent-%COMP%]{font-size:1.2em;width:100%}.mat-form-field-label[_ngcontent-%COMP%]{font-size:1rem}.mat-option-text[_ngcontent-%COMP%]{font-size:1.2em}.m-btn-metric-type[_ngcontent-%COMP%]{margin:5px 10px 5px 0;padding:6px 12px}.mat-select-arrow-wrapper[_ngcontent-%COMP%]{float:right}.la[_ngcontent-%COMP%]{font-family:LineAwesome,serif}.m-search-icon[_ngcontent-%COMP%]{float:right;position:absolute;right:15px}.m-metric-select[_ngcontent-%COMP%]     .mat-form-field-infix{border-top:5px}.m-metric-select[_ngcontent-%COMP%]     .mat-form-field-underline{display:none}.m-metric-select[_ngcontent-%COMP%]     .mat-select-trigger .mat-select-value{padding-right:20px}.m-metric-select[_ngcontent-%COMP%]     .mat-form-field-flex{border:1px solid #ccc;padding:5px 10px;border-radius:3px;-webkit-transition:all 125ms linear;transition:all 125ms linear;background-color:#fff}.m-metric-select.mat-focused[_ngcontent-%COMP%]     .mat-form-field-flex{border:1px solid #3f51b5}.m-metric-select[_ngcontent-%COMP%]     mat-icon{margin-top:-3px;color:#ccc;-webkit-transition:all 125ms linear;transition:all 125ms linear}.m-metric-select.mat-focused[_ngcontent-%COMP%]     mat-icon{color:#3f51b5}.m-metric-select[_ngcontent-%COMP%]     .mat-form-field-wrapper{padding-bottom:0}  .mat-select-panel{max-height:62vh!important}.first-row[_ngcontent-%COMP%]{margin-top:0!important}  .mat-tab-label{height:40px}.m-btn-download[_ngcontent-%COMP%]{padding:7px 10px}.m-option-font[_ngcontent-%COMP%]{font-weight:400}.m-option-small[_ngcontent-%COMP%]{font-size:1rem;font-weight:500;font-variant:small-caps;color:#b22222}.query-wrapper[_ngcontent-%COMP%]{width:100%;display:-webkit-box;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;flex-direction:column;margin-top:14px}.query-wrapper[_ngcontent-%COMP%]   .query-drop-down-row[_ngcontent-%COMP%]{width:900px;position:relative;display:-webkit-box;display:flex;-webkit-box-align:center;align-items:center}.query-wrapper[_ngcontent-%COMP%]   .query-drop-down-row[_ngcontent-%COMP%]   .m-btn-csv-download[_ngcontent-%COMP%]{position:absolute;bottom:-35px;right:0;cursor:pointer;z-index:5}.query-wrapper[_ngcontent-%COMP%]   .query-btn[_ngcontent-%COMP%]{margin:10px 0 10px 10px}.btn.btn-brand[_ngcontent-%COMP%]{background-color:#218fcc!important;border-color:#1e8bc0!important}.btn-brand.m-btn--air[_ngcontent-%COMP%]{box-shadow:0 5px 10px 2px rgba(107,202,255,.1)!important}.btn-brand.m-btn--air[_ngcontent-%COMP%]:hover{box-shadow:0 5px 10px 2px rgba(107,202,255,.19)!important}'],changeDetection:0}),t})();var Oa=i("j1ZV"),Ma=i("n9uO");i.d(e,"AnalyticsModule",(function(){return Da}));let Da=(()=>{class t{}return t.\u0275mod=o.Pb({type:t}),t.\u0275inj=o.Ob({factory:function(e){return new(e||t)},providers:[],imports:[[a.c,U.c,Q.a,G.a,Oa.a,n.f,n.o,w,y.c,S.b,k.c,C.c,P.b,A.l,T.b,O.b,M.a,D.c,Z,s.i.forChild([{path:"**",component:Pa,resolve:{activeProject:J.a}}]),Ma.a]]}),t})()}}]);